<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="overflow: hidden; cursor: none; background-color: black;">
<script>
'use strict';function k(a,b){b|=0;return((a|0)%b+b)%b}function n(a,b,c){return Math.max(b,Math.min(a,c))}function p(a,b){for(let c of a)if(!c.s)return c;a.push(new b.prototype.constructor);return a[a.length-1]}function ba(a,b,c){return a<b?Math.min(b,a+c):Math.max(b,a-c)}function ca(a,b,c,d,e,f,g){null==b&&(b=new r(0,0));let h=a.x+b.x-c.x/2;a=a.y+b.y-c.y/2;return h+c.x>=d&&h<d+f&&a+c.y>=e&&a<e+g};function v(a,b){let c=a.length();if(1E-4>c)a.x=b?1:0,a.y=0;else return a.x/=c,a.y/=c,a.clone()}function da(a){a.x=0;a.y=0}class r{constructor(a,b){this.x=void 0==a?0:a;this.y=void 0==b?0:b}length(){return Math.hypot(this.x,this.y)}clone(){return new r(this.x,this.y)}}class x{constructor(a,b,c){this.r=n(a,0,255);this.ub=n(b,0,255);this.rb=n(c,0,255)}clone(){return new x(this.r,this.ub,this.rb)}};function ea(a,b,c){let d=document.createElement("div");d.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;");a.canvas=document.createElement("canvas");a.canvas.width=b;a.canvas.height=c;a.canvas.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");d.appendChild(a.canvas);document.body.appendChild(d);a.ga=a.canvas.getContext("2d");a.ga.imageSmoothingEnabled=!1;fa(a)}
function fa(a){var b=window.innerWidth,c=window.innerHeight;a=a.canvas;var d=Math.min(b/a.width|0,c/a.height|0);let e=a.width*d;d*=a.height;c=String(c/2-d/2|0)+"px";b=String(b/2-e/2|0)+"px";a.style.width=String(e|0)+"px";a.style.height=String(d|0)+"px";a.style.top=c;a.style.left=b}function B(a,b,c,d,e){b=void 0==b?255:b;c=void 0==c?b:c;b="rgba("+String(b|0)+","+String(c|0)+","+String((void 0==d?c:d)|0)+","+String(void 0!=e?e:1);a.ga.fillStyle=b;a.ga.strokeStyle=b}
function C(a,b,c,d,e,f,g,h,l){var m=e,q=f;if(!(null==b||0>=m||0>=q)){var t=a.ga;g+=a.a.x;a=h+a.a.y;c|=0;d|=0;m|=0;q|=0;g|=0;a|=0;e|=0;f|=0;l|=0;0!=l&&t.save();0!=(l&1)&&(t.translate(e,0),t.scale(-1,1),g*=-1);0!=(l&2)&&(t.translate(0,f),t.scale(1,-1),a*=-1);t.drawImage(b,c,d,m,q,g,a,e,f);0!=l&&t.restore()}}function ha(a,b,c,d){C(a,b,0,0,b.width,b.height,c,d,0)}
function D(a,b,c,d,e,f,g,h){let l=b.width/16|0,m=d;h&&(m=d-=c.length*(l+f)/2);for(let q=0;q<c.length;++q)h=c.charCodeAt(q),10==h?(m=d,e+=l+g):(C(a,b,h%16*l,(h/16|0)*l,l,l,m,e,!1),m+=l+f)}
class ia{constructor(a,b,c){this.ga=this.canvas=null;ea(this,a,b);this.width=a;this.height=b;window.addEventListener("resize",()=>fa(this));this.a=new r(0,0);this.B=null==c?{}:c;this.pb=0;this.ob=new r(0,0)}clear(a,b,c){this.ga.fillStyle="rgba("+String(a|0)+","+String(b|0)+","+String(c|0)+",1";this.ga.fillRect(0,0,this.width,this.height)}fillRect(a,b,c,d){a+=this.a.x;b+=this.a.y;this.ga.fillRect(a|0,b|0,c|0,d|0)}moveTo(a,b){this.a=new r(a,b)}move(a,b){this.a.x+=a;this.a.y+=b}update(a){0<this.pb&&
(this.pb-=a.step)}};function ja(a,b){if(null==b)for(b=0;b<a.buttons.length;++b)a.buttons[b]=E;else for(let c=0;c<b.buttons.length;++c){if(c>=a.buttons.length)for(let d=0;d<c-a.buttons.length;++d)a.buttons.push(E);b.buttons[c].pressed?a.buttons[c]==E||a.buttons[c]==ka?(a.ib=!0,a.buttons[c]=F):a.buttons[c]=la:a.buttons[c]=a.buttons[c]==la||a.buttons[c]==F?ka:E}}
function ma(a,b){let c=!0;null!=b&&(a.O.x=0,a.O.y=0,.25<=Math.abs(b.axes[0])&&(a.O.x=b.axes[0],c=!1),.25<=Math.abs(b.axes[1])&&(a.O.y=b.axes[1],c=!1),8<=b.axes.length&&c&&(.25<=Math.abs(b.axes[6])&&(a.O.x=b.axes[6]),.25<=Math.abs(b.axes[7])&&(a.O.y=b.axes[7])))}function na(a,b){return null==b||0>b||b>=a.buttons.length?E:a.buttons[b]}
class oa{constructor(){this.O=new r(0,0);this.buttons=[];this.a=null;this.index=0;window.addEventListener("gamepadconnected",a=>{console.log("Gamepad with index "+String(a.gamepad.index)+" connected.");let b=navigator.getGamepads()[a.gamepad.index];this.index=a.gamepad.index;a=this.a=b;ma(this,a);ja(this,a)});this.ib=!1}update(){this.ib=!1;this.O.x=0;this.O.y=0;if(null!=this.a){var a=navigator;a=null==a?null:a.getGamepads?a.getGamepads():a.webkitGetGamepads?a.webkitGetGamepads:null;null!=a&&(this.a=
a[this.index])}a=this.a;ma(this,a);ja(this,a)}};var E=0,ka=2,la=1,F=3;function pa(a,b,c,d,e){a.actions[b]={state:E,key:c,Ma:d,jb:e};a.m[c]=!0;return a}function qa(a){return 0>a.O.y&&-.25<=a.g.y&&-.25>a.l.y}function ra(a){return 0<a.O.y&&.25>=a.g.y&&.25<a.l.y}
class sa{constructor(){this.c={};this.m={};this.actions={};this.a=new oa;this.O=new r(0,0);this.g=new r(0,0);this.l=new r(0,0);window.addEventListener("keydown",a=>{var b=a.code;this.c[b]!=la&&(this.i=!0,this.c[b]=F);this.m[b]&&a.preventDefault()});window.addEventListener("keyup",a=>{var b=a.code;this.c[b]!=E&&(this.c[b]=ka);this.m[b]&&a.preventDefault()});window.addEventListener("contextmenu",a=>{a.preventDefault()});window.addEventListener("mousemove",()=>{window.focus()});window.addEventListener("mousedown",
()=>{window.focus()});this.i=!1}Ob(){this.a.update();for(let a in this.actions)this.actions[a].state=this.c[this.actions[a].key]|E,this.actions[a].state==E&&(null!=this.actions[a].Ma&&(this.actions[a].state=na(this.a,this.actions[a].Ma)),this.actions[a].state==E&&null!=this.actions[a].jb&&(this.actions[a].state=na(this.a,this.actions[a].jb)));this.g=this.O.clone();da(this.O);if(.25<=Math.abs(this.a.O.x)||.25<=Math.abs(this.a.O.y))this.O=this.a.O.clone();this.actions.right.state&1?this.O.x=1:this.actions.left.state&
1&&(this.O.x=-1);this.actions.down.state&1?this.O.y=1:this.actions.up.state&1&&(this.O.y=-1);this.l=new r(this.O.x-this.g.x,this.O.y-this.g.y)}zb(){var a=this.c;for(let b in a)a[b]==F?a[b]=la:a[b]==ka&&(a[b]=E);this.i=!1}ib(){return this.i||this.a.ib}};class H{constructor(){}refresh(){}Ua(){}Eb(){}};function ta(a,b,c,d){return a.ia[b][k(d,a.height)*a.width+k(c,a.width)]}function ua(a,b,c,d,e){c=k(c,a.width);d=k(d,a.height);a.ia[b][d*a.width+c]=e}function va(a){let b=new wa;for(let c of a.ia)b.ia.push(Array.from(c));b.width=a.width;b.height=a.height;b.a=a.a;return b}class wa{constructor(){this.height=this.width=0;this.ia=[];this.a={}}};class xa{constructor(a,b){this.data=b;this.a=null;this.gain=a.createGain();this.i=this.c=this.g=0;this.loop=!1}play(a,b,c,d){this.Oa(a,b,b,c,d)}Oa(a,b,c,d,e,f){null!=this.a&&(this.a.disconnect(),this.a=null);let g=a.createBufferSource();g.buffer=this.data;g.loop=!!d;b=n(b,0,1);c=n(c,0,1);null!=f?this.gain.gain.setValueAtTime(b,e):this.gain.gain.value=b;this.g=a.currentTime-e;this.c=0;this.i=b;this.loop=d;g.connect(this.gain).connect(a.destination);g.start(0,e);null!=f&&this.gain.gain.exponentialRampToValueAtTime(c,
e+f/1E3);this.a=g}stop(){null!=this.a&&(this.a.disconnect(),this.a.stop(0),this.a=null)}pause(a){null!=this.a&&(this.c=a.currentTime-this.g,this.stop())}resume(a){this.play(a,this.i,this.loop,this.c)}};function ya(a,b){za(a,b,"json",c=>{c=JSON.parse(c);for(let d in c.bitmaps)Aa(a,c.bitmaps[d].name,c.bitmapPath+c.bitmaps[d].path);for(let d in c.tilemaps)Ba(a,c.tilemaps[d].name,c.tilemapPath+c.tilemaps[d].path);for(let d in c.samples)Ca(a,c.samples[d].name,c.samplePath+c.samples[d].path);for(let d in c.localization)Da(a,c.localization[d].name,c.localizationPath+c.localization[d].path)})}
function za(a,b,c,d){let e=new XMLHttpRequest;e.overrideMimeType("text/"+c);e.open("GET",b,!0);++a.total;e.onreadystatechange=()=>{4==e.readyState&&("200"==String(e.status)&&void 0!=d&&d(e.responseText),++a.loaded)};e.send(null)}function Aa(a,b,c){++a.total;let d=new Image;d.onload=()=>{++a.loaded;a.B[b]=d};d.src=c}
function Ba(a,b,c){++a.total;za(a,c,"xml",d=>{var e=a.Pb;{var f=new wa;d=(new DOMParser).parseFromString(d,"text/xml").getElementsByTagName("map")[0];f.width=Number(d.getAttribute("width"));f.height=Number(d.getAttribute("height"));var g=d.getElementsByTagName("layer");f.ia=[];let m=9999;for(var h of g)h.id<m&&(m=h.id);for(var l of g){h=l.id-m;g=l.getElementsByTagName("data")[0].childNodes[0].nodeValue.replace(/(\r\n|\n|\r)/gm,"");g=g.split(",");f.ia[h]=[];for(let q=0;q<g.length;++q)f.ia[h][q]=parseInt(g[q])}f.a=
{};l=d.getElementsByTagName("properties")[0];if(void 0!=l)for(let q of l.getElementsByTagName("property"))void 0!=q.getAttribute("name")&&(f.a[q.getAttribute("name")]=q.getAttribute("value"))}e[b]=f;++a.loaded})}function Ca(a,b,c){++a.total;let d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=()=>{a.a.ga.decodeAudioData(d.response,e=>{++a.loaded;a.v[b]=new xa(a.a.ga,e)})};d.send(null)}function Da(a,b,c){++a.total;za(a,c,"json",d=>{a.Z[b]=JSON.parse(d);++a.loaded})}
function Ea(a){return 0==a.total||a.loaded>=a.total}class Ia{constructor(a){this.B={};this.Pb={};this.v={};this.Z={};this.loaded=this.total=0;this.a=a}load(a){ya(this,a)}};function I(a,b,c){a.c&&b.play(a.ga,a.Yb*c,!1,0)}function Ja(a,b,c,d){a.c&&(null!=a.a&&(a.a.stop(),a.a=null),c=1*c,b.Oa(a.ga,null==d?c:.01,c,!0,0,d),a.a=b)}function Ka(a){a.c&&null!=a.a&&a.a.pause(a.ga)}function La(a){a.c&&null!=a.a&&a.a.resume(a.ga)}function J(a){a.c&&null!=a.a&&(a.a.stop(a.ga),a.a=null)}class Ma{constructor(){this.ga=new AudioContext;this.a=null;this.Yb=1;this.c=!1}toggle(a){this.c=a}};function Na(a,b){!a.m&&a.active&&3==a.mode&&a.Oa&&a.l(b)}
class Oa{constructor(){this.c=0;this.bb=()=>{};this.a=new x;this.active=!1;this.speed=1;this.Oa=!1;this.i=this.mode=0;this.D=new r(80,72);this.m=!1;this.g=document.createElement("canvas");this.g.getContext("2d").imageSmoothingEnabled=!1;this.l.width=160;this.l.height=144}J(a,b,c,d,e,f){void 0==f?this.a=new x:this.a=f.clone();this.i=e;this.Oa=a;this.speed=c;this.c=1;this.bb=d;this.mode=b;this.active=!0;this.m=!1}update(a){this.active&&0>=(this.c-=this.speed*a.step)&&(0==(this.Oa=!this.Oa)?(this.c+=
1,this.bb(a),this.m=!1):(this.active=!1,this.c=0))}u(a){if(this.active&&-1!=this.mode){this.m||!this.active||3!=this.mode||this.Oa||this.l(a);a.moveTo(0,0);var b=this.c;this.Oa&&(b=1-b);var c=this.D.x,d=this.D.y;switch(this.mode){case 0:null!=this.i&&(b=Math.round(b*this.i)/this.i);B(a,this.a.r,this.a.ub,this.a.rb,b);a.fillRect(0,0,a.width,a.height);break;case 1:var e=Math.max(Math.hypot(c,d),Math.hypot(a.width-c,d),Math.hypot(a.width-c,a.height-d),Math.hypot(c,a.height-d));e*=1-b;B(a,this.a.r,this.a.ub,
this.a.rb,1);b=e;var f=a.ga;if(0>=b)f.fillRect(0,0,a.width,a.height);else if(!(b*b>=a.width*a.width+a.height*a.height)){null==c&&(c=a.width/2);null==d&&(d=a.height/2);var g=Math.max(0,d-b)|0;e=Math.min(a.height,d+b)|0;0<g&&f.fillRect(0,0,a.width,g);e<a.height&&f.fillRect(0,e,a.width,a.height-e);for(let l=g;l<e;++l){var h=l-d;Math.abs(h)>=b?f.fillRect(0,l|0,a.width|0,1):(g=Math.round(c-Math.sqrt(b*b-h*h)),h=Math.round(c+Math.sqrt(b*b-h*h)),0<g&&f.fillRect(0,l|0,g|0,1),h<a.width&&f.fillRect(h|0,l|0,
a.width-g|0,1))}}break;case 2:e=Math.round(a.height/2*b);B(a,this.a.r,this.a.ub,this.a.rb);a.fillRect(0,0,a.width,e);a.fillRect(0,a.height-e,a.width,e);break;case 3:a.clear(0,0,0);for(d=0;d<this.l.height;++d)e=Math.sin((d/this.g.height*this.i.y+b)*Math.PI*2)*this.i.x*b,C(a,this.g,0,d,this.g.width,1,-e,d,0);break;case 4:if(e=Math.max(Math.hypot(c,d),Math.hypot(a.width-c,d),Math.hypot(a.width-c,a.height-d),Math.hypot(c,a.height-d)),e*=b,B(a,this.a.r,this.a.ub,this.a.rb,1),b=e,!(0>=b))if(b*b>=a.width*
a.width+a.height*a.height)a.fillRect(0,0,a.width,a.height);else for(f=Math.max(0,d-b)|0,e=Math.min(a.height,d+b)|0;f<e;++f)g=f-d,g=2*(Math.sqrt(b*b-g*g)|0),a.fillRect(c-g/2,f,g,1)}B(a)}}ca(){this.active=!1}l(a){this.g.width=a.width;this.g.height=a.height;this.g.getContext("2d").drawImage(a.canvas,0,0);this.m=!0}};class Pa{constructor(){this.da="figure"}};function Qa(a,b){var c=b.width/4;let d=c/8;b.clear(0,0,0);a=a.o;var e=0==a.total?0:a.loaded/a.total;a=b.width/2-c/2;let f=b.height/2-d/2;a|=0;f|=0;B(b,255,255,255);b.fillRect(a-2,f-2,c+4,d+4);B(b,0);b.fillRect(a-1,f-1,c+2,d+2);c=c*e|0;B(b,255);b.fillRect(a,f,c,d)}
class Ra{constructor(a,b,c){this.i=this.c=this.C=0;this.audio=new Ma;this.o=new Ia(this.audio);this.canvas=new ia(a,b,this.o.B);this.U=new Oa;this.Va=new Pa;this.a={step:c+1,o:this.o,audio:this.audio,U:this.U,input:pa(pa(pa(pa(new sa,"left","ArrowLeft",14,null),"up","ArrowUp",12,null),"right","ArrowRight",15,null),"down","ArrowDown",13,null),za:d=>this.za(d),wait:d=>{this.i=d},Va:this.Va};this.g=new H(this.a,null);this.l=!1;this.m=this.g}loop(a){const b=16.66667*this.a.step;this.c+=a-this.C;this.c=
Math.min(5*b,this.c);this.C=a;a=this.c/b|0;let c=Ea(this.o);c&&!this.l&&(this.g=new this.m.prototype.constructor(this.a,null),this.m=null,this.l=!0);for(;0<a--;)this.canvas.update(this.a),this.U.update(this.a),this.a.input.Ob(),c&&(0>=this.i?this.g.refresh(this.a):this.i-=this.a.step),this.a.input.zb(),this.c-=b;Ea(this.o)?(Na(this.U,this.canvas),this.g.Ua(this.canvas),this.U.u(this.canvas)):Qa(this,this.canvas);window.requestAnimationFrame(d=>this.loop(d))}za(a){this.g=new a.prototype.constructor(this.a,
this.g.Eb())}};function K(a,b,c,d,e,f){b|=0;c|=0;d|=0;e|=0;if(c==d)a.g=0,a.c=c,a.a=b;else{a.a!=b&&(a.g=0,a.c=d>c?c:d,a.a=b);if(c<d&&a.c<c||c>d&&a.c>c)a.c=c;a.g+=f;a.g>e&&(c<d?++a.c>d&&(a.c=c):--a.c<d&&(a.c=c),a.g-=e)}}function M(a,b,c){a.c=b;a.a=c;a.g=0}class N{constructor(a,b){this.width=a;this.height=b;this.g=this.a=this.c=0}u(a,b,c,d,e){C(a,b,this.width*this.c,this.height*this.a,this.width,this.height,c,d,e)}};class O{constructor(a,b,c){this.text=a;this.bb=b;this.ic=c;this.disabled=!1}}
class Sa{constructor(a,b,c){this.buttons=[];for(let d of c)this.buttons.push(d);this.width=8*(Math.max(...this.buttons.map(d=>d.text.length))+1);this.height=this.buttons.length*a;this.ra=0;this.active=!!b;this.offset=a}J(a){null!=a&&(this.ra=a);this.active=!0}ca(){this.active=!1}update(a){if(this.active){var b=this.ra;qa(a.input)?--this.ra:ra(a.input)&&++this.ra;this.ra=k(this.ra,this.buttons.length);this.ra!=b&&I(a.audio,a.o.v.next,.6);b=this.buttons[this.ra];if(a.input.actions.start.state==F||a.input.actions.fire1.state==
F)b.disabled||null==b.bb||b.bb(a),I(a.audio,a.o.v[b.ic||b.disabled?"deny":"accept"],.6)}}u(a,b,c){if(this.active){b-=this.width/2;c-=this.height/2;for(let f=0;f<this.buttons.length;++f){var d=this.buttons[f].disabled?"fontGray":this.ra==f?"fontYellow":"font";var e=this.ra==f?"@":" ";e+=this.buttons[f].text;D(a,a.B[d],e,b,c+f*this.offset,0,0,!1)}}}};function Ta(a){a.b=a.m.clone();a.target=a.b.clone();a.T=a.b.clone();a.fa=!1;a.a=0;a.yb=0}function Ua(a,b){b.moveTo(-Math.round(a.T.x*a.width),-Math.round(a.T.y*a.height))}function Va(a,b){if(void 0==b.f)return!1;let c=a.T.x*a.width,d=a.T.y*a.height;return b.b.x+b.f.width/2>=c&&b.b.y+b.f.height/2>=d&&b.b.x-b.f.width/2<c+a.width&&b.b.y-b.f.height/2<d+a.height}
class Wa{constructor(a,b,c,d,e,f,g){this.b=new r(a,b);this.target=this.b.clone();this.T=this.b.clone();this.m=this.b.clone();this.width=c;this.height=d;this.fa=!1;this.yb=this.a=0;this.sa=e;this.i=f;this.g=g;this.c=this.Pa=!1}move(a,b,c){if(this.fa||!this.g&&(0==this.b.x&&0>a||this.b.x==this.sa-1&&0<a)||!this.l&&(0==this.b.y&&0>b||this.b.y==this.i-1&&0<b))return 0;this.a=1;this.yb=c;this.target.x=this.b.x+a|0;this.target.y=this.b.y+b|0;this.fa=!0;if(this.g&&0>this.target.x)return this.b.x+=this.sa,
this.target.x+=this.sa,this.Pa=!0,1;if(this.g&&this.target.x>=this.sa)return this.b.x-=this.sa,this.target.x-=this.sa,this.Pa=!0,-1;this.Pa=!1;return 0}update(a){this.c=!1;this.fa&&(0>=(this.a-=this.yb*a.step)?(this.a=0,this.b=this.target.clone(),this.T=this.b.clone(),this.Pa=this.fa=!1):(a=this.a,this.T.x=a*this.b.x+(1-a)*this.target.x,this.T.y=a*this.b.y+(1-a)*this.target.y))}setPosition(a,b){this.b=new r(a,b);this.target=this.b.clone();this.T=this.b.clone();this.c=!0}};function P(a,b,c,d,e){return ca(a.b,a.D,a.L,b,c,d,e)}function Xa(a,b){return P(a,b.b.x-b.L.x/2,b.b.y-b.L.y/2,b.L.x,b.L.y)}function S(a){da(a.speed);da(a.target)}
class Ya{constructor(a,b){this.b=new r(a,b);this.hb=this.b.clone();this.speed=new r(0,0);this.target=this.speed.clone();this.a=new r(1,1);this.D=new r(0,0);this.L=new r(0,0);this.s=!0;this.F=this.R=!1;this.f=new N(0,0)}Ib(){}Ya(){}zb(){}gb(){return!0}update(a){this.s&&(this.F?this.R?this.gb(a)&&(this.R=this.s=!1):(this.hb=this.b.clone(),this.Ya(a),this.speed.x=ba(this.speed.x,this.target.x,this.a.x*a.step),this.speed.y=ba(this.speed.y,this.target.y,this.a.y*a.step),this.b.x+=this.speed.x*a.step,this.b.y+=
this.speed.y*a.step,this.zb()):this.Ib())}u(){}Ga(a){this.F=Va(a,this)}};function Za(a,b,c,d,e,f){if(!a.F||!f&&a.V||!a.s||a.R||0>a.speed.y)return!1;f=a.b.x+a.D.x-a.c.x/2;if(f+a.c.x<=b+1||f>=b+d-1)return!1;b=a.D.y+a.c.y/2;d=a.hb.y+b;return a.b.y+b>=c-1*e.step&&d<=c+(2+a.speed.y)*e.step?(a.b.y=c-b,a.ka(e),a.speed.y*=-a.ta,!0):!1}
function $a(a,b,c,d,e,f){if(!a.F||!f&&a.V||!a.s||a.R||0<a.speed.y)return!1;f=a.b.x+a.D.x-a.c.x/2;if(f+a.c.x<=b+1||f>=b+d-1)return!1;b=a.D.y-a.c.y/2;d=a.hb.y+b;return a.b.y+b<=c+1*e.step&&d>=c-(2-a.speed.y)*e.step?(a.b.y=c-b,a.Xa(e),a.speed.y*=-a.ta,!0):!1}
function T(a,b,c,d,e,f,g){!a.F||!g&&a.V||!a.s||a.R||0>a.speed.x*e||(g=a.b.y+a.D.y-a.c.y/2,g+a.c.y<=c+1||g>=c+d-1||(c=a.D.x+a.c.x/2*e,d=a.hb.x+c,g=a.b.x+c,!(0<e&&g>=b-1*f.step&&d<=b+(2+a.speed.x)*f.step||0>e&&g<=b+1*f.step&&d>=b-(2-a.speed.x)*f.step)))||(a.b.x=b-c,a.aa(e,f),a.speed.x*=-a.xa)}class ab extends Ya{constructor(a,b){super(a,b);this.c=this.L.clone();this.xb=this.V=!1;this.ta=this.xa=0}ka(){}aa(){}Xa(){}};class bb extends ab{constructor(){super(0,0);this.s=!1;this.f=new N(8,8);this.a=new r(.015,.1);this.ta=this.xa=.75;this.c=new r(4,4);this.D=new r(0,7);this.g=!0}ja(a,b,c,d,e){this.b=new r(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.target.y=4;this.s=!0;M(this.f,4*Math.random()|0,e);this.g=!0}Ib(){this.s=!1}u(a){this.s&&this.F&&this.f.u(a,a.B.chips,this.b.x-4,this.b.y+3,0)}ka(){!this.g&&.1>this.speed.y&&(this.s=!1);this.g=!1}};const cb=[1,4,8,2,9,6,3,5,12,10,7,13,14,11,15];class db{constructor(){this.b=new r(0,0);this.c=this.g=this.speed=this.a=0;this.s=!1}ja(a,b,c,d,e){this.a=0;this.speed=d;this.g=c;this.c=e;this.b=new r(a,b);this.s=!0}update(a,b){this.s&&16<=(this.a+=this.speed*b.step)&&(ua(a.ea,this.g,this.b.x,this.b.y+1,this.c+1),this.s=!1)}u(a){this.s&&C(a,a.B.tileset,this.c%16*16,16*(this.c/16|0),16,16,16*this.b.x,16*this.b.y+this.a|0,0)}}
function eb(a){a.ea=va(a.aa);a.h=va(a.V);for(let b of a.g)b.s=!1;for(let b of a.i)b.s=!1}
function fb(a,b,c,d){if(b.s&&b.F&&!b.R){var e=b.b.x/16|0,f=b.b.y/16|0,g=e-2,h=f-2;e+=4;f+=4;for(let V=0;V<a.ea.ia.length-1;++V)for(let W=h;W<=f;++W)for(let Q=g;Q<=e;++Q){var l=ta(a.ea,V,Q,W);if(0!=l){var m=a.h.ia[0][l-1];if(null!=m)if(0<m&&m<=cb.length)gb(b,m-1,Q,W,d);else{var q=a,t=b,z=m-1,w=l-1;l=Q;m=W;var y=V,G=c,u=d,A=[2,0,2,8],L=[8,2,0,2],Z=[12,8,12,8],R=[8,12,8,12];switch(z){case 15:void 0!=t.lb&&t.lb(16*l,16*m,16,16,u);break;case 16:case 17:case 18:case 19:void 0!=t.fb&&t.fb(16*l+A[z-16],16*
m+L[z-16],Z[z-16],R[z-16],3,u);break;case 20:case 21:case 22:case 23:case 24:if(void 0!=t.Kb&&(A=t.Kb(16*l+2,16*m,12,16,u)-1,2>A&&A>=z-20||2==A&&21!=z||0<=A&&23<=z)){ua(q.ea,y,l,m,0);{let Fa,Ga;A=q;L=16*l+8;Z=16*m+8;R=z-20;var aa=Math.random()*Math.PI;let ec=2*Math.PI/6;for(let Ha=0;6>Ha;++Ha)Ga=aa+ec*Ha,Fa=1.5*Math.random()+1,p(A.g,bb).ja(L,Z,Math.cos(Ga)*Fa,Math.sin(Ga)*Fa*1.75,R);I(u.audio,u.o.v["break"],.5)}20==z?(ta(q.ea,y,l,m-1)==w+1&&(ua(q.ea,y,l,m-1,0),z=l,A=m-1,p(q.i,db).ja(z,A,y,1,w)),hb(G,
16*l+8,16*m+8,t.b)):23==z?ib(q,l,m):24==z&&jb(q,l,m);break}gb(t,14,l,m,u);break;case 25:if(t.xb)break;T(t,16*l+4,16*m,16,1,u);T(t,16*l+12,16*m,16,-1,u);void 0!=t.fb&&t.fb(16*l+2,16*m,14,16,3,u);break;case 26:if(t.xb)break;Za(t,16*l,16*m+4,16,u);$a(t,16*l,16*m+8,16,u);void 0!=t.fb&&t.fb(16*l,16*m+2,16,14,3,u);break;case 27:void 0!=t.lb&&t.lb(16*l+8,16*m,16,16,u);break;case 29:void 0!=t.Ab&&t.Ab(16*l,16*m+8,16,8,!0,u);break;case 30:void 0!=t.Ab&&t.Ab(16*l,16*m+2,16,14,!1,u);break;case 31:Za(t,16*l,
16*(m+1),16,u);void 0!=t.lb&&t.lb(16*l,16*m+8,16,8,u,4);break;case 32:void 0!=t.$b&&t.$b(16*l,16*m,16,16)||gb(t,14,l,m,u)}}}}a.N||$a(b,-256,20,512+16*a.width,d,!0)}}function kb(a,b,c,d){lb(b,a.ea.ia[a.ea.ia.length-1],a.width,a.height,c,d)}function gb(a,b,c,d,e){b=cb[b|0];1==(b&1)&&Za(a,16*c,16*d,16,e);8==(b&8)&&$a(a,16*c,16*(d+1),16,e);4==(b&4)&&T(a,16*(c+1),16*d,16,-1,e,!1);2==(b&2)&&T(a,16*c,16*d,16,1,e,!1)}
function mb(a,b,c,d){b=10*(b/10|0);c=9*(c/9|0);let e;for(let f=0;f<a.ea.ia.length-1;++f)for(let g=c;g<c+9;++g)for(let h=b;h<b+10;++h)e=ta(a.ea,f,h,g),d(e,f,h,g)}function ib(a,b,c){mb(a,b,c,(d,e,f,g)=>{252!=d&&253!=d||ua(a.ea,e,f,g,252==d?253:252)})}function jb(a,b,c){mb(a,b,c,(d,e,f,g)=>{330!=d&&331!=d||ua(a.ea,e,f,g,0)})}
function nb(a){let b=Array(a.width*a.height).fill(0);for(let d=0;d<a.ea.ia.length-1;++d)for(let e=0;e<a.ea.ia[d].length;++e){var c=a.ea.ia[d][e]-1;c=a.h.ia[0][c]-1;29==c||30==c?b[e]=Math.max(b[e],1):0<=c&&14>=c?b[e]=Math.max(b[e],2):20<=c&&22>=c?b[e]=Math.max(b[e],3):15==c&&(b[e]=Math.max(b[e],4))}return{width:a.width,height:a.height,data:b}}
class ob{constructor(a,b){this.N=b;this.aa=a.Pb[b?"intro":"base"];this.V=a.Pb.collisions;this.ea=va(this.aa);this.h=va(this.V);this.width=this.ea.width;this.height=this.ea.height;this.l=this.H=this.C=0;this.g=[];this.i=[];this.K=new N(16,16);this.c=Array(2).fill(0);this.a=Array(2).fill(0);this.m=Array(3).fill(0)}update(a,b){const c=[.25,.5,1];this.C=(this.C+.5*b.step)%96;this.H=(this.H+1*b.step)%128;this.l=(this.l+.125*b.step)%16;if(this.N){{var d=[.3,.4];const e=[.2,.3],f=[.025,.03];let g;for(let h=
0;2>h;++h)g=d[h]+e[h]*Math.sin(this.a[h]),this.c[h]+=g*b.step,this.c[h]%=64,this.a[h]+=f[h]*b.step,this.a[h]%=2*Math.PI}for(d=0;d<this.m.length;++d)this.m[d]=(this.m[d]+c[d]*b.step)%160}for(let e of this.g)e.Ga(a),e.update(b),fb(this,e,null,b);for(let e of this.i)e.update(this,b);K(this.K,0,0,3,3,b.step)}u(a,b,c){let d=(10*b.T.x|0)-1;b=(9*b.T.y|0)-1;let e=(a.width/16|0)+2,f=(a.height/16|0)+2;for(let L=0;L<this.ea.ia.length-1;++L){{var g=void 0,h=void 0,l=void 0,m=a,q=a.B[c?"tilesetNight":"tileset"],
t=L,z=d,w=b,y=e,G=f;const Z=[133,329,330];for(let R=w;R<w+G;++R)for(let aa=z;aa<z+y;++aa)if(l=ta(this.ea,t,aa,R),0!=l--)if(Z.includes(l)){{var u=void 0;h=m;var A=q;g=aa;u=R;let V=l%16|0,W=l/16|0,Q=16*u;switch(l){case 133:Q+=1+Math.round(Math.sin(this.l/16*Math.PI*2));u=this.l|0;u%2!=Q%2&&++V;C(h,A,16*V+u,16*W,16-u,16,16*g,Q,0);0<u&&C(h,A,16*V,16*W,u,16,16*(g+1)-u,Q,0);break;case 329:case 330:A=this.K,C(h,h.B.electricity,A.width*this.K.c,A.height*(l-329),A.width,A.height,16*g,16*u,0)}}}else h=l%16|
0,g=l/16|0,C(m,q,16*h,16*g,16,16,16*aa,16*R,0)}}for(let L of this.i)L.u(a);for(let L of this.g)L.u(a)}nb(a,b,c){a.moveTo(0,-Math.round(b.T.y*b.height));if(this.N){if(!c){{c=[16,24];var d=a.width/64|0;let e=a.height/64|0,f,g,h;for(let l=0;2>l;++l){h=Math.sin(this.a[l])*c[l];f=k(this.c[l]*l+b.T.x*a.width,64);g=this.c[l];for(let m=-1;m<d+1;++m)for(let q=-1;q<e+1;++q)C(a,a.B.ash,0,64*l,64,64,64*m-f+h,64*q+g,0)}}}}else if(c=k(this.H+10*b.T.x,128),d=a.B.darkClouds,!(9*b.T.y>d.height+-8))for(b=0;3>b;++b)ha(a,
d,-c+b*d.width,-8)}};function pb(a,b){a.R=!0;S(a);I(b.audio,b.o.v.hit2,.5)}
class qb extends ab{constructor(){super(0,0);this.s=!1;this.f=new N(16,16);this.c=new r(2,2);this.L=new r(6,6);this.a=new r(.05,.05);this.g=1;this.xb=!0}ja(a,b,c,d,e,f,g){this.b=new r(a,b);this.speed=new r(c,d);this.target=this.speed.clone();f&&(this.target.y=2);this.g=null==g?1:g;M(this.f,0,e);this.s=!0;this.V=[2,3,5,6,7].includes(e)}gb(a){K(this.f,this.f.a,4,8,4,a.step);return 8==this.f.c}Ya(a){K(this.f,this.f.a,0,3,4,a.step)}Ib(){this.s=!1}u(a){this.s&&this.F&&this.f.u(a,a.B.bullets,this.b.x-8,
this.b.y-8,0)}ka(a){pb(this,a)}Xa(a){pb(this,a)}aa(a,b){pb(this,b)}Ia(a,b){!this.s||!this.F||this.R||0<a.S||0>=this.g||!Xa(a,this)||(a.dir=a.b.x<this.b.x?1:-1,a.wb(this.g,b),pb(this,b))}};class U{constructor(a,b){this.b=new r(a,b);this.f=new N(16,16);this.F=!1;this.c=0;this.aa=this.C=this.disabled=!1;this.L=new r(16,16);this.s=!0}Ga(a){this.F=this.F&&a.Pa&&a.fa||Va(a,this)}j(){}i(){}m(){}Ia(a,b,c,d){this.disabled||!this.F||b.R||(this.m(b),!this.C&&null!=d&&P(b,this.b.x-this.L.x/2,this.b.y-this.L.y/2,this.L.x,this.L.y)&&(this.j(b,d),b.M&&(b.Wa=!0,b.Bb=0,qa(d.input)&&(this.aa||I(d.audio,d.o.v.activate,.5),b.Wa=!1,this.i(a,b,c,d)))))}g(){}u(a,b){if(this.F&&this.s){var c=b.sa*b.width,
d=0,e=0;b.fa&&b.Pa&&(d=-1,e=1);for(b=d;b<=e;++b)a.move(b*c,0),this.g(a),a.move(-b*c,0)}}};function rb(a,b,c){switch(a){case 0:a=c.progress;a.Y+=2;a.oa+=2;break;case 1:sb(c.progress,b);break;case 2:a=c.progress;a.keys+=1;break;case 3:a=c.progress;a.Ba+=1;break;case 4:tb(c.progress)}}function ub(a,b,c,d,e,f){var g=["heart","item","key","orb","potion"];let h=g[c]+"Name";g=g[c]+"Desc";1==c?(c=a.obtain+" "+a[h][d],d=a[g][d]):(c=a.obtain+" "+a[h],d=a[g]);a=-1;void 0!=e&&void 0!=f&&(a=f-(e+1));X(b,c);for(let l of d)e=0<=a?l.replace("%",String(a)):l,X(b,e)}
class vb extends U{constructor(a,b,c,d){super(a,b);this.l=this.a=!1;this.type=c;this.id=d;this.c=0;M(this.f,((a/16|0)+(b/16|0))%4,2*this.type);this.h=0;this.L=new r(12,16);this.H=0}Hb(a){this.H=a}update(a){this.F&&!this.a&&(this.l||K(this.f,2*this.type,0,3,8,a.step))}g(a){this.F&&this.f.u(a,a.B.chest,this.b.x-8,this.b.y-8,this.c)}i(a,b,c,d){this.l||this.a||(c=d.o.Z.en,wb(b,this.b.x,this.b.y,b.b.x<this.b.x?-1:1),this.disabled=this.l=!0,M(this.f,0,1+2*this.type),Ka(d.audio),ub(c,a,this.type,this.id,
3==this.type?b.progress.Ba:null,3==this.type?this.H:null),xb(a,e=>{if(0<this.h)return 0>=(this.h-=e.step);K(this.f,2*this.type+1,0,4,3==this.f.c?30:6,e.step);4==this.f.c&&(this.a=!0,this.l=!1,this.h=60,M(this.f,3,2*this.type+1),yb(b,this.type,1==this.type?this.id:0),I(e.audio,e.o.v.treasure,.5));return!1}).J(e=>{La(e.audio);rb(this.type,this.id,b);b.progress.Qa[this.type][this.id]=!0},!1))}m(a){this.c=a.b.x<this.b.x?0:1}wa(a){if(this.a=a.Qa[this.type][this.id])this.l=!1,this.disabled=!0,M(this.f,
3,1+2*this.type)}dc(){return this.a&&!this.l}};function sb(a,b){a.I[b]=!0;13==b&&zb(a,50)}function tb(a){a.Y=a.oa}function Ab(a,b,c){null==a.Sa&&(a.Sa=Array(b*c).fill(!1));a.a=b;a.c=c}
function Bb(a,b){a.oa=b.maxHealth;a.Y=b.health;a.mb=!!b.nightOrbActivated;a.na=!!b.isNight;a.N=!!b.isIntro;a.Xb=Number(b.gems)|0;a.eb=Number(b.coins)|0;a.keys=Number(b.keys)|0;a.Ba=Number(b.orbs)|0;a.pa=Number(b.stars)|0;if(void 0!=b.openedChests)for(let c=0;c<a.Qa.length;++c)a.Qa[c]=Array.from(b.openedChests[c]);void 0!=b.openedDoors&&(a.Gb=Array.from(b.openedDoors));void 0!=b.boughtItems&&(a.Ta=Array.from(b.boughtItems));void 0!=b.obtainedItems&&(a.I=Array.from(b.obtainedItems));void 0!=b.visitedRooms&&
(a.Sa=Array.from(b.visitedRooms));void 0!=b.collectedStars&&(a.Db=Array.from(b.collectedStars))}function Cb(a){a.Y=6;a.I[12]&&(a.Y=Math.min(a.oa,12));a.Mb=!1}function zb(a,b){a.eb+=b}
class Db{constructor(){this.Y=this.oa=6;this.Ba=this.keys=this.eb=this.Xb=0;this.Qa=Array(4);for(let a=0;a<this.Qa.length;++a)this.Qa[a]=Array(4).fill(!1);this.Gb=Array(16).fill(!1);this.Db=Array(16).fill(!1);this.pa=0;this.Ta=Array(10).fill(!1);this.I=Array(32).fill(!1);this.Sa=null;this.c=this.a=0;this.N=!0;this.Mb=this.na=this.mb=!1}removeItem(a){this.I[a]=!1}Nb(a,b){this.N||(a=k(a,this.a),b=k(b,this.c),this.Sa[b*this.a+a|0]=!0)}};class Eb extends ab{constructor(){super(0,0);this.s=!1;this.f=new N(16,16);this.a=new r(.01,.05);this.ta=this.xa=.75;this.c=new r(4,8);this.L=new r(8,8);this.D.y=-1;this.id=0;this.g=!1;this.i=!0}ja(a,b,c,d,e){this.b=new r(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.s=!0;this.id=e;M(this.f,0,e);this.g=!1;this.i=!0}Ya(a){this.a.x=.01;this.a.y=.05;this.target.y=2;this.g&&(this.i&&(this.speed.x/=2,this.speed.y/=2,this.i=!1),this.a.x/=2,this.a.y/=2,this.target.y/=2);this.g=!1;K(this.f,this.f.a,
0<=this.speed.x?0:3,0<=this.speed.x?3:0,6,a.step)}u(a){this.s&&this.F&&this.f.u(a,a.B.collectibles,this.b.x-8,this.b.y-8,0)}sb(a,b){this.Ga(a);this.F?a.fa||(T(this,a.T.x*a.width,a.T.y*a.height,a.height,-1,b),T(this,(a.T.x+1)*a.width,a.T.y*a.height,a.height,1,b)):this.s=!1}Ia(a,b,c){if(this.s){var d=1;if(Xa(a,this)){1==this.id&&a.progress.I[19]&&(d=2);if(0==this.id)zb(a.progress,1);else{var e=a.progress,f=2;e.I[19]&&(f*=2);e.Y=Math.min(e.oa,e.Y+f)}this.s=!1;I(c.audio,c.o.v[["coin","heal"][this.id]],
.6);c=a.b.x;a=a.b.y+a.D.y-a.f.height/2;d="+"+String.fromCharCode(64+n(d,0,9))+String.fromCharCode(33+this.id);p(b.tb,Fb).ja(c,a,1,16,30,d)}}}Ab(a,b,c,d){return P(this,a,b,c,d)?this.g=!0:!1}};class Gb extends U{constructor(a,b,c,d){super(a,b);this.active=!1;this.Lb=c;this.Jb=null;this.f=new N(32,32);this.L=new r(8,32);this.id=d;this.bc=!0;this.a=this.l=c}update(a){if(this.disabled=this.l&&!this.a)K(this.f,0,0,4,8,a.step),this.a=4==this.f.c;this.aa=this.l&&this.a}g(a){this.F&&!this.a&&this.f.u(a,a.B.door,this.b.x-16,this.b.y-16,0)}i(a,b,c,d){let e=d.o.Z.en;this.l?(b.progress.N&&J(d.audio),d.U.J(!0,1,1/30,f=>{let g=this.Jb.b.clone();g.y+=8;b.moveTo(g,c);Hb(b,!0);b.progress.N&&(b.progress.Mb=
!0,Ja(f.audio,f.o.v.finalboss,.375,2E3));f.U.D=new r(b.b.x%160,b.b.y%144)},null,new x(0,0,0)),d.U.D=new r(this.b.x%160,this.b.y%144),b.b.x=this.b.x,Hb(b,!1),I(d.audio,d.o.v.door,.7)):0>=b.progress.keys?X(a,e.needKey).J(()=>{},!1):X(a,e.openDoor).J(f=>{this.l=!0;this.a=!1;var g=b.progress;g.keys+=-1;b.progress.Gb[this.id]=!0;b.kb=32;I(f.audio,f.o.v.open,.8)},!0)}wa(a){a.N?this.Lb?this.C=this.disabled=!0:this.l=this.a=!0:this.a=this.l=a.Gb[this.id]}};function Ib(a,b){a.la=b}function Jb(a){a.S=0;a.Y=0;a.R=!0;a.g=0;M(a.f,0,0)}function Kb(a,b,c){b.move(c,0);a.qb(b);a.f.u(b,b.B.enemies,Math.round(a.b.x+a.H.x-a.f.width/2),Math.round(a.b.y+a.H.y-a.f.height/2),a.g);b.move(-c,0)}
class Y extends ab{constructor(a,b,c,d,e){super(a,b);this.K=this.b.clone();this.f=new N(16,16);M(this.f,0,c+1);this.Y=this.oa=d;this.kc=e;this.S=0;this.ec=this.Vb=-1;this.dir=1;this.g=0;this.M=!1;this.a=new r(.1,.1);this.m=1;this.L=new r(8,8);this.c=new r(8,8);this.H=new r(0,0);this.ma=!1;this.la=()=>{};this.xb=this.Fb=this.La=this.Tb=this.Ub=this.ua=this.Ha=!1}X(){}l(){}i(){}C(){}ac(){}ya(){}fc(){}gb(a){K(this.f,0,0,4,6,a.step);return 4<=this.f.c}J(){this.V=this.ma=!1;this.b=this.K.clone();this.X(this.K.x,
this.K.y)}Ya(a){this.ma||(this.l(a),this.i(a),0<this.S&&(this.S-=a.step))}zb(){this.M=!1}wb(a,b,c,d,e){this.Y-=b;this.Ha||(this.speed.x=this.m*a);this.S=30+this.S%2;0>=this.Y&&(this.ya(),this.ya(),Jb(this),hb(c,this.b.x,this.b.y+this.D.y,d.b));I(e.audio,e.o.v[this.R?"kill":"hit"],.6);a=this.b.x;d=this.b.y+this.D.y-this.f.height/2;p(c.tb,Fb).ja(a,d,1,16,30,"-"+String(b))}Ia(a,b,c){if(this.s&&!this.R&&this.F&&!this.Tb&&!this.ma&&(this.C(a),0>=this.S&&!this.Ub&&a.fb(this.b.x+this.D.x-this.L.x/2,this.b.y+
this.D.y-this.L.y/2,this.L.x,this.L.y,this.kc,c)&&this.ac(c),!this.ua))if(Lb(a)&&a.Cb>this.Vb&&ca(this.b,this.D,this.L,a.Ca.x-a.Ra.x/2,a.Ca.y-a.Ra.y/2,a.Ra.x,a.Ra.y)){var d=a.progress.I[23]?3:2;a.ha?++d:a.Ja&&(d*=2);this.wb(a.ha?0:2*a.dir*(a.Ja?1.5:1),d,b,a,c);this.Vb=a.Cb;!this.R&&a.Ja&&0<a.ba&&(a.speed.x=0,a.target.x=0);a.ha&&(a.ha=!1,a.va=4,a.Na=!1)}else a.W.s&&a.W.vb>this.ec&&Xa(this,a.W)&&(this.wb(2*(this.b.x<a.W.b.x?-1:1),a.progress.I[24]?2:1,b,a.W,c),b=a.W,b.m||b.g||(S(b),b.l=0,b.g=!0),this.ec=
a.W.vb)}qb(){}u(a,b){this.ma||!this.s||!this.F||0<this.S&&0==Math.floor(this.S/2)%2||(Kb(this,a,0),b.fa&&(Kb(this,a,b.sa*b.width),Kb(this,a,-b.sa*b.width)))}ka(){this.M=!0}sb(a,b){if(this.s){var c=this.F;this.F=this.F&&a.Pa&&a.fa||Va(a,this);if(!this.F){if(this.R){this.s=!1;return}this.ma&&this.J()}!this.R&&this.F!=c&&c&&(this.b=this.K.clone(),S(this),this.Y=this.oa,this.S=0,this.V=this.ma=!0);if(!a.fa&&this.F){c=a.T.x*a.width;var d=a.T.y*a.height;T(this,c,d,a.height,-1,b,!0);T(this,c+a.width,d,a.height,
1,b,!0);this.La&&(Za(this,c,d+a.height,a.width,b,!0),$a(this,c,d,a.width,b,!0))}}}Aa(){}};function Mb(a,b,c,d,e){const f=[[0,0,0],[255,255,255][0,0,0],[0,85,170]];let g=f.length-1;for(let h=0;h<f.length;++h,--g)B(a,f[h][0],f[h][1],f[h][2],1),a.fillRect(b-g,c-g,d+2*g,e+2*g)};function X(a,b){b=10==b.charCodeAt(b.length-1)?b.substr(0,b.length-1):b;a.a.push(b);a.m.push(Nb(b));return a}function xb(a,b){a.V=b;return a}function Nb(a){let b=new r(0,0);a=a.split("\n").map(c=>c.length);b.x=8*Math.max(...a);b.y=10*a.length;return b}
class Ob{constructor(a){a=a.o.Z.en;this.a=[];this.m=[];this.c=this.g=this.char=0;this.active=!1;this.K=0;this.l=()=>{};this.i=!1;this.V=()=>!0;this.H=new Sa(12,!0,[new O(a.yes,b=>{this.ca();this.l(b)},!1),new O(a.no,()=>{this.ca()},!0)]);this.h=this.C=!1}J(a,b){this.active=!0;this.c=this.g=0;this.l=a;this.i=!1;this.C=b;this.h=!1;this.H.J(1)}update(a){if(this.active){var b=a.input.ib();if(!this.i&&(this.i=this.V(a),!this.i))return;this.h=this.c==this.a[0].length&&1==this.a.length;this.c<this.a[0].length?
b?this.c=this.a[0].length:2<=(this.g+=1*a.step)&&(this.g-=2,++this.c,a=this.a[0].charCodeAt(this.c),this.c<this.a[0].length&&"\n"==a&&++this.c):1==this.a.length&&this.C?this.H.update(a):(b&&(this.a.shift(),this.m.shift(),this.g=this.c=0,I(a.audio,a.o.v.next,.6),0==this.a.length&&(this.ca(),null!=this.l&&this.l(a))),this.K=(this.K+.1*a.step)%(2*Math.PI))}}u(a,b){if(this.active&&this.i){var c=this.m[0].x+4,d=this.m[0].y+4,e=a.width/2-c/2,f=a.height/2-d/2;b&&Mb(a,e,f,c,d);D(a,a.B.font,this.a[0].substr(0,
this.c),e+2,f+2,0,2,!1);this.h&&this.C?(c=e+c-20,b=f+d+14,Mb(a,c-18,b-12-2,36,24),this.H.u(a,c,b)):this.c==this.a[0].length&&(b=Math.round(Math.sin(this.K))|0,C(a,a.B.font,24,0,8,8,e+c-8,f+d-4+b,!1))}}ca(){this.active=!1;this.V=()=>!0;this.a.length=0;this.m.length=0}};class Pb extends H{constructor(a,b){super(a,b);this.a=0;this.c=new N(96,64);this.c.c=-1;this.g=new N(96,32);M(this.g,-1,2);b=a.o.Z.en;this.message=new Ob(a);for(let c of b.ending)X(this.message,c)}refresh(a){0==this.a?(K(this.c,0,0,3,10,a.step),3==this.c.c&&(++this.a,this.message.J(b=>{++this.a;Ja(b.audio,b.o.v.titleScreen,.15,2E3)}))):1==this.a?this.message.update(a):2==this.a&&(K(this.g,2,-1,3,10,a.step),3==this.g.c&&++this.a)}Ua(a){a.clear(255,255,255);0<this.c.c&&this.c.u(a,a.B.ending,a.width/
2-this.c.width/2,64,0);this.message.active&&(B(a,170,170,170),a.fillRect(7,26,146,28),a.moveTo(0,-32),this.message.u(a,!1),a.moveTo(0,0));0<this.g.c&&this.g.u(a,a.B.ending,a.width/2-this.g.width/2,16,0)}};function Qb(a,b){let c;for(let d=0;8>d;++d)c=2*Math.PI/8*d,a.la(a.b.x,a.b.y+a.D.y,2*Math.cos(c),2*Math.sin(c),6,!1,0);I(b.audio,b.o.v.hit,.6)}function Rb(a,b){a.Zb=b}
function Sb(a,b){[c=>{{let d;for(let e=0;8>e;++e)d=2*Math.PI/8*e,a.la(a.b.x,a.b.y,.75*Math.cos(d)*a.h,.75*Math.sin(d)*a.h,3,!1,3);I(c.audio,c.o.v.snowball,.6)}},c=>{{const d=Math.PI/12;let e;for(let f=-3;3>=f;++f)e=d*f-Math.PI/2,a.la(a.b.x,a.b.y,1.5*-Math.cos(e)*a.h,2*Math.sin(e)*a.h,5,!0,3);I(c.audio,c.o.v.snowball,.6)}},c=>{{const d=[.75,.5],e=Math.PI/10;let f,g=Math.atan2(a.j.y-a.b.y,a.j.x-a.b.x),h;for(let l=-3;3>=l;++l)f=g+e*l,h=d[k(l,2)]*a.h,a.la(a.b.x,a.b.y,Math.cos(f)*h,Math.sin(f)*h,7,!1,
3);I(c.audio,c.o.v.snowball,.6)}}][a.qa](b)}function Tb(a,b){[()=>{{let c=v(new r(a.j.x-a.b.x,a.j.y-a.b.y));a.speed.x=1.5*c.x*a.h;a.speed.y=1.5*c.y*a.h;a.a.x=.005;a.a.y=.005;a.Ha=!1}},()=>{a.speed.x=.33*Math.sign(a.j.x-a.b.x)*a.h;a.target.y=4*a.h;a.a.y=.125*a.h;a.a.x=0;a.Ha=!1},()=>{a.ab=!0;a.a.x=.02*a.h;a.a.y=.02*a.h;a.Ha=!1}][a.qa](b)}
class Ub extends Y{constructor(a,b){super(a,b,-1,64,4);this.f=new N(64,32);this.L=new r(32,16);this.c=new r(56,30);this.P=this.cc=!0;this.$=!1;this.Fa=0;this.ta=this.xa=1;this.$a=160*Math.floor(a/160);this.jc=144*Math.floor(b/144);this.G=-1;this.qa=0;this.j=new r;this.a.x=.01;this.a.y=.01;this.m=.5;this.A=1;this.Wb=this.ab=this.Ea=!1;this.h=1;this.Rb=()=>{};this.Da=600;this.Zb=()=>{};this.Qb=!1;this.Za=this.Ka=0}gb(a){if(!this.Qb)return J(a.audio),I(a.audio,a.o.v.error,.7),a.wait(60),this.Zb(),this.Qb=
!0,!1;0>=(this.Ka-=a.step)&&(this.Ka+=30,++this.Za,6>this.Za&&(this.Ea=!0,Qb(this,a)));6<=this.Za&&(I(a.audio,a.o.v.destroy,.7),a.U.J(!0,4,1/120,b=>{b.za(Pb);b.U.ca()},null,new x(255,255,255)),a.U.D=new r(this.b.x%160|0,this.b.y%144|0));return!1}X(){M(this.f,-2,2);this.P=!0;this.$=!1;this.Fa=180;this.Ha=!0}fc(a){this.Rb=a}l(a){var b=this.Y/this.oa;this.A>b&&(this.A-=.005*a.step,this.A<b&&(this.A=b));this.h=1+.5*(1-this.Y/this.oa);this.Wb||(I(a.audio,a.o.v.appear,.6),this.Wb=!0);0>=(this.Da-=this.h*
a.step)&&(this.Da+=600,b=this.j.x>this.$a+80?1:-1,this.Rb(this.$a+(0<b?-6:166),32+Math.floor(96*Math.random()),b));this.Tb=this.ua=this.P||this.$;this.$||this.P||(0>=(this.Fa-=this.h*a.step)?(S(this),this.$=!0,this.f.a=0==this.f.c?1:2,I(a.audio,a.o.v.disappear,.6)):this.ab&&(a=v(new r(this.j.x-this.b.x,this.j.y-this.b.y)),this.target.x=1.5*a.x*this.h,this.target.y=1.5*a.y*this.h))}i(a){var b=this.f.c;if(this.$){if(K(this.f,this.f.a,3,-2,8,a.step),-2==this.f.c){{b=this.$a+this.f.width/2+(Math.random()*
(160-this.f.width)|0);let c=this.jc+10+this.f.height/2+(Math.random()*(118-this.f.height)|0);this.P=!0;this.$=!1;this.Fa=180;this.b=new r(b,c);this.G=.5>Math.random()?0:1;this.qa=Math.floor(3*Math.random());this.f.a=1==this.G?1:2;this.a.x=.01;this.a.y=.01;this.Ha=!0;this.ab=!1;if(0==this.G)switch(this.qa){case 1:this.b.y=this.f.height/2}}I(a.audio,a.o.v.appear,.6)}}else this.P?(K(this.f,this.f.a,-2,3,8,a.step),3==this.f.c&&(this.P=!1,M(this.f,1==this.f.a?0:3,0),0==this.G&&Tb(this,a))):1==this.G&&
3>this.f.c&&(K(this.f,0,0,3,6,a.step),this.f.c>b&&2==this.f.c&&1==this.G&&Sb(this,a))}u(a){this.Ea&&(a.pb=60,a.ob=new r(2,2),this.Ea=!1);0>this.f.c||0<this.S&&0==Math.floor(this.S/4)%2||this.f.u(a,a.B.eye,Math.round(this.b.x-this.f.width/2),Math.round(this.b.y-this.f.height/2),0)}nb(a){if(this.F&&this.s&&!this.R){var b=Math.round(64*this.A),c=a.width/2-32,d=a.height-7;for(let e=2;0<=e;--e){switch(e){case 2:B(a,255,255,255);break;case 1:B(a,0,0,0);break;case 0:B(a,85,85,85)}a.fillRect(c-e,d-e,64+2*
e,3+2*e);0==e&&(B(a,170,0,0),a.fillRect(c,d,b,3),B(a,255,85,0),a.fillRect(c,d,b,1),0<this.A&&1>this.A&&(B(a,0,0,0),a.fillRect(c+b,d,1,3)))}}}C(a){this.j=a.b.clone()}ka(a){1==this.qa&&0==this.G&&(I(a.audio,a.o.v.quake,.4),this.Ea=!0)}};function Vb(a){const b=[Wb,Xb,Yb,Zb,$b,ac,bc,cc,dc,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,Ub];return b[n(a,0,b.length-1)|0]}
class Wb extends Y{constructor(a,b){super(a,b,0,3,2);this.a.x=.025;this.h=!0;this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.5}X(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.x=.25;this.speed.x=this.target.x}l(a){this.target.x=.25*this.dir;this.target.y=2;this.h&&!this.M&&0>=this.S&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.h=this.M}i(a){this.g=0<this.dir?1:0;this.M&&K(this.f,this.f.a,0,3,6,a.step)}aa(){this.speed.x*=-1;this.target.x*=-1;
this.dir*=-1}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class Xb extends Y{constructor(a,b){super(a,b,1,2,1);this.D.y=2;this.c=new r(4,12);this.H.y=1;this.a.y=.05;this.m=.5;this.h=0}X(a){this.h=60-(a/16|0)%2*30}l(a){this.target.y=2;this.M&&0>=(this.h-=a.step)&&(this.h+=60,this.speed.y=-1.75,I(a.audio,a.o.v.jump2,.5))}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);M(this.f,a,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:-1}}
class Zb extends Y{constructor(a,b){super(a,b,3,2,1);this.a.x=.1;this.j=!0;this.D.y=4;this.c=new r(4,8);this.L=new r(8,6);this.H.y=1;this.m=.5;this.h=!1}X(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}l(a){this.target.x=0;this.target.y=2;0!=this.f.c%2&&(this.target.x=.6*this.dir);!this.h&&this.j&&!this.M&&0>=this.S&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.j=this.M}i(a){this.g=0<this.dir?1:0;this.M?K(this.f,this.f.a,0,3,0==this.f.c%2?30:6,a.step):M(this.f,
2,this.f.a)}aa(a){this.dir=-a}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}C(a){this.h=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class Yb extends Y{constructor(a,b){super(a,b,2,3,2);this.D.y=2;this.c=new r(4,10);this.H.y=0;this.a.x=.05;this.a.y=.1;this.m=.5;this.j=60+(a/16|0)%2*30;this.h=1-(a/16|0)%2*2;this.xa=-1}X(){}l(a){this.target.y=4;this.M?(this.target.x=0,0>=(this.j-=a.step)&&(this.j+=60,this.speed.y=-2.5,this.target.x=.5*this.h,this.speed.x=this.target.x,this.dir=this.h,I(a.audio,a.o.v.jump2,.5))):this.dir=0<=this.speed.x?1:-1}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);M(this.f,
a,this.f.a)}C(a){this.h=a.b.x>this.b.x?1:-1;if(Lb(a)||a.W.s&&!a.W.g)this.h*=-1}aa(a){this.dir=-a}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.speed.x*=-1,this.dir*=-1}}
class $b extends Y{constructor(a,b){super(a,b,4,3,2);this.a.x=.05;this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.75;this.h=60;this.j=!0;this.G=0;this.A=1;this.P=0}X(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.h=60;this.j=!0}l(a){this.target.y=3;let b=this.A;0>=(this.h-=a.step)&&(this.h+=60,this.j&&(this.A+=this.G,this.G=b,20<=++this.P&&(this.P=0,this.A=1,this.G=0),this.dir=1-this.A%2*2,this.h+=(this.b.x|0)%60),this.j=!this.j);this.target.x=this.j?0:.5*this.dir}i(a){this.g=0<this.dir?1:
0;this.M?this.j?M(this.f,0,this.f.a):K(this.f,this.f.a,0,3,8,a.step):M(this.f,4,this.f.a)}aa(){this.j||(this.dir*=-1)}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}}
class ac extends Y{constructor(a,b){super(a,b,5,2,1);this.a.x=.015;this.a.y=.015;this.c=new r(4,4);this.m=.33;this.j=30;this.h=!0;this.A=new r(0,0);this.ta=this.xa=1}X(){}l(a){0>=(this.j-=a.step)&&(this.j+=this.h?60:30,this.h?(this.speed.x=.5*this.A.x,this.speed.y=.5*this.A.y):da(this.target),this.h=!this.h);this.h||(this.target=this.speed.clone())}i(a){K(this.f,this.f.a,0,3,this.h?5:3,a.step)}C(a){this.h&&(this.A=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0))}Aa(a){this.h||(a=v(new r(this.b.x-a.b.x,
this.b.y-a.b.y),!0),this.speed.x=.5*a.x)}}
class bc extends Y{constructor(a,b){super(a,b,6,3,2);this.a.x=.033;this.a.y=.033;this.c=new r(6,6);this.m=.5;this.j=new r(0,0);this.active=!1;this.h=0}X(){this.b.y-=4;this.active=!1;this.h=0}l(a){this.active&&(0<this.h?this.h-=a.step:(this.target.x=.33*this.j.x,this.target.y=.33*this.j.y))}i(a){this.active?0<this.h?M(this.f,1,this.f.a):K(this.f,this.f.a,1,4,6,a.step):M(this.f,0,this.f.a);this.g=0<this.h?2:0}C(a){if(this.active)this.j=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0);else if(this.active=
0<this.S||a.b.y>this.b.y&&48>Math.abs(a.b.x-this.b.x))this.h=30,this.target.y=1}}
class uc extends Y{constructor(a,b,c,d,e,f,g,h){super(a,b,c,d,e);this.a.x=.025;this.c=new r(8,8);this.L=new r(10,8);this.m=.5;this.h=0;this.P=f;this.qa=g;this.$=h}A(){}X(a,b){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.h=0;this.A(a,b)}G(){}l(a){this.target.x=this.$*this.dir;this.h=(this.h+this.qa*a.step)%(2*Math.PI);this.b.y=this.K.y+Math.round(Math.sin(this.h)*this.P);this.G(a)}aa(){this.speed.x*=-1;this.target.x*=-1;this.dir*=-1}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<
this.b.x)this.dir*=-1,this.speed.x*=-1,this.target.x*=-1}}class cc extends uc{constructor(a,b){super(a,b,7,3,2,2,.1,.125)}i(){this.g=0<this.dir?1:0;let a=1,b=Math.sin(this.h);-.5>b?a=0:.5<b&&(a=2);M(this.f,a,this.f.a)}}function vc(a,b){a.speed.y=-1;I(b.audio,b.o.v.jump2,.5)}
class dc extends Y{constructor(a,b){super(a,b,8,2,1);this.D.y=2;this.c=new r(4,12);this.H.y=1;this.a.y=.025;this.m=.5;this.h=0}X(a){this.h=60-(a/16|0)%2*30}l(a){const b=this.target.y/3;this.target.y=2;this.M?0>=(this.h-=a.step)&&vc(this,a):0>=this.h&&this.speed.y>=b&&vc(this,a)}i(){this.g=0<this.dir?1:0;let a=0;.25<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);M(this.f,a,this.f.a)}Xa(){this.h=60}}
class wc extends Y{constructor(a,b,c,d,e){super(a,b,c,d,e);this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.5;this.h=!1;this.j=60-(a/16|0)%2*30;this.P=!1}X(){}A(){}l(a){this.target.y=2;!this.h&&0>=(this.j-=a.step)&&(M(this.f,1,this.f.a),this.h=!0,this.j=60,this.A(a))}i(a){this.g=0<this.dir?1:0;this.h?(K(this.f,this.f.a,1,3,1==this.f.c?6:30,a.step),3==this.f.c&&(M(this.f,this.P?1:0,this.f.a),this.h=!1)):0!=this.f.c?K(this.f,this.f.a,1,0,6,a.step):M(this.f,0,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:
-1}}class fc extends wc{constructor(a,b){super(a,b,9,3,2)}A(a){this.la(this.b.x+4*this.dir,this.b.y,2*this.dir,0,0,!1,1);I(a.audio,a.o.v.snowball,.5)}}class gc extends uc{constructor(a,b){super(a,b,10,3,2,4,.1,.33);this.a.x=.025;this.m=.5}i(a){this.g=0<this.dir?1:0;K(this.f,this.f.a,0,3,4,a.step)}}function xc(a,b,c){a.h&&(a.speed.y=b,I(c.audio,c.o.v.jump2,.5))}
class hc extends Y{constructor(a,b){super(a,b,11,6,3);this.a.x=.025;this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.33;this.G=this.j=!1;this.A=0;this.h=!1}X(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}l(a){this.target.x=.33*this.dir;this.target.y=4;!this.M&&this.h&&0<this.speed.x/this.dir&&this.G&&xc(this,-2.5,a);(this.h=this.M)&&this.j&&xc(this,-n(this.A/16,1.75,2.75),a)}i(a){this.g=0<this.dir?1:0;let b=5;this.M?K(this.f,this.f.a,0,3,8,a.step):(-.5>this.speed.y?b=4:.5<this.speed.y&&(b=6),M(this.f,
b,this.f.a))}aa(a,b){this.dir==a&&xc(this,-2.75,b)}C(a){this.G=a.b.y<this.b.y;this.j=48>this.b.y-a.b.y&&24<this.b.y-a.b.y&&a.M;this.dir=a.b.x>this.b.x?1:-1;this.A=Math.abs(a.b.y-this.b.y)}}class ic extends wc{constructor(a,b){super(a,b,12,3,2);this.P=!0;this.G=0}A(a){this.la(this.b.x+2*this.dir,this.b.y-4,this.G/80,-2,1,!0,1);I(a.audio,a.o.v.snowball,.5)}C(a){this.dir=a.b.x>this.b.x?1:-1;this.G=a.b.x-this.b.x}}
class jc extends Y{constructor(a,b){super(a,b,13,6,3);this.a.y=.1;this.c=new r(16,14);this.H.y=2;this.L=new r(12,12);this.D.y=2;this.m=.5;this.h=this.A=!1;this.j=0;this.Ha=this.G=!0;this.K.y-=2;--this.b.y}X(){--this.b.y;this.h=this.A=!1;this.j=0;this.G=!0}l(a){0<this.j&&0>=(this.j-=a.step)&&(this.h=!0);this.h&&(this.target.y=-.5,this.speed.y=-.5,this.b.y<this.K.y&&(this.b.y=this.K.y,this.h=!1,S(this)))}i(){let a=0;this.A?a=1:0<this.j?a=2:this.h&&(a=3);M(this.f,a,this.f.a)}C(a){0>=this.j&&!this.A&&
!this.h&&a.b.y>this.b.y&&24>Math.abs(a.b.x-this.b.x)&&(this.A=!0,this.target.y=6)}ka(a){this.A&&(this.j=60,this.G=this.A=!1,I(a.audio,a.o.v.quake,.4))}Xa(){this.h&&(this.b.y=this.K.y,S(this),this.h=!1)}qb(a){this.G||(a.pb=this.j,a.ob=new r(3,3),this.G=!0)}}
class kc extends Y{constructor(a,b){super(a,b,14,5,3);this.D.y=2;this.c=new r(4,10);this.H.y=0;this.a.x=.025;this.a.y=.1;this.m=.5;this.dir=1-(a/16|0)%2*2;this.ta=this.xa=-1}X(a){this.dir=1-(a/16|0)%2*2;this.target.x=.5*this.dir;this.speed.x=this.target.x}l(){this.target.x=.5*this.dir;this.target.y=4}i(a){K(this.f,this.f.a,0,3,6,a.step);this.g=0>this.dir?0:1}aa(a){this.dir=-a;this.speed.x*=-1;this.target.x=this.speed.x}ka(a){this.speed.y=-2.25;I(a.audio,a.o.v.jump2,.5)}Aa(a){if(0<this.speed.x&&a.b.x>
this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class lc extends Y{constructor(a,b){super(a,b,15,3,2);this.a.x=.015;this.a.y=.033;this.c=new r(6,6);this.m=.5;this.j=new r(0,0);this.h=0}X(){this.h=Math.random()*Math.PI*2;this.V=!0}l(a){this.h=(this.h+.05*a.step)%(2*Math.PI);this.target.x=.33*this.j.x;this.target.y=.33*(this.j.y+1.5*Math.sin(this.h))}i(){let a=1;-.125>this.speed.y?a=0:.125<this.speed.y&&(a=2);M(this.f,a,this.f.a);this.g=0<this.target.x?1:0}C(a){this.j=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class mc extends Y{constructor(a,b){super(a,b,16,3,2);this.a.y=.05;this.c=new r(6,6);this.m=.5;this.j=this.G=0;this.La=!0;this.ta=-1;this.P=this.h=this.A=0;this.$=new r(0,0)}X(a,b){this.j=Math.random()*Math.PI*2;this.h=0;this.G=0==(b/16|0)%2?1:-1;this.P=0;this.A=120-(a/16|0)%2*60}l(a){this.b.x=this.K.x+Math.round(4*Math.sin(this.P));0<this.h?this.h-=a.step:(this.P=(this.P+.05*a.step)%(2*Math.PI),this.j=(this.j+.1*a.step)%(2*Math.PI),this.target.y=this.G*(Math.sin(this.j)+.2)*.5,0>=(this.A-=a.step)&&
(this.la(this.b.x+4*(0==this.g?-1:1),this.b.y+2,1*this.$.x,1*this.$.y,2,!1,2),I(a.audio,a.o.v.snowball,.5),this.h=30,S(this),this.A+=120))}i(){if(0<this.h)M(this.f,3,this.f.a);else{var a=1;-.25>this.speed.y?a=0:.25<this.speed.y&&(a=2);M(this.f,a,this.f.a);this.g=0<this.target.x?1:0}}ka(){this.G=-1;this.target.y*=-1;this.j=0}Xa(){this.G=1;this.target.y*=-1;this.j=0}C(a){this.g=a.b.x<this.b.x?0:1;this.$=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class nc extends Y{constructor(a,b){super(a,b,17,1,3);this.a.x=.025;this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.33}X(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}l(){this.target.x=this.dir;this.target.y=4}i(a){this.g=0<this.dir?1:0;this.M?K(this.f,this.f.a,0,3,6,a.step):M(this.f,4,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:-1}ac(a){I(a.audio,a.o.v.kill,.6);this.ya();Jb(this)}ya(){let a;for(let b=0;4>b;++b)a=Math.PI/4+b*Math.PI/2,this.la(this.b.x,this.b.y+this.D.y,2*Math.cos(a),2*Math.sin(a),
3,!1,2)}}
class oc extends Y{constructor(a,b){super(a,b,18,1,1);this.a.y=.1;this.c=new r(8,10);this.H.y=2;this.D.y=2;this.m=.5;this.ua=this.Ha=!0;this.K.y-=4;this.b.y-=4;this.j=this.h=0;this.Fb=!0}X(a){this.h=0;this.j=60-(a/16|0)%2*60/2;M(this.f,8,this.f.a)}l(a){this.Ub=this.ua=2!=this.h;this.target.y=0;0==this.h?0>=(this.j-=a.step)&&(this.h=1,M(this.f,0,this.f.a)):2==this.h&&(this.target.y=2)}i(a){0==this.h?M(this.f,8,this.f.a):1==this.h?(K(this.f,this.f.a,0,4,10,a.step),4==this.f.c&&(this.h=2)):3==this.h&&
(K(this.f,this.f.a,5,8,6,a.step),8==this.f.c&&(this.h=0,this.b=this.K.clone(),this.j=60))}ka(a){2==this.h&&(this.h=3,S(this),I(a.audio,a.o.v.blob,.7))}}
class pc extends Y{constructor(a,b){super(a,b,19,6,3);this.a.x=.05;this.G=!0;this.D.y=2;this.c=new r(8,12);this.H.y=1;this.m=.75;this.A=!1;this.j=0;this.h=!1}X(a){this.h=!1;this.j=60-(a/16|0)%2*60/2;this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}l(a){this.target.x=.5*this.dir;this.target.y=4;!this.A&&this.G&&!this.M&&0>=this.S&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.G=this.M;0>=(this.j-=a.step)&&(this.h=!this.h,this.j+=this.h?30:60,this.h&&(this.la(this.b.x+
8*this.dir,this.b.y+2,2*this.dir,0,4,!1,2),I(a.audio,a.o.v.snowball,.5)))}i(a){this.g=0<this.dir?1:0;let b=this.h?5:0;this.M?K(this.f,this.f.a,b,b+3,8,a.step):M(this.f,b+4,this.f.a)}aa(a){this.dir=-a}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}C(a){this.A=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class qc extends Y{constructor(a,b){super(a,b,20,6,3);this.a.x=.025;this.a.y=.025;this.c=new r(6,6);this.m=.66;this.j=0;this.G=new r(0,0);this.P=new r(0,0);this.$=this.h=this.A=0;this.La=!0}X(a){this.j=this.b.y%(2*Math.PI);this.V=!0;this.A=120-(a/16|0)%2*120/2}l(a){0<this.h?this.h-=a.step:(this.target.x=.75*this.G.x,this.target.y=.75*this.G.y,this.j=(this.j+.025*a.step)%(2*Math.PI),0>=(this.A-=a.step)&&(this.la(this.b.x,this.b.y,1.5*this.P.x,1.5*this.P.y,3,!1,2),I(a.audio,a.o.v.snowball,.5),this.h=
30,this.$=this.f.c,M(this.f,this.f.c+5,this.f.a),S(this),this.A+=120))}i(a){0<this.h?M(this.f,this.$+Math.floor(this.h/8)%2*5,this.f.a):(K(this.f,this.f.a,0,4,5,a.step),this.g=0<this.target.x?1:0)}C(a){this.G=v(new r(a.b.x+32*Math.cos(this.j)-this.b.x,a.b.y+32*Math.sin(this.j)-this.b.y),!0);this.P=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class rc extends uc{constructor(a,b){super(a,b,21,1,4,16+(a/16|0)%8,.025+(b/16|0)%4*.0025,0);this.a.x=.005;this.m=.35;this.j=0;this.Fb=this.V=!0}ja(a,b,c){this.b=new r(a,b);this.hb=this.b.clone();this.K=this.b.clone();this.speed.x=c;this.j=0<c?0:Math.PI;this.s=!0;this.R=!1;this.F=!0;this.A(a,b);M(this.f,0,this.f.a)}A(a,b){this.j=Math.sin(a*b/256)*Math.PI;this.h=(a/16|0)%2*Math.PI;this.V=!0}G(a){this.j=(this.j+.0125*Math.cos(this.h)*a.step)%(2*Math.PI);this.target.x=.5*Math.sin(this.j)}i(a){this.g=
0<this.speed.x?1:0;K(this.f,this.f.a,0,3,5,a.step)}aa(a){0<this.target.x*a&&(this.j=2*Math.PI-this.j);this.speed.x*=-1}ya(){let a;for(let b=0;4>b;++b)a=Math.PI/4+b*Math.PI/2,this.la(this.b.x,this.b.y+this.D.y,2*Math.cos(a),2*Math.sin(a),5,!1,3)}}
class sc extends Y{constructor(a,b){super(a,b,22,6,3);this.a.x=.0125;this.a.y=.0125;this.c=new r(6,6);this.m=.66;this.h=0;this.G=new r(0,0);this.j=new r(0,0);this.A=0;this.La=!0;this.ta=this.xa=1}X(a,b){this.V=!0;this.h=(a+b)%360*Math.PI/180;this.A=120-(a/16|0)%2*120/2}l(a){this.target.x=1*this.G.x;this.target.y=1*this.G.y;this.h=(this.h+.015*a.step)%(2*Math.PI);if(0>=(this.A-=a.step)){{const b=Math.PI/6;let c,d=Math.atan2(this.j.y,this.j.x);for(let e=-1;1>=e;++e)c=d+b*e,this.la(this.b.x,this.b.y,
Math.cos(c),Math.sin(c),7,!1,2);this.speed.x=-.75*this.j.x;this.speed.y=-.75*this.j.y;I(a.audio,a.o.v.snowball,.5);M(this.f,1,this.f.a)}this.A+=120}}i(a){0<this.f.c&&K(this.f,this.f.a,0,5,5,a.step)}C(a){this.G=v(new r(a.b.x+64*Math.cos(this.h)-this.b.x,a.b.y+64*Math.sin(this.h)-this.b.y),!0);this.j=v(new r(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class tc extends Y{constructor(a,b){super(a,b,23,6,4);this.a.x=.025;this.j=!0;this.D.y=2;this.c=new r(4,12);this.H.y=1;this.m=.5;this.h=!0}X(){this.dir=-1;this.g=0;this.target.x=0;this.speed.x=this.target.x;this.h=!0;this.f.c=4}l(a){this.h||(this.target.x=.25*this.dir,this.target.y=2,this.j&&!this.M&&0>=this.S&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step),this.j=this.M)}i(a){if(this.h)if(K(this.f,this.f.a,4,9,7,a.step),9==this.f.c)this.h=!1;else return;this.g=0<
this.dir?1:0;this.M&&K(this.f,this.f.a,0,3,10,a.step)}aa(){this.speed.x*=-1;this.target.x*=-1;this.dir*=-1}Aa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}};class Fb{constructor(){this.b=new r(0,0);this.speed=0;this.text="";this.c=this.a=0;this.s=!1}ja(a,b,c,d,e,f){this.b=new r(a,b);this.speed=c;this.a=d;this.c=e;this.text=f;this.s=!0}update(a){this.s&&(0<this.a?(this.a-=a.step,this.b.y-=this.speed):0>=(this.c-=a.step)&&(this.s=!1))}u(a){this.s&&D(a,a.B.spcfont,this.text,this.b.x|0,this.b.y-5|0,-3,0,!0)}};const yc=[4,2];
class zc extends U{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new N(32,32);M(this.f,0,1);this.K=new N(24,24);M(this.K,c.mb?1:0,0);this.L=new r(12,16);this.progress=c;this.V=-1;this.a=c.mb;this.h=c.na;this.l=this.a?0:Math.PI/2;this.H=this.a?1:0;this.ta=this.a?this.b.y-yc[0]:this.b.y;this.A=d;this.ka=!1;this.xa=()=>{}}Hb(a){this.V=a}update(a){this.ka?(this.xa(a),this.ka=!1):this.F&&!this.h&&(this.a&&(K(this.K,0,1,4,1==this.K.c?30:8,a.step),this.l+=.05*a.step,0==this.H&&this.l>=2*Math.PI&&
(this.H=1),this.l%=2*Math.PI),this.ta=this.b.y-yc[0]+Math.round(Math.sin(this.l)*yc[this.H]))}g(a){if(this.F)if(this.h)this.f.u(a,a.B.nightOrb,this.b.x-16,this.b.y-20+1,!1);else if(this.K.u(a,a.B.nightOrb,this.b.x-12,this.ta-12+1,!1),!this.a){var b=String.fromCharCode(24)+String.fromCharCode(25)+String(this.progress.Ba)+"/"+String(this.V);D(a,a.B.font,b,this.b.x-4,this.b.y-24,-1,0,!0)}}i(a,b,c,d){X(a,d.o.Z.en[this.a?"nightOrbOverdrive":"nightOrbActivate"]).J(e=>{b.b.x=this.b.x;this.a?(b.kb=60,Ac(b),
J(e.audio),I(e.audio,e.o.v.night,.6),this.ka=!0,this.xa=f=>{f.U.J(!0,3,1/120,g=>{b.cb=new r(this.b.x,this.b.y+4);this.h=!0;this.progress.na=!0;this.A(g)},new r(80,4))}):(this.a=!0,this.progress.Ba=0,this.progress.mb=!0,b.kb=90,Hb(b,!1),I(e.audio,e.o.v.activateOrb,.7))},!0)}m(){this.a=this.progress.mb;this.C=this.h||!this.a&&this.progress.Ba<this.V||this.a&&0==this.H}};class Bc extends Ya{constructor(a,b,c,d){super(a,b);this.b.clone();this.id=c;this.L=new r(16,16);this.s=!0;this.f=new N(16,16);this.c=d}gb(a){K(this.f,1,0,3,5,a.step);return 3==this.f.c}Ga(a){this.F=this.F&&a.Pa&&a.fa||Va(a,this)}Ya(a){K(this.f,0,0,3,12,a.step)}u(a,b){if(this.s&&this.F){var c=b.sa*b.width,d=0,e=0;b.fa&&b.Pa&&(d=-1,e=1);for(b=d;b<=e;++b)a.move(b*c,0),this.f.u(a,a.B.star,Math.round(this.b.x)-8,Math.round(this.b.y)-8,0),a.move(-b*c,0)}}Ia(a,b){if(this.s&&this.F&&!this.R&&!a.R&&Xa(this,
a)){I(b.audio,b.o.v.star,.6);a=a.progress;a.Db[this.id]=!0;++a.pa;for(b=0;8>b;++b)a=2*Math.PI/8*b,this.c(this.b.x,this.b.y+this.D.y,2*Math.cos(a),2*Math.sin(a),6,!1,0);this.R=!0}}wa(a){this.s&&a.Db[this.id]&&(this.s=!1)}};class Cc extends U{constructor(a,b,c,d){super(a,b);this.h=c;M(this.f,((a/16|0)+(b/16|0))%4,d?1:0);this.L=new r(10,16);this.l=d}update(a){this.F&&!this.a&&K(this.f,this.f.a,0,3,10,a.step)}g(a){this.F&&this.f.u(a,a.B.npc,this.b.x-8,this.b.y-8+1,this.c)}i(a,b,c,d){b=d.o.Z.en;b=this.l?b.meow:b.npc[this.h];for(let e of b)X(a,e);a.J(()=>{},!1)}m(a){this.c=a.b.x<this.b.x?0:1}};class Dc{constructor(){this.b=new r(0,0);this.a=0;this.speed=1;this.s=!1;this.da="figure"}ja(a,b,c){this.b.x=a;this.b.y=b;this.speed=c;this.a=1;this.s=!0}update(a){this.s&&(this.da=a.Va.da,0>=(this.a-=this.speed*a.step)&&(this.s=!1))}u(a){this.s&&C(a,a.B[this.da],16*(5+n(Math.round(5*(1-this.a)),0,4)),80,16,16,Math.round(this.b.x-8),Math.round(this.b.y-8),0)}}
class Ec extends ab{constructor(){super(0,0);this.f=new N(16,16);this.g=!1;this.l=0;this.H=null;this.K=0;this.a=new r(.1,.1);this.c=new r(4,4);this.L=new r(10,10);this.i=this.F=this.s=!1;this.vb=0;this.h=[];this.C=0;this.m=!1;this.xb=!0;this.j=!1;this.da="figure"}ja(a,b,c,d,e,f,g,h){this.b=new r(a,b);this.speed=new r(c,d);this.target=this.speed.clone();this.g=!1;this.l=e;this.H=f;this.K=this.speed.length();this.F=this.s=!0;this.i=this.V=this.R=!1;++this.vb;this.m=g;this.j=h}Ob(a){if(this.m){for(let b of this.h)b.update(a);
this.s&&0>=(this.C-=a.step)&&(p(this.h,Dc).ja(this.b.x,this.b.y,.05),this.C+=6)}}Ya(a){this.da=a.Va.da;let b=new r(this.b.x-this.H.b.x,this.b.y-this.H.b.y),c=b.length();v(b,!1);this.g?(this.target.x=-b.x*this.K,this.target.y=-b.y*this.K,this.i||(this.i=Math.sign(this.target.x)==Math.sign(this.speed.x)&&Math.sign(this.target.y)==Math.sign(this.speed.y)),12>c&&(this.s=!1)):0>=(this.l-=a.step)&&(this.m&&++this.vb,this.g=!0);K(this.f,this.j?10:5,1,4,4,a.step);this.V=this.g&&this.i}u(a){this.s&&this.f.u(a,
a.B[this.da],this.b.x-8|0,this.b.y-8|0,0<=this.speed.x?0:1)}aa(){this.i=!0;this.g||(this.l=0,this.g=!0,this.m&&++this.vb)}ka(){this.i=!0}Xa(){this.i=!0}Kb(a,b,c,d){return this.s&&P(this,a,b,c,d)?this.m?3:1:0}};function wb(a,b,c,d){a.b.x=b+8*d;a.b.y=c;a.dir=d;a.g=0<d?1:0;M(a.f,4,6);a.S=0}function yb(a,b,c){M(a.f,0,8);a.ua=new r(c,b);a.S=0;a.Da=!0}function Hb(a,b){M(a.f,b?1:2,8);a.S=0;a.C=0;a.$=0;a.A=0}function Lb(a){return a.ha&&0<=a.speed.y||a.Ea&&a.ba>(a.Ja?0:11)}function Ac(a){M(a.f,3,8);a.g=0}function Fc(a,b){a.cb=b.clone();a.b=a.cb.clone()}
function Gc(a,b){a.h&&(a.dir*=-1,a.g=0==a.g?1:0);a.j=!1;a.ba=16;S(a);b?a.i||(a.speed.x=1.25*a.dir,a.target.x=a.speed.x):a.progress.I[7]&&(a.ba+=12);a.Ja=b;a.va=0;a.m=0;a.Ea=!0;var c=a.b.y+2;a.Ca.x=a.b.x+14*a.dir;a.Ca.y=c;a.Ra.x=16;a.Ra.y=b?10:8;++a.Cb}function Hc(a,b,c){!c&&a.progress.I[22]?(tb(a.progress),a.R=!1,I(b.audio,b.o.v.heal,.6),X(a.message,b.o.Z.en.lifePotionUsed).J(()=>{a.progress.removeItem(22)},!1)):(a.R=!0,M(a.f,0,7),S(a),J(b.audio),I(b.audio,b.o.v.die,.5))}
class Ic extends ab{constructor(a,b,c,d){super(a,b);this.cb=new r(a,b);this.Sb=null;this.f=new N(16,16);M(this.f,4,4);this.Fa=new N(16,16);this.g=0;this.a=new r(.1,.15);this.D=new r(0,2);this.L=new r(8,12);this.c=new r(6,12);this.M=!1;this.va=0;this.Na=!1;this.K=0;this.l=this.P=this.ab=this.i=!1;this.ma=0;this.qa=!1;this.m=0;this.La=!1;this.ba=0;this.A=this.j=this.Ea=!1;this.$=0;this.Ja=!1;this.Ca=new r(0,0);this.Ra=new r(0,0);this.Cb=0;this.ha=!1;this.G=0;this.h=!1;this.qb=this.H=0;this.W=new Ec;
this.W.s=!1;this.dir=1;this.C=this.S=0;this.progress=c;this.message=d;this.$a=this.Ka=!1;this.F=!0;this.Za=0;this.Wa=!1;this.ya=this.Bb=0;this.ua=null;this.kb=0;this.Da=!1;this.da="figure"}Nb(a,b){this.progress.Nb(a|0,b|0)}Ya(a){this.da=a.Va.da;if(!this.Da){this.P&&!this.i&&(this.P=!1);this.da=a.Va.da;this.dir=0==this.g?1:-1;var b=a.input.actions.fire2.state;(b=b==ka||b==E)&&this.progress.I[7]&&(this.A&&b?(this.A=!1,this.$=0,Gc(this,!0),I(a.audio,a.o.v.powerAttack,.6)):!this.Ja&&0<this.ba&&12>=this.ba&&
(this.ba=0));if(!(0<this.ba||this.ha||this.La||(this.target.y=2,0<this.C))){this.target.x=1*a.input.O.x;this.h&&!this.l&&(this.target.y*=.25);this.a=new r(.1,.15);this.progress.I[17]&&(this.target.x*=1.2,this.a.x*=1.2);a:if(this.progress.I[0]){if(a.input.actions.fire2.state==F){if(this.progress.I[6]&&!this.i&&!this.l&&!this.M&&.1<a.input.O.y){S(this);this.speed.y=-2;this.target.y=4;this.a.y=.35;this.ha=!0;this.m=this.G=0;b=this.b.y+16;this.Ca.x=this.b.x;this.Ca.y=b;this.Ra.x=8;this.Ra.y=12;++this.Cb;
I(a.audio,a.o.v.downAttack,.6);b=!0;break a}if(this.j){Gc(this,!1);I(a.audio,a.o.v.sword,.5);b=!0;break a}}b=!1}else b=void 0;if(b=!b)!this.progress.I[2]||this.W.s?b=!1:(this.h&&(this.dir*=-1,this.g=0==this.g?1:0),a.input.actions.fire3.state==F?(this.W.ja(this.b.x+4*this.dir,this.b.y+2,2*this.dir,0,24,this,this.progress.I[11],this.progress.I[24]),this.W.hb.x=this.b.x,S(this),this.ba=30,this.Ea=!1,this.m=this.va=0,I(a.audio,a.o.v["throw"],.6),b=!0):b=!1),b=!b;if(b&&(this.l&&(this.a.x*=.5,this.a.y*=
.25,this.target.x*=.5,this.target.y*=.25,this.h=!1,this.H=0),b=a.input.actions.fire1.state,this.i?(.1<a.input.O.x?this.g=0:-.1>a.input.O.x&&(this.g=1),this.target.y=.5*a.input.O.y,this.target.x=0,b==F&&(.1>a.input.O.y&&(this.va=14),this.P=this.i=this.Na=!1,I(a.audio,a.o.v.jump,.5)),b=!0):b=!1,!b)){b=a.input.actions.fire1.state;if(b==F)if(this.progress.I[5]&&!this.l&&this.M&&.1<a.input.O.y)this.m=20,I(a.audio,a.o.v.jump,.5);else{if(this.M||0<this.K||this.progress.I[10]&&!this.Na||0<this.H)this.va=
(this.Na=!this.M&&0>=this.K&&0>=this.H)?8:14,this.M=!1,this.K=0,0<this.H&&(this.speed.x=-2*this.qb),this.h=!1,this.H=0,this.j=!0,this.$a=!1,I(a.audio,a.o.v.jump,.5)}else b==ka&&(0<this.va?this.va=0:0<this.m&&!this.La&&(this.m=0),this.$a=!0);if(this.Ka=!this.M&&this.progress.I[9]&&this.$a&&(!this.progress.I[10]||this.Na)&&0>=this.ba&&1==(b&1)&&0>=this.va)this.target.y=.5,this.speed.y=this.target.y}}0<this.ba&&this.Ja?this.Ca.x+=this.speed.x*a.step:this.ha&&(this.Ca.y+=this.speed.y*a.step);a:{b=1/30;
if(this.progress.I[3]&&!this.progress.I[4]&&this.qa&&this.l){if(0>=(this.ma-=a.step)){Hc(this,a);break a}}else this.ma=0;this.Wa&&(this.ya+=b*a.step,this.ya%=1);0<this.va&&(this.speed.y=-2,this.l&&this.progress.I[3]&&(this.speed.y*=.5,this.target.y*=.5),this.va-=(this.progress.I[1]?1:2)*a.step);0<this.m&&(this.speed.x=2*this.dir,this.target.x=this.speed.x,this.m-=a.step);0<this.K&&(this.K-=a.step);0<this.H&&(this.H-=a.step);0<this.ba&&(this.ba-=a.step,this.progress.I[7]&&!this.Ja&&this.Ea&&0>=this.ba&&
(this.A=!0,I(a.audio,a.o.v.charge,.5)));0<this.G&&0>=(this.G-=a.step)&&(this.ha=!1);this.A&&(this.$=(this.$+a.step)%20);0<this.S&&(0<this.C?(this.C-=a.step,0>=this.progress.Y&&0>=this.C&&Hc(this,a)):this.S-=a.step)}{let c=this.f.c,d=this.f.a;if(!this.Da)if(0<this.C)M(this.f,0,5);else if(b=this.progress.I[23]?9:4,this.ha)M(this.Fa,3,b),M(this.f,1,4);else if(0<this.ba)M(this.f,0,4),this.Ja?K(this.Fa,b,7,8,4,a.step):M(this.Fa,2,b);else if(0<this.m)M(this.f,4,1);else if(.1<Math.abs(this.target.x)&&(this.g=
0>this.target.x?1:0),this.h)M(this.f,3,1);else if(this.l)0<=this.speed.y&&.1<Math.abs(this.target.x)?K(this.f,3,0,1,10,a.step):(b=0>this.speed.y?2:0,M(this.f,b,3));else if(this.i){if(3!=this.f.a||.1<Math.abs(this.target.y))K(this.f,3,3,4,10,a.step),(this.f.a!=d||this.f.c!=c&&3==this.f.c)&&I(a.audio,a.o.v.climb,.6)}else this.Ka?(K(this.f,6,0,3,3,a.step),(this.f.a!=d||this.f.c!=c&&0==this.f.c)&&I(a.audio,a.o.v.flap,.5)):this.M?.1>Math.abs(this.speed.x)&&.1>Math.abs(this.target.x)?M(this.f,0,0):(b=12-
6*Math.abs(this.speed.x),K(this.f,0,1,4,b,a.step)):this.Na&&0>this.speed.y?K(this.f,2,0,4,4,a.step):(b=0,.5>Math.abs(this.speed.y)?b=1:0<this.speed.y&&(b=2),M(this.f,b,1))}this.W.Ob(a);this.W.update(a);this.ab=this.i;this.l=this.i=!1;this.V=this.ha&&-.01>this.speed.y}}zb(){this.Da?this.Da=!1:(this.Wa=this.h=this.M=!1,this.ua=null,this.qa=this.La=!1)}gb(a){K(this.f,7,0,2,3,a.step);return 120<=(this.Za+=a.step)}u(a){if(this.s){var b=this.W;if(b.m)for(var c of b.h)c.u(a);if(this.R){b=1*this.Za;for(var d=
0;8>d;++d){var e=2*Math.PI/8*d;c=this.b.x+this.D.x+Math.cos(e)*b;e=this.b.y+this.D.y+Math.sin(e)*b;this.f.u(a,a.B[this.da],c-8,e-8,0)}this.W.u(a)}else 0<this.S&&0!=Math.floor(this.S/2)%2||(d=this.f.c,this.A&&0==Math.floor(this.$/2)%2&&(d+=5),b=Math.round(this.b.x-8),c=Math.round(this.b.y-7),0<this.ba&&this.Ea&&this.Fa.u(a,a.B[this.da],b+12-24*this.g,c+1,this.g),e=this.f,C(a,a.B[this.progress.I[15]?this.da:"figureNaked"],e.width*d,e.height*this.f.a,e.width,e.height,b,c,this.g),this.ha&&this.Fa.u(a,
a.B[this.da],b+3-6*this.g,c+7,this.g),this.W.u(a),this.Wa&&(d=this.f,C(a,a.B[this.da],d.width*(3+2*this.Bb+Math.floor(this.ya/.5)),7*d.height,d.width,d.height,b,c-16,0)),null!=this.ua&&C(a,a.B.items,16*this.ua.x,16*this.ua.y,16,16,b,c-16,0),this.progress.I[3]&&!this.progress.I[4]&&this.l&&this.qa&&0<this.ma&&D(a,a.B.font,String(Math.round(this.ma/60)),b+8,c-10,-1,0,!0))}}ka(){this.M=!0;this.Na=!1;this.K=12;.1<this.speed.y&&(this.P=this.i=!1);this.j=!0;this.ha&&0>=this.G&&(this.G=20);this.H=0;this.h=
!1}aa(a,b){!this.i&&!this.ha&&0>=this.ba&&!this.l&&0<this.speed.y&&.1<b.input.O.x*a&&(this.progress.I[8]&&(this.h=!0,this.H=15),this.qb=a,this.j=!0)}Xa(){this.va=0}lb(a,b,c,d,e,f){if(this.ha||!P(this,a+4,b,c-8,d))return!1;this.Wa||this.ab?this.ab&&1==this.Bb&&(this.Wa=!1):(this.Wa=!0,this.Bb=1);return this.P?(this.j=!0,void 0==f&&(this.i=!0),!0):qa(e.input)||ra(e.input)?(this.P=this.i=this.j=!0,this.b.x=a+8,void 0!=f&&(this.b.y=b+f),S(this),!0):!1}Ab(a,b,c,d,e,f){return e||this.progress.I[3]?P(this,
a,b,c,d)?(this.qa=this.qa||!e,0>=this.ma&&!this.l&&(this.ma=300),this.l=!0,this.K=1,this.Na=!1,this.m=0,this.j=!0):!1:Za(this,a,b-4,c,f,!1)}sb(a,b){let c=a.b.x*a.width,d=a.b.y*a.height,e=a.target.x-a.b.x,f=a.target.y-a.b.y,g=(this.L.x+2)*a.yb,h=10*a.yb,l=0,m=0,q;a.fa?(this.b.x+=e*g*b.step,this.b.y+=f*h*b.step):(this.Nb(a.b.x|0,a.b.y|0),this.V||(0>=this.C&&(0<this.speed.x&&this.b.x+this.D.x+this.L.x/2>c+a.width?l=1:0>this.speed.x&&this.b.x+this.D.x-this.L.x/2<c&&(l=-1)),0==l&&(0<this.speed.y&&this.b.y+
this.D.y+4>d+a.height?m=1:0>this.speed.y&&this.b.y+this.D.y-4<d&&(m=-1)),0==l&&0==m||0==(q=a.move(l,m,.05))||(this.b.x+=q*a.width*a.sa)),0<this.C&&(T(this,a.T.x*a.width,a.T.y*a.height,a.height,-1,b),T(this,(a.T.x+1)*a.width,a.T.y*a.height,a.height,1,b)));null!=this.W&&this.W.s&&!Va(a,this.W)&&(this.W.s=!1)}wb(a,b){this.g=0<this.dir?0:1;this.S=60;this.C=30;this.target.x=0;this.speed.x=2*-this.dir;this.i=!1;this.ba=0;this.Ka=this.A=this.h=this.ha=!1;var c=this.progress;c.I[18]&&(a=Math.max(1,a-1));
c.Y=Math.max(0,c.Y-a);I(b.audio,b.o.v.hurt,.5)}fb(a,b,c,d,e,f){if(!(0<this.S))return P(this,a,b,c,d)?(this.dir=this.b.x<a+c/2?1:-1,this.wb(e,f),!0):!1}Kb(a,b,c,d,e){return(Lb(this)||0<this.G)&&ca(this.Ca,null,this.Ra,a,b,c,d)?this.Ja||this.ha?2:1:this.progress.I[14]&&$a(this,a,b+16,c,e,!1)?2:0}moveTo(a,b){this.b=a.clone();S(this);b.setPosition(this.b.x/160|0,this.b.y/144|0)}$b(a,b,c,d){return(0<this.K||this.M)&&0<this.m&&P(this,a,b,c,d)?(this.m=5,this.La=!0):!1}};class Jc extends U{constructor(a,b,c,d,e){super(a,b);this.f=new N(32,40);M(this.f,0,c);this.L=new r(12,40);this.id=c;this.l=!1;this.aa=!0;this.bb=d;this.progress=e;this.h=0;this.wa(e);this.l&&(this.f.c=1)}hc(a){this.h=a}update(a){this.wa(this.progress);this.C=!this.l;this.l?K(this.f,this.id,1,3,6,a.step):M(this.f,0,this.id)}g(a){if(this.F&&!this.a&&(this.f.u(a,a.B.portal,this.b.x-16,this.b.y-20,0),1==this.id)){var b=String.fromCharCode(26)+String.fromCharCode(27)+String(this.progress.pa)+"/"+String(this.h);
D(a,a.B.font,b,this.b.x-4,this.b.y-30,-1,0,!0)}}m(){}i(a,b,c,d){J(d.audio);d.U.J(!0,1,1/60,e=>{this.bb(e)},null,new x(255,255,255));d.U.D=new r(this.b.x%160,this.b.y%144+8);b.b.x=this.b.x;Hb(b,!1);I(d.audio,d.o.v.teleport,.5)}wa(a){this.l=0==this.id&&a.I[15]||1==this.id&&a.na&&a.pa>=this.h}};class Kc{constructor(a,b){this.progress=a;this.lc=b}}
function Lc(a){let b={};var c=Object.assign(a.progress);b.progress={health:c.Y,maxHealth:c.oa,gems:c.Xb,coins:c.eb,keys:c.keys,orbs:c.Ba,openedChests:c.Qa,openedDoors:c.Gb,boughtItems:c.Ta,obtainedItems:c.I,visitedRooms:c.Sa,nightOrbActivated:c.mb,isNight:c.na,collectedStars:c.Db,stars:c.pa,isIntro:c.N};b.savePoint={x:a.cb.x,y:a.cb.y};a=JSON.stringify(b);try{window.localStorage.setItem("agff_savedata",a)}catch(d){return console.log("Save error: "+d),!1}return!0}
function Mc(){var a=null;try{a=window.localStorage.getItem("agff_savedata")}catch(b){return console.log("SAVE ERROR: "+b),null}if(null==a)return null;a=JSON.parse(a);return new Kc(a.progress,new r(a.savePoint.x,a.savePoint.y))};class Nc extends U{constructor(a,b){super(a,b);this.active=!1;this.L=new r(10,16)}update(a){this.F&&(this.active?K(this.f,0,1,8,6,a.step):M(this.f,0,0))}g(a){this.F&&this.f.u(a,a.B.savepoint,this.b.x-8,this.b.y-8,0)}j(a,b){this.active||(this.active=!0,a.cb=this.b.clone(),a.Sb=this,null!=b&&I(b.audio,b.o.v.savepoint,.5))}i(a,b,c,d){let e=d.o.Z.en;X(a,e.saveGame).J(()=>{let f=Lc(b);X(a,e[f?"goodResult":"badResult"]).J(()=>{},!1)},!0)}m(a){this.active=a.Sb==this}};class Oc extends U{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new N(24,24);this.L=new r(12,16);this.f.c=4*Math.random()|0;M(this.f,0,d);this.id=d;this.a=c}update(a){this.F&&K(this.f,this.id,0,3,10,a.step)}g(a){this.F&&this.f.u(a,a.B.shopkeeper,this.b.x-12,this.b.y-12,this.c)}i(a,b,c,d){X(a,d.o.Z.en.shopkeeper[this.id]).J(()=>{this.a.J(this.id)},!1)}m(a){this.c=a.b.x<this.b.x?0:1}};function Pc(a){switch(a.id){case 0:return 30<=a.progress.eb;case 1:return a.progress.I[21];case 2:return a.progress.I[22];default:return!1}}function Qc(a){switch(a.id){case 0:return zb(a.progress,-30),a.progress.Qa[3][16]=!0,[16,3];case 1:return a.progress.removeItem(21),sb(a.progress,23),a.C=!0,[23,1];case 2:return a.progress.removeItem(22),sb(a.progress,24),a.C=!0,[24,1];default:return[-1,-1]}}
class Rc extends U{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new N(24,24);this.L=new r(12,16);this.f.c=4*Math.random()|0;M(this.f,0,d%2);this.id=d;this.progress=c;this.a=0;0==this.id&&this.progress.Qa[3][16]&&(this.id=2);a:switch(this.id){case 1:a=this.progress.I[23];break a;case 2:a=this.progress.I[24];break a;default:a=!1}a&&(this.disabled=!0)}update(a){this.F&&K(this.f,this.id%2,0,3,10,a.step)}g(a){this.F&&this.f.u(a,a.B.specialNPC,this.b.x-12,this.b.y-12,this.c)}i(a,b,c,d){let e=d.o.Z.en;
for(let f of e.specialNPC[this.id])X(a,f);a.J(()=>{Pc(this)&&X(a,e.specialQuestion[this.id]).J(()=>{X(a,e.specialReply[this.id]).J(f=>{let g=Qc(this);I(f.audio,f.o.v.treasure,.5);Ka(f.audio);yb(b,g[1],g[0]);this.a=60;xb(a,h=>0>=(this.a-=h.step));for(let h of e.specialResult[this.id])X(a,h);a.J(h=>{0==this.id&&(this.id=2);rb(g[1],g[0],b);La(h.audio)},!1)},!1)},!0)},!1)}m(a){this.c=a.b.x<this.b.x?0:1}};function lb(a,b,c,d,e,f){var g=0;let h=0,l=0,m=0,q=null,t=a.progress.na,z=(w,y,G,u,A,L,Z)=>{p(a.i,qb).ja(w,y,G,u,A,L,Z)};for(let w=0;w<d;++w)for(let y=0;y<c;++y)if(h=b[w*c+y]-512,!(0>=h)){--h;g=0;0<w&&(g=Math.max(0,b[(w-1)*c+y]-512-240-1));switch(h){case 42:a.g.push(new Jc(16*y+8,16*w-4,1,e,a.progress));case 0:0==h&&a.progress.na||(a.a=new Ic(16*y+8,16*w+8,a.progress,a.message));break;case 32:a.g.push(new Nc(16*y+8,16*w+8));break;case 33:case 34:case 35:case 36:a.g.push(new vb(16*y+8,16*w+8,h-33,
g));36==h&&++l;break;case 37:a.g.push(new Cc(16*y+8,16*w+8,g,t&&!a.progress.N));break;case 38:case 39:a.g.push(new Gb(16*y+8,16*w,39==h,g));break;case 40:a.g.push(new Oc(16*y+8,16*w+4,a.l,g));break;case 41:a.g.push(new Jc(16*y+8,16*w-4,g,e,a.progress));0==g&&a.progress.na&&(a.a=new Ic(16*y+8,16*w+8,a.progress,a.message));break;case 43:a.g.push(new Rc(16*y,16*w+4,a.progress,g));break;case 44:a.g.push(q=new zc(16*y,16*w+4,a.progress,f));break;case 45:++m,a.progress.na&&a.pa.push(new Bc(16*y+8,16*w+
8,g,z))}if(1<=h&&31>=h){g=a.c.length;for(let G=0;G<a.c.length;++G)if(!a.c[G].s){g=G;break}a.c[g]=new ((a.progress.na&&!a.progress.N?rc:Vb(h-1)).prototype.constructor)(16*y+8,16*w+8);a.c[g].X(16*y+8,16*w+8);a.c[g].la=z;void 0!=a.c[g].cc&&(a.c[g].fc((G,u,A)=>Sc(a,G,u,A)),Rb(a.c[g],()=>{for(let G of a.c)G.s&&!G.R&&void 0==G.cc&&Jb(G);for(let G of a.i)G.s=!1}))}}null!=q&&q.Hb(l+1);for(let w of a.g)void 0!=w.Hb&&w.Hb(l+1),void 0!=w.hc&&w.hc(m);Tc(a)}
function hb(a,b,c,d){let e=(b-d.x)/16*.75;e=n(e,-.75,.75);d=Math.max(0,c-d.y)/16*2;d=n(d,-2,2);var f=a.a.progress;f=.25*(1-f.Y/f.oa);f=a.progress.N||Math.random()<f?1:0;p(a.m,Eb).ja(b,c,e,-1.5+d,f)}function Tc(a){for(let b of a.g)if(void 0!=b.bc)for(let c of a.g)void 0!=c.bc&&c.id==b.id&&c.Lb!=b.Lb&&(c.Jb=b,b.Jb=c)}
function Sc(a,b,c,d){let e=-1;for(var f=0;f<a.c.length;++f)if(!a.c[f].s){e=f;break}f=new rc(0,0);-1==e?a.c.push(f):a.c[e]=f;Ib(f,(g,h,l,m,q,t,z)=>{p(a.i,qb).ja(g,h,l,m,q,t,z)});f.ja(b,c,d)}function Uc(a,b){b.setPosition(a.a.b.x/160|0,a.a.b.y/144|0)}function Vc(a,b,c,d,e){let f=a.a.cb.clone();a.c=[];a.tb=[];a.m=[];a.i=[];a.g=[];a.pa=[];kb(b,a,c,d);e||Fc(a.a,f)}function Wc(a,b){b.D=new r((a.a.b.x|0)%160,(a.a.b.y|0)%144)}
class Xc{constructor(a,b,c){this.a=null;this.c=[];this.tb=[];this.m=[];this.i=[];this.g=[];this.pa=[];this.progress=a;this.l=b;this.message=c}update(a,b,c,d){var e=this.a;0>=e.kb?e=!1:(e.kb-=d.step,e=!0);if(!e){for(let h of this.c)if(h.sb(a,d),a.fa||(h.update(d),h.Ia(this.a,this,d),fb(b,h,this,d)),h.s&&!h.R&&h.F)for(let l of this.c)if(l!=h)a:{var f=void 0;e=h;var g=l;if(!g.s||g.R||!g.F||!e.s||e.R||!e.F||g.Fb||e.Fb)break a;f=Math.hypot(e.L.x/2,e.L.y/2);let m=Math.hypot(g.L.x/2,g.L.y/2),q=new r(e.b.x+
e.D.x-g.b.x-g.D.x,e.b.y+e.D.y-g.b.y-g.D.y),t=q.length();v(q);t<f+m&&(f=f+m-t,e.Ha||(e.b.x+=q.x*f/2,e.b.y+=q.y*f/2),e.Aa(g),g.Ha||(g.b.x-=q.x*f/2,g.b.y-=q.y*f/2),g.Aa(e))}a.fa||(this.a.update(d),fb(b,this.a,this,d),this.a.W.s&&fb(b,this.a.W,this,d));this.a.sb(a,d)}for(let h of this.tb)h.update(d);for(let h of this.g)h.Ga(a),h.update(d),h.Ia(c,this.a,a,d);for(let h of this.pa)h.Ga(a),h.update(d),h.Ia(this.a,d);for(let h of this.i)h.Ga(a),a.fa||(h.update(d),fb(b,h,this,d),h.Ia(this.a,d));for(let h of this.m)h.sb(a,
d),h.update(d),h.Ia(this.a,this,d),fb(b,h,this,d);return this.a.s}u(a,b){for(let c of this.pa)c.u(a,b);for(let c of this.g)c.u(a,b);for(let c of this.c)c.u(a,b);for(let c of this.m)c.u(a);this.a.u(a);for(let c of this.i)c.u(a);for(let c of this.tb)c.u(a)}nb(a){if(this.progress.N&&this.progress.na)for(let b of this.c)void 0!=b.nb&&b.nb(a)}wa(a){for(let b of this.c)b.Ga(a);for(let b of this.g)b.Ga(a),b.Ia(null,this.a,null),void 0!=b.wa&&b.wa(this.a.progress);for(let b of this.pa)b.Ga(a),b.wa(this.a.progress)}}
;function Yc(a,b){X(a.message,b.o.Z.en.respawnText).J(c=>{a.g(c);a.a.ca();a.active=!1},!0)}function Zc(a,b){X(a.message,b.o.Z.en.quitText).J(c=>{a.c(c);a.a.ca();a.active=!1},!0)}
class $c{constructor(a,b,c,d){let e=d.o.Z.en;this.message=new Ob(d);this.a=new Sa(12,!0,[new O(e.resume,f=>{this.ca(f)},!1),new O(e.respawn,f=>{Yc(this,f)},!1),new O(e.map,f=>{c(f)},!1),new O(e.quit,f=>{Zc(this,f)},!1)]);this.g=a;this.c=b;this.active=!1}J(a){this.active=!0;this.a.J(0);this.a.buttons[2].disabled=!(!a.N&&a.I[16])}ca(a){this.a.ca();this.active=!1;La(a.audio)}update(a){this.active&&(this.message.active?this.message.update(a):a.input.actions.back.state==F?(I(a.audio,a.o.v.deny,.6),this.ca(a)):
this.a.update(a))}u(a,b){this.active&&!b&&(B(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.active?this.message.u(a,!0):(Mb(a,a.width/2-38,a.height/2-24,76,48),this.a.u(a,a.width/2,a.height/2+1)))}};const ad=[4,0,2,1,1,1,1,1,1,1],bd=[0,16,16,16,17,18,19,20,21,22],cd=[10,15,10,15,10,30,20,30,50,20];
function dd(a,b,c){let d=c.o.Z.en;c=d.shopItemNames;let e=[];for(let f=0;f<c.length;++f){e.push([]);for(let g=0;g<c[f].length;++g)e[f].push(new O(" "+c[f][g],()=>{let h=5*f+g;a.progress.Ta[h]||(a.progress.eb<cd[h]?X(a.message,d.cannotAfford).J(()=>{},!1):X(a.message,d.confirmTransaction).J(l=>{4!=ad[h]&&(a.progress.Ta[h]=!0,a.a[a.id].buttons[g].disabled=!0);zb(a.progress,-cd[h]);ub(a.g,a.i,ad[h],bd[h]);I(l.audio,l.o.v.treasure,.5);a.c=60;a.ca();yb(b,ad[h],1==ad[h]?bd[h]:0);Ka(l.audio);xb(a.i,m=>0>=
(a.c-=m.step)).J(m=>{rb(ad[h],bd[h],b);La(m.audio)},!1)},!0))},!1));e[f].push(new O(d.back,()=>{a.ca()},!0))}return e}function ed(a,b,c){b=dd(a,b,c);a.a=[];for(c=0;c<b.length;++c)a.a[c]=new Sa(12,!0,b[c])}function fd(a){for(let b=0;b<a.a.length;++b)for(let c=0;c<a.a[b].buttons.length-1;++c)a.progress.Ta[5*b+c]&&(a.a[b].buttons[c].disabled=!0)}
class gd{constructor(a,b,c){this.progress=a;this.a=[];this.active=!1;this.g=c.o.Z.en;this.message=new Ob(c);this.i=b;this.id=this.c=0}update(a){this.active&&(this.message.active?this.message.update(a):a.input.actions.back.state==F?(I(a.audio,a.o.v.deny,.6),this.ca()):this.a[this.id].update(a))}u(a){if(this.active){B(a,0,0,0,.67);a.fillRect(0,0,a.width,a.height);var b=a.height/2-this.a[this.id].height/2+-12;Mb(a,a.width/2-24,4,48,12);D(a,a.B.font,"SHOP",a.width/2,6,0,0,!0);Mb(a,a.width/2-74,b-2,148,
this.a[this.id].height);this.a[this.id].u(a,64,a.height/2+-12);for(var c=0;5>c;++c)C(a,a.B.shopicons,8*(5*this.id+c),this.progress.Ta[5*this.id+c]?8:0,8,8,60-(this.a[this.id].width-8)/2+7,b+c*this.a[this.id].offset,0);for(let f=0;5>f;++f){if(this.progress.Ta[5*this.id+f]){c=this.g.sold;var d="fontGray"}else d=this.a[this.id].ra==f?"fontYellow":"font",c=String(cd[5*this.id+f])+String.fromCharCode(6);var e=152-8*c.length;D(a,a.B[d],c,e,b+f*this.a[this.id].offset,0,0,!1)}b=b+this.a[this.id].height+-4+
12;Mb(a,a.width/2-74,b-4,148,40);this.a[this.id].ra<this.a[this.id].buttons.length-1&&(c=this.g.shopItemDesc[this.id][this.a[this.id].ra],D(a,a.B.font,c,8,b-2,0,1,!1));this.message.active&&(B(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.u(a,!0))}}J(a){this.id=a;this.active=!0;this.a[this.id].J(this.a[this.id].buttons.length-1);this.c=0;this.progress.I[22]||1!=a||(this.a[this.id].buttons[4].disabled=!1,this.progress.Ta[9]=!1)}ca(){this.a[this.id].ca();this.active=!1}};class hd{constructor(a,b,c){this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=b;this.width=a;this.height=b;this.active=!1;this.l=new r(0,0);this.c=new r(0,0);this.i=0;this.Sa=[];this.C=a/10|0;this.H=b/9|0;this.a=this.g=0;this.h=c.o.Z.en;this.m=[]}update(a){this.active&&(1!=this.a?0>=(this.g-=a.step)&&(0==this.a?++this.a:this.active=!1,this.g=0):a.input.actions.start.state==F||a.input.actions.select.state==F||a.input.actions.fire1.state==F||a.input.actions.back.state==
F?(this.a=2,this.g=30,I(a.audio,a.o.v.accept,.6)):this.i=(this.i+a.step)%60)}J(a,b,c,d,e){this.active=!0;{const f=["rgb(0,85,170)","rgb(0,0,0)","rgb(85,85,85)","rgb(85,170,0)"];let g=this.canvas.getContext("2d");g.clearRect(0,0,this.width,this.height);let h;for(let l=0;l<a.height;++l)for(let m=0;m<a.width;++m)h=a.data[l*a.width+m],0!=h&&(g.fillStyle=f[h-1],g.fillRect(m|0,l|0,1,1));this.Sa=Array.from(d.Sa)}this.l.x=Math.round(b.x/16);this.l.y=Math.round(b.y/16);this.c.x=Math.floor(c.b.x);this.c.y=
Math.floor(c.b.y);this.i=0;this.g=30;this.a=0;this.m=[];if(d.I[20])for(let f of e)void 0==f.dc||f.dc()||this.m.push(new r(f.b.x/16|0,f.b.y/16|0))}u(a){if(this.active){var b=a.width/2-this.width/2|0,c=a.height/2-this.height/2|0;B(a,0,0,0,.67);a.fillRect(0,0,a.width,a.height);var d=this.g/30;2>this.a&&(d=1-d);d=10+10*Math.round((this.width-10)*d/10-1);{var e=a.width/2-d/2,f=c-4,g=this.height;let m=a.B.map;C(a,m,0,0,10,9,e-10,f-9,0);C(a,m,20,0,10,9,e+d,f-9,0);C(a,m,0,27,10,9,e-10,f+g+9,0);C(a,m,20,27,
10,9,e+d,f+g+9,0);var h=(g/9|0)+1;for(let q=0;q<h;++q){var l=q==h-1?18:9;C(a,m,0,l,10,9,e-10,f+9*q,0);C(a,m,20,l,10,9,e+d,f+9*q,0)}l=d/10|0;for(h=0;h<l;++h)C(a,m,10,0,10,9,e+10*h,f-9,0),C(a,m,10,18,10,9,e+10*h,f+g,0)}if(1!=this.a)B(a,170,85,0),a.fillRect(a.width/2-d/2,c-4,d,this.height);else{B(a,255,170,85);a.fillRect(b,c-4,this.width,this.height);B(a,170,85,0);a.fillRect(b,c-4,this.width,4);B(a,255,255,85);a.fillRect(b+10*this.c.x,c+9*this.c.y,10,9);ha(a,this.canvas,b,c);30>this.i&&(B(a,255,0,0),
a.fillRect(b+this.l.x-1,c+this.l.y-2,3,3));B(a,170,85,0);for(d=0;d<this.H;++d)for(e=0;e<this.C;++e)e==this.c.x&&d==this.c.y||this.Sa[d*this.C+e]||a.fillRect(b+10*e,c+9*d,10,9);if(0<this.m.length&&30>this.i){a.move(b,c);B(a,85,255,255);for(let m of this.m)a.fillRect(m.x-1,m.y-1,3,3);a.move(-b,-c)}D(a,a.B.font,this.h.mapHeader,a.width/2,c-9,0,0,!0)}}}};function id(a,b){a.N=!a.N;a.progress.N=a.N;a.g=new ob(b.o,a.N);a.m=new hd(a.g.width,a.g.height,b);a.a=new Wa(0,0,160,144,a.g.width/10|0,a.g.height/9|0,!0);a.N||Ab(a.progress,a.a.sa,a.a.i);jd(a,b,!0)}function kd(a){a.U.J(!0,2,1/30,b=>{b.za(ld);b.U.ca()},new x(0,0,0))}function md(a,b,c,d){let e=d.o.Z.en;if(!a.progress.N&&a.progress.I[16])a.m.J(nb(a.g),a.c.a.b,a.a,a.progress,a.c.g),c&&I(d.audio,d.o.v.pause,.6);else{for(let f of e.noMap)X(b,f);b.J(()=>{},!1);c&&I(d.audio,d.o.v.deny,.6)}}
function nd(a,b){Ja(b.audio,b.o.v[a.N?"intro":a.progress.na?"theme1":"theme2"],.25,null)}function jd(a,b,c){eb(a.g);Vc(a.c,a.g,d=>id(a,d),d=>{jd(a,d,!1)},c);Ta(a.a);Uc(a.c,a.a);Wc(a.c,b.U);a.c.wa(a.a);Cb(a.progress);ed(a.i,a.c.a,b);fd(a.i);nd(a,b)}function od(a,b){b.U.J(!0,1,1/30,c=>jd(a,c,!1),null,new x(0,0,0));Wc(a.c,b.U)}
function pd(a,b,c){let d=b.B.font;B(b,0,0,0,.33);b.fillRect(0,0,b.width,10);var e=String.fromCharCode(6)+String.fromCharCode(2)+String(a.progress.eb);D(b,d,e,b.width-8*e.length-1,1,0,0,!1);if(!c){for(e=0;e<a.progress.oa;++e)c=9*(e/2|0),0==e%2&&C(b,d,40,0,8,8,c+2,1),a.progress.Y>e&&C(b,d,32+e%2*4,0,4,8,c+2+e%2*4,1);(0<a.progress.keys||0<a.progress.Ba||0<a.progress.pa)&&b.fillRect(0,b.height-10,b.width,10);0<a.progress.keys&&D(b,d,String.fromCharCode(7)+String.fromCharCode(2)+String(a.progress.keys),
2,b.height-9,1,0,!1);!a.N&&0<a.progress.pa?(e=String.fromCharCode(9)+String.fromCharCode(2)+String(a.progress.pa),D(b,d,e,b.width-8*e.length-2-1,b.height-9,1,0,!1)):0<a.progress.Ba&&(e=String.fromCharCode(8)+String.fromCharCode(2)+String(a.progress.Ba),D(b,d,e,b.width-8*e.length-2-1,b.height-9,1,0,!1))}}
class qd extends H{constructor(a,b){super(a,b);let c=null;!0===b&&(c=Mc());this.progress=new Db;null!=c&&void 0!=c.progress&&Bb(this.progress,c.progress);this.N=this.progress.N;this.g=new ob(a.o,this.N);this.a=new Wa(0,0,160,144,this.g.width/10|0,this.g.height/9|0,!0);this.N||Ab(this.progress,this.a.sa,this.a.i);this.message=new Ob(a);this.i=new gd(this.progress,this.message,a);this.c=new Xc(this.progress,this.i,this.message);kb(this.g,this.c,d=>id(this,d),d=>{jd(this,d,!1)});Uc(this.c,this.a);ed(this.i,
this.c.a,a);this.l=new $c(d=>{var e=this.c;!e.a.R&&e.a.s&&Hc(e.a,d,!0)},d=>{kd(d)},d=>{md(this,this.l.message,!1,d)},a);nd(this,a);a.U.J(!1,1,this.N?1/60:1/30,null,new x(0,0,0));Wc(this.c,a.U);this.c.wa(this.a);null!=c&&(Fc(this.c.a,c.lc.clone()),Uc(this.c,this.a));fd(this.i);this.m=new hd(this.g.width,this.g.height,a)}refresh(a){this.a.c&&(this.c.wa(this.a),this.a.c=!1);a.U.active||(this.m.active?this.m.update(a):this.message.active?this.message.update(a):this.i.active?this.i.update(a):this.l.active?
this.l.update(a):this.a.fa||a.input.actions.select.state!=F?a.input.actions.start.state==F?(this.l.J(this.progress),Ka(a.audio),I(a.audio,a.o.v.pause,.6)):(this.g.update(this.a,a),this.c.update(this.a,this.g,this.message,a)?this.a.update(a):od(this,a)):md(this,this.message,!0,a))}Eb(){}Ua(a){a.moveTo(0,0);var b=this.g,c=this.a,d=this.progress.na;if(b.N)for(a.clear(255,255,255),ha(a,a.B.introBackground,0,0),d=0;3>d;++d)for(var e=0;2>e;++e)C(a,a.B.clouds,0,72*d,160,72,-Math.floor(b.m[d])+160*e,56+12*
d,0);else{e=d?80:0;d?(a.clear(0,0,0),ha(a,a.B.nightBg,0,0)):a.clear(85,170,255);b=k(b.C,96);C(a,a.B.background,16,e+32,64,48,96,16,0);c=16*c.T.y|0;a.move(0,-c);for(let f=0;3>f;++f)C(a,a.B.background,0,e,96,32,Math.round(-b+96*f),96,0);d?B(a,255,170,255):B(a,255,255,255);a.fillRect(0,128,a.width,16);for(b=0;b<a.width/16|0;++b)C(a,a.B.background,0,e+32,16,32,16*b,144,0);d?B(a,85,0,170):B(a,0,85,170);a.fillRect(0,176,a.width,Math.max(0,a.height+c-176));a.move(0,c)}Ua(this.a,a);this.paused||0>=a.pb||
a.move(Math.round(Math.random()*a.ob.x*2)-(a.ob.x|0),Math.round(Math.random()*a.ob.y*2)-(a.ob.y|0));this.g.u(a,this.a,this.progress.na&&!this.progress.N);this.c.u(a,this.a);Ua(this.a,a);this.g.nb(a,this.a,this.progress.Mb);a.moveTo(0,0);pd(this,a,!1);a.moveTo(0,0);this.c.nb(a);this.message.active&&this.message.u(a,!0);this.l.u(a,this.m.active);this.i.u(a);this.i.active&&pd(this,a,!0);this.m.u(a)}};class rd extends H{constructor(a,b){super(a,b);b=a.o.Z.en;this.message=new Ob(a);for(let c of b.storyIntro)X(this.message,c);this.a=new N(64,32);M(this.a,0,1);this.c=0}refresh(a){0==this.c?1==this.a.a?(K(this.a,1,0,3,10,a.step),3==this.a.c&&M(this.a,0,0)):(K(this.a,0,0,3,8,a.step),3==this.a.c&&(this.c=1,this.message.J(()=>{this.c=2;this.message.ca()},!1))):1==this.c?this.message.update(a):0==this.a.a?(K(this.a,0,3,0,8,a.step),0==this.a.c&&M(this.a,3,1)):(K(this.a,1,3,-1,10,a.step),-1==this.a.c&&a.za(qd))}Eb(){return null}Ua(a){a.clear(0,
0,0);a.moveTo(0,0);this.a.u(a,a.B.eye,a.width/2-32,20,0);a.moveTo(0,24);this.message.u(a,!1)}};function sd(a,b){b.U.J(!0,1,1/30,c=>{c.za(a.load?qd:rd);a.load||c.U.ca()},new x(0,0,0));b.U.D=new r(78,24)}
class ld extends H{constructor(a,b){super(a,b);this.g=a.o.Z.en;this.i=new Sa(12,!0,[new O(this.g.newgame,c=>{J(c.audio);this.load=!1;sd(this,c)},!1),new O(this.g["continue"],c=>{let d=!1;try{d=window.localStorage.getItem("agff_savedata")}catch(e){d=!1}d?(J(c.audio),this.load=!0,sd(this,c)):(I(c.audio,c.o.v.deny,.6),X(this.message,this.g.noSaveData).J(()=>{},!1))},!0)]);this.a=0;this.c=60;this.load=!1;this.message=new Ob(a);Ja(a.audio,a.o.v.titleScreen,.225,2E3)}refresh(a){if(!a.U.active)if(this.message.active)this.message.update(a);
else if(0==this.a)0>=(this.c-=a.step)&&(++this.a,this.c=29);else if(1==this.a){if(a.input.actions.start.state==F||a.input.actions.fire1.state==F)++this.a,I(a.audio,a.o.v.pause,.6);this.c=(this.c+a.step)%60}else 2==this.a&&this.i.update(a)}Ua(a){a.clear(0,0,0);let b=0;0==this.a&&(b=this.c/60);let c=a.B.titlebg;ha(a,c,0,c.height*b);c=a.B.logo;ha(a,a.B.logo,0,-c.height*b+8);D(a,a.B.font,this.g.copyright,a.width/2+a.width*b,a.height-9,0,0,!0);2==this.a?this.i.u(a,a.width/2,a.height-32):1==this.a&&30<=
this.c&&D(a,a.B.font,"Press Enter or (Start)",a.width/2,a.height/2+32,-1,0,!0);this.message.u(a,!0);0<this.a&&D(a,a.B.fontYellow,"v.0.9.3 BETA",1,1,-1,0,!1)}Eb(){return this.load}};class td extends H{constructor(a,b){super(a,b);this.c=0;this.a=-10}refresh(a){a.input.ib()&&30<=this.a&&90>this.a&&(this.a=90);this.a+=a.step;120<=this.a&&(this.a-=120,3==++this.c&&a.za(ld))}Ua(a){a.clear(0,0,0);var b="creator";1==this.c?b="musicBy":2==this.c&&(b="creator_dzhake");b=a.B[b];let c=b.width,d=b.height/3;if(!(7.5>this.a||112.5<=this.a)){var e=2;30>this.a?e=n(Math.round(this.a/7.5)-1,0,2):90<=this.a&&(e=n(2-(Math.round((this.a-90)/7.5)-1),0,2));C(a,b,0,e*d,c,d,a.width/2-c/2,a.height/2-
d/2,0)}}};class ud extends H{constructor(a,b){super(a,b);a=a.o.Z.en;this.a=new Sa(12,!0,[new O(a.defaultskin,c=>{c.Va.da="figure";c.za(td)},!1),new O(a.npcskin,c=>{c.Va.da="figure_npc";c.za(td)},!0)]);this.c=a.skinselect}refresh(a){this.a.update(a)}Ua(a){a.clear(0,85,170);D(a,a.B.font,this.c,32,a.height/2-32,0,2,!1);this.a.u(a,a.width/2,a.height/2+16)}};class vd extends H{constructor(a,b){super(a,b);a=a.o.Z.en;this.a=new Sa(12,!0,[new O(a.yes,c=>{c.audio.toggle(!0);c.audio.Yb=n(.4,0,1);c.za(ud)},!1),new O(a.no,c=>{c.audio.toggle(!1);c.za(ud)},!0)]);this.c=a.audiointro}refresh(a){this.a.update(a)}Ua(a){a.clear(0,85,170);D(a,a.B.font,this.c,32,a.height/2-32,0,2,!1);this.a.u(a,a.width/2,a.height/2+16)}};window.onload=()=>{var a=new Ra(160,144,0);a.o.load("assets/assets.json");var b=[{name:"fire1",key:"KeyZ",Ma:0},{name:"fire2",key:"KeyX",Ma:2},{name:"fire3",key:"KeyC",Ma:1},{name:"start",key:"Enter",Ma:9,jb:7},{name:"back",key:"Escape",Ma:8,jb:6},{name:"select",key:"ShiftLeft",Ma:4,jb:5}];for(let c of b)pa(a.a.input,c.name,c.key,c.Ma,c.jb);a.m=vd;a.l=!1;a.loop(0)};
</script>
</body>
</html>
