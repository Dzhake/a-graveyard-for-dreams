<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="overflow: hidden; cursor: none; background-color: black;">
<script>
'use strict';function k(a,b){b|=0;return((a|0)%b+b)%b}function p(a,b,c){return Math.max(b,Math.min(a,c))}function q(a,b){for(let c of a)if(!c.v)return c;a.push(new b.prototype.constructor);return a[a.length-1]}function aa(a,b,c){return a<b?Math.min(b,a+c):Math.max(b,a-c)}function ba(a,b,c,d,e,f,g){null==b&&(b=new t(0,0));let h=a.x+b.x-c.x/2;a=a.y+b.y-c.y/2;return h+c.x>=d&&h<d+f&&a+c.y>=e&&a<e+g};function w(a,b){let c=a.length();if(1E-4>c)a.x=b?1:0,a.y=0;else return a.x/=c,a.y/=c,a.clone()}function ca(a){a.x=0;a.y=0}class t{constructor(a,b){this.x=void 0==a?0:a;this.y=void 0==b?0:b}length(){return Math.hypot(this.x,this.y)}clone(){return new t(this.x,this.y)}}class x{constructor(a,b,c){this.r=p(a,0,255);this.ub=p(b,0,255);this.sb=p(c,0,255)}clone(){return new x(this.r,this.ub,this.sb)}};function da(a,b,c){let d=document.createElement("div");d.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;");a.canvas=document.createElement("canvas");a.canvas.width=b;a.canvas.height=c;a.canvas.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");d.appendChild(a.canvas);document.body.appendChild(d);a.da=a.canvas.getContext("2d");a.da.imageSmoothingEnabled=!1;ea(a)}
function ea(a){var b=window.innerWidth,c=window.innerHeight;a=a.canvas;var d=Math.min(b/a.width|0,c/a.height|0);let e=a.width*d;d*=a.height;c=String(c/2-d/2|0)+"px";b=String(b/2-e/2|0)+"px";a.style.width=String(e|0)+"px";a.style.height=String(d|0)+"px";a.style.top=c;a.style.left=b}function y(a,b,c,d,e){b=void 0==b?255:b;c=void 0==c?b:c;b="rgba("+String(b|0)+","+String(c|0)+","+String((void 0==d?c:d)|0)+","+String(void 0!=e?e:1);a.da.fillStyle=b;a.da.strokeStyle=b}
function z(a,b,c,d,e,f,g,h,l){var m=e,r=f;if(!(null==b||0>=m||0>=r)){var n=a.da;g+=a.a.x;a=h+a.a.y;c|=0;d|=0;m|=0;r|=0;g|=0;a|=0;e|=0;f|=0;l|=0;0!=l&&n.save();0!=(l&1)&&(n.translate(e,0),n.scale(-1,1),g*=-1);0!=(l&2)&&(n.translate(0,f),n.scale(1,-1),a*=-1);n.drawImage(b,c,d,m,r,g,a,e,f);0!=l&&n.restore()}}function B(a,b,c,d){z(a,b,0,0,b.width,b.height,c,d,0)}
function C(a,b,c,d,e,f,g,h){let l=b.width/16|0,m=d;h&&(m=d-=c.length*(l+f)/2);for(let r=0;r<c.length;++r)h=c.charCodeAt(r),10==h?(m=d,e+=l+g):(z(a,b,h%16*l,(h/16|0)*l,l,l,m,e,!1),m+=l+f)}
class fa{constructor(a,b,c){this.da=this.canvas=null;da(this,a,b);this.width=a;this.height=b;window.addEventListener("resize",()=>ea(this));this.a=new t(0,0);this.A=null==c?{}:c;this.nb=0;this.mb=new t(0,0)}clear(a,b,c){this.da.fillStyle="rgba("+String(a|0)+","+String(b|0)+","+String(c|0)+",1";this.da.fillRect(0,0,this.width,this.height)}fillRect(a,b,c,d){a+=this.a.x;b+=this.a.y;this.da.fillRect(a|0,b|0,c|0,d|0)}moveTo(a,b){this.a=new t(a,b)}move(a,b){this.a.x+=a;this.a.y+=b}update(a){0<this.nb&&
(this.nb-=a.step)}};function ha(a,b){if(null==b)for(b=0;b<a.buttons.length;++b)a.buttons[b]=D;else for(let c=0;c<b.buttons.length;++c){if(c>=a.buttons.length)for(let d=0;d<c-a.buttons.length;++d)a.buttons.push(D);b.buttons[c].pressed?a.buttons[c]==D||a.buttons[c]==E?(a.$a=!0,a.buttons[c]=G):a.buttons[c]=ia:a.buttons[c]=a.buttons[c]==ia||a.buttons[c]==G?E:D}}
function ja(a,b){null!=b&&(a.N.x=0,a.N.y=0,.05<Math.hypot(b.axes[0],b.axes[1])&&(a.N.x=b.axes[0],a.N.y=b.axes[1]),8<=b.axes.length&&.1>Math.hypot(a.N.x,a.N.y)&&.05<Math.hypot(b.axes[6],b.axes[7])&&(a.N.x=b.axes[6],a.N.y=b.axes[7]))}function la(a,b){return null==b||0>b||b>=a.buttons.length?D:a.buttons[b]}
class ma{constructor(){this.N=new t(0,0);this.buttons=[];this.a=null;this.index=0;window.addEventListener("gamepadconnected",a=>{console.log("Gamepad with index "+String(a.gamepad.index)+" connected.");let b=navigator.getGamepads()[a.gamepad.index];this.index=a.gamepad.index;a=this.a=b;ja(this,a);ha(this,a)});this.$a=!1}update(){this.$a=!1;this.N.x=0;this.N.y=0;if(null!=this.a){var a=navigator;a=null==a?null:a.getGamepads?a.getGamepads():a.webkitGetGamepads?a.webkitGetGamepads:null;null!=a&&(this.a=
a[this.index])}a=this.a;ja(this,a);ha(this,a)}};var D=0,E=2,ia=1,G=3;function na(a,b,c,d,e){a.actions[b]={state:D,key:c,xa:d,Va:e};a.j[c]=!0;return a}function oa(a){return 0>a.N.y&&-.25<=a.g.y&&-.25>a.m.y}function pa(a){return 0<a.N.y&&.25>=a.g.y&&.25<a.m.y}
class qa{constructor(){this.c={};this.j={};this.actions={};this.a=new ma;this.N=new t(0,0);this.g=new t(0,0);this.m=new t(0,0);window.addEventListener("keydown",a=>{var b=a.code;this.c[b]!=ia&&(this.i=!0,this.c[b]=G);this.j[b]&&a.preventDefault()});window.addEventListener("keyup",a=>{var b=a.code;this.c[b]!=D&&(this.c[b]=E);this.j[b]&&a.preventDefault()});window.addEventListener("contextmenu",a=>{a.preventDefault()});window.addEventListener("mousemove",()=>{window.focus()});window.addEventListener("mousedown",
()=>{window.focus()});this.i=!1}Cb(){this.a.update();for(let a in this.actions)this.actions[a].state=this.c[this.actions[a].key]|D,this.actions[a].state==D&&(null!=this.actions[a].xa&&(this.actions[a].state=la(this.a,this.actions[a].xa)),this.actions[a].state==D&&null!=this.actions[a].Va&&(this.actions[a].state=la(this.a,this.actions[a].Va)));this.g=this.N.clone();ca(this.N);.1<this.a.N.length()&&(this.N=this.a.N.clone());this.actions.right.state&1?this.N.x=1:this.actions.left.state&1&&(this.N.x=
-1);this.actions.down.state&1?this.N.y=1:this.actions.up.state&1&&(this.N.y=-1);this.m=new t(this.N.x-this.g.x,this.N.y-this.g.y)}kb(){var a=this.c;for(let b in a)a[b]==G?a[b]=ia:a[b]==E&&(a[b]=D);this.i=!1}$a(){return this.i||this.a.$a}};class ra{constructor(){}refresh(){}lb(){}tb(){}};function sa(a,b,c,d){return a.ea[b][k(d,a.height)*a.width+k(c,a.width)]}function ta(a,b,c,d,e){c=k(c,a.width);d=k(d,a.height);a.ea[b][d*a.width+c]=e}function ua(a){let b=new va;for(let c of a.ea)b.ea.push(Array.from(c));b.width=a.width;b.height=a.height;b.a=a.a;return b}class va{constructor(){this.height=this.width=0;this.ea=[];this.a={}}};class wa{constructor(a,b){this.data=b;this.a=null;this.gain=a.createGain();this.i=this.c=this.g=0;this.loop=!1}play(a,b,c,d){null!=this.a&&(this.a.disconnect(),this.a=null);let e=a.createBufferSource();e.buffer=this.data;e.loop=!!c;b=p(b,0,1);this.gain.gain.value=b;this.g=a.currentTime-d;this.c=0;this.i=b;this.loop=c;e.connect(this.gain).connect(a.destination);e.start(0,d);this.a=e}stop(){null!=this.a&&(this.a.disconnect(),this.a.stop(0),this.a=null)}pause(a){null!=this.a&&(this.c=a.currentTime-this.g,
this.stop())}resume(a){this.play(a,this.i,this.loop,this.c)}};function xa(a,b){ya(a,b,"json",c=>{c=JSON.parse(c);for(let d in c.bitmaps)za(a,c.bitmaps[d].name,c.bitmapPath+c.bitmaps[d].path);for(let d in c.tilemaps)Aa(a,c.tilemaps[d].name,c.tilemapPath+c.tilemaps[d].path);for(let d in c.samples)Ba(a,c.samples[d].name,c.samplePath+c.samples[d].path);for(let d in c.localization)Ca(a,c.localization[d].name,c.localizationPath+c.localization[d].path)})}
function ya(a,b,c,d){let e=new XMLHttpRequest;e.overrideMimeType("text/"+c);e.open("GET",b,!0);++a.total;e.onreadystatechange=()=>{4==e.readyState&&("200"==String(e.status)&&void 0!=d&&d(e.responseText),++a.loaded)};e.send(null)}function za(a,b,c){++a.total;let d=new Image;d.onload=()=>{++a.loaded;a.A[b]=d};d.src=c}
function Aa(a,b,c){++a.total;ya(a,c,"xml",d=>{var e=a.Db;{var f=new va;d=(new DOMParser).parseFromString(d,"text/xml").getElementsByTagName("map")[0];f.width=Number(d.getAttribute("width"));f.height=Number(d.getAttribute("height"));let l=d.getElementsByTagName("layer");f.ea=[];let m=9999;for(var g of l)g.id<m&&(m=g.id);for(let r=0;r<l.length;++r){g=l[r].id-m;var h=l[r].getElementsByTagName("data")[0].childNodes[0].nodeValue.replace(/(\r\n|\n|\r)/gm,"");h=h.split(",");f.ea[g]=[];for(let n=0;n<h.length;++n)f.ea[g][n]=
parseInt(h[n])}f.a={};d=d.getElementsByTagName("properties")[0];if(void 0!=d)for(let r of d.getElementsByTagName("property"))void 0!=r.getAttribute("name")&&(f.a[r.getAttribute("name")]=r.getAttribute("value"))}e[b]=f;++a.loaded})}function Ba(a,b,c){++a.total;let d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=()=>{a.a.da.decodeAudioData(d.response,e=>{++a.loaded;a.B[b]=new wa(a.a.da,e)})};d.send(null)}
function Ca(a,b,c){++a.total;ya(a,c,"json",d=>{a.Z[b]=JSON.parse(d);++a.loaded})}function Da(a){return 0==a.total||a.loaded>=a.total}class Ha{constructor(a){this.A={};this.Db={};this.B={};this.Z={};this.loaded=this.total=0;this.a=a}load(a){xa(this,a)}};function H(a,b,c){a.c&&b.play(a.da,a.Hb*c,!1,0)}function Ia(a){a.c&&null!=a.a&&a.a.pause(a.da)}function Ja(a){a.c&&null!=a.a&&a.a.resume(a.da)}function Ka(a){a.c&&null!=a.a&&(a.a.stop(a.da),a.a=null)}class La{constructor(){this.da=new AudioContext;this.a=null;this.Hb=1;this.c=!1}toggle(a){this.c=a}};function Ma(a,b){!a.m&&a.active&&3==a.mode&&a.i&&a.u(b)}
class Na{constructor(){this.c=0;this.Ka=()=>{};this.a=new x;this.active=!1;this.speed=1;this.i=!1;this.j=this.mode=0;this.C=new t(80,72);this.m=!1;this.g=document.createElement("canvas");this.g.getContext("2d").imageSmoothingEnabled=!1;this.u.width=160;this.u.height=144}H(a,b,c,d,e,f){void 0==f?this.a=new x:this.a=f.clone();this.j=e;this.i=a;this.speed=c;this.c=1;this.Ka=d;this.mode=b;this.active=!0;this.m=!1}update(a){this.active&&0>=(this.c-=this.speed*a.step)&&(0==(this.i=!this.i)?(this.c+=1,this.Ka(a),
this.m=!1):(this.active=!1,this.c=0))}s(a){if(this.active&&-1!=this.mode){this.m||!this.active||3!=this.mode||this.i||this.u(a);a.moveTo(0,0);var b=this.c;this.i&&(b=1-b);var c=this.C.x,d=this.C.y;switch(this.mode){case 0:null!=this.j&&(b=Math.round(b*this.j)/this.j);y(a,this.a.r,this.a.ub,this.a.sb,b);a.fillRect(0,0,a.width,a.height);break;case 1:var e=Math.max(Math.hypot(c,d),Math.hypot(a.width-c,d),Math.hypot(a.width-c,a.height-d),Math.hypot(c,a.height-d));e*=1-b;y(a,this.a.r,this.a.ub,this.a.sb,
1);{b=e;let h=a.da;if(0>=b)h.fillRect(0,0,a.width,a.height);else if(!(b*b>=a.width*a.width+a.height*a.height)){null==c&&(c=a.width/2);null==d&&(d=a.height/2);var f=Math.max(0,d-b)|0;e=Math.min(a.height,d+b)|0;0<f&&h.fillRect(0,0,a.width,f);e<a.height&&h.fillRect(0,e,a.width,a.height-e);for(let l=f;l<e;++l){var g=l-d;Math.abs(g)>=b?h.fillRect(0,l|0,a.width|0,1):(f=Math.round(c-Math.sqrt(b*b-g*g)),g=Math.round(c+Math.sqrt(b*b-g*g)),0<f&&h.fillRect(0,l|0,f|0,1),g<a.width&&h.fillRect(g|0,l|0,a.width-
f|0,1))}}}break;case 2:e=Math.round(a.height/2*b);y(a,this.a.r,this.a.ub,this.a.sb);a.fillRect(0,0,a.width,e);a.fillRect(0,a.height-e,a.width,e);break;case 3:for(a.clear(0,0,0),c=0;c<this.u.height;++c)e=Math.sin((c/this.g.height*this.j.y+b)*Math.PI*2)*this.j.x*b,z(a,this.g,0,c,this.g.width,1,-e,c,0)}y(a)}}aa(){this.active=!1}u(a){this.g.width=a.width;this.g.height=a.height;this.g.getContext("2d").drawImage(a.canvas,0,0);this.m=!0}};function Oa(a,b){var c=b.width/4;let d=c/8;b.clear(0,0,0);a=a.o;var e=0==a.total?0:a.loaded/a.total;a=b.width/2-c/2;let f=b.height/2-d/2;a|=0;f|=0;y(b,255,255,255);b.fillRect(a-2,f-2,c+4,d+4);y(b,0);b.fillRect(a-1,f-1,c+2,d+2);c=c*e|0;y(b,255);b.fillRect(a,f,c,d)}
class Pa{constructor(a,b,c){this.c=this.m=0;this.audio=new La;this.o=new Ha(this.audio);this.canvas=new fa(a,b,this.o.A);this.U=new Na;this.a={step:c+1,o:this.o,audio:this.audio,U:this.U,input:na(na(na(na(new qa,"left","ArrowLeft",14,null),"up","ArrowUp",12,null),"right","ArrowRight",15,null),"down","ArrowDown",13,null),La:d=>this.La(d)};this.g=new ra(this.a,null);this.j=!1;this.i=this.g}loop(a){const b=16.66667*this.a.step;this.c+=a-this.m;this.c=Math.min(5*b,this.c);this.m=a;a=this.c/b|0;let c=
Da(this.o);c&&!this.j&&(this.g=new this.i.prototype.constructor(this.a,null),this.i=null,this.j=!0);for(;0<a--;)this.canvas.update(this.a),this.U.update(this.a),this.a.input.Cb(),c&&this.g.refresh(this.a),this.a.input.kb(),this.c-=b;Da(this.o)?(Ma(this.U,this.canvas),this.g.lb(this.canvas),this.U.s(this.canvas)):Oa(this,this.canvas);window.requestAnimationFrame(d=>this.loop(d))}La(a){this.g=new a.prototype.constructor(this.a,this.g.tb())}};function J(a,b,c,d,e,f){b|=0;c|=0;d|=0;e|=0;if(c==d)a.g=0,a.c=c,a.a=b;else{a.a!=b&&(a.g=0,a.c=d>c?c:d,a.a=b);if(c<d&&a.c<c||c>d&&a.c>c)a.c=c;a.g+=f;a.g>e&&(c<d?++a.c>d&&(a.c=c):--a.c<d&&(a.c=c),a.g-=e)}}function K(a,b,c){a.c=b;a.a=c;a.g=0}class M{constructor(a,b){this.width=a;this.height=b;this.g=this.a=this.c=0}s(a,b,c,d,e){z(a,b,this.width*this.c,this.height*this.a,this.width,this.height,c,d,e)}};class N{constructor(a,b,c){this.text=a;this.Ka=b;this.Mb=c;this.disabled=!1}}
class Qa{constructor(a,b,c){this.buttons=[];for(let d of c)this.buttons.push(d);this.width=8*(Math.max(...this.buttons.map(d=>d.text.length))+1);this.height=this.buttons.length*a;this.ka=0;this.active=!!b;this.offset=a}H(a){null!=a&&(this.ka=a);this.active=!0}aa(){this.active=!1}update(a){if(this.active){var b=this.ka;oa(a.input)?--this.ka:pa(a.input)&&++this.ka;this.ka=k(this.ka,this.buttons.length);this.ka!=b&&H(a.audio,a.o.B.next,.6);b=this.buttons[this.ka];if(a.input.actions.start.state==G||a.input.actions.fire1.state==
G)b.disabled||null==b.Ka||b.Ka(a),H(a.audio,a.o.B[b.Mb||b.disabled?"deny":"accept"],.6)}}s(a,b,c){if(this.active){b-=this.width/2;c-=this.height/2;for(let f=0;f<this.buttons.length;++f){var d=this.buttons[f].disabled?"fontGray":this.ka==f?"fontYellow":"font";var e=this.ka==f?"@":" ";e+=this.buttons[f].text;C(a,a.A[d],e,b,c+f*this.offset,0,0,!1)}}}};function Ra(a){a.b=a.j.clone();a.target=a.b.clone();a.P=a.b.clone();a.ia=!1;a.a=0;a.ib=0}function Sa(a,b){b.moveTo(-Math.round(a.P.x*a.width),-Math.round(a.P.y*a.height))}function Ta(a,b){if(void 0==b.f)return!1;let c=a.P.x*a.width,d=a.P.y*a.height;return b.b.x+b.f.width/2>=c&&b.b.y+b.f.height/2>=d&&b.b.x-b.f.width/2<c+a.width&&b.b.y-b.f.height/2<d+a.height}
class Ua{constructor(a,b,c,d,e,f,g){this.b=new t(a,b);this.target=this.b.clone();this.P=this.b.clone();this.j=this.b.clone();this.width=c;this.height=d;this.ia=!1;this.ib=this.a=0;this.ta=e;this.i=f;this.g=g;this.c=this.gb=!1}move(a,b,c){if(this.ia||!this.g&&(0==this.b.x&&0>a||this.b.x==this.ta-1&&0<a)||!this.m&&(0==this.b.y&&0>b||this.b.y==this.i-1&&0<b))return 0;this.a=1;this.ib=c;this.target.x=this.b.x+a|0;this.target.y=this.b.y+b|0;this.ia=!0;if(this.g&&0>this.target.x)return this.b.x+=this.ta,
this.target.x+=this.ta,this.gb=!0,1;if(this.g&&this.target.x>=this.ta)return this.b.x-=this.ta,this.target.x-=this.ta,this.gb=!0,-1;this.gb=!1;return 0}update(a){this.c=!1;this.ia&&(0>=(this.a-=this.ib*a.step)?(this.a=0,this.b=this.target.clone(),this.P=this.b.clone(),this.gb=this.ia=!1):(a=this.a,this.P.x=a*this.b.x+(1-a)*this.target.x,this.P.y=a*this.b.y+(1-a)*this.target.y))}setPosition(a,b){this.b=new t(a,b);this.target=this.b.clone();this.P=this.b.clone();this.c=!0}};function P(a,b,c,d,e){return ba(a.b,a.C,a.K,b,c,d,e)}function Va(a,b){return P(a,b.b.x-b.K.x/2,b.b.y-b.K.y/2,b.K.x,b.K.y)}function Q(a){ca(a.speed);ca(a.target)}
class Wa{constructor(a,b){this.b=new t(a,b);this.Ya=this.b.clone();this.speed=new t(0,0);this.target=this.speed.clone();this.a=new t(1,1);this.C=new t(0,0);this.K=new t(0,0);this.v=!0;this.G=this.T=!1;this.f=new M(0,0)}xb(){}Ta(){}kb(){}pb(){return!0}update(a){this.v&&(this.G?this.T?this.pb(a)&&(this.T=this.v=!1):(this.Ya=this.b.clone(),this.Ta(a),this.speed.x=aa(this.speed.x,this.target.x,this.a.x*a.step),this.speed.y=aa(this.speed.y,this.target.y,this.a.y*a.step),this.b.x+=this.speed.x*a.step,this.b.y+=
this.speed.y*a.step,this.kb()):this.xb())}s(){}Ma(a){this.G=Ta(a,this)}};function Xa(a,b,c,d,e,f){if(!a.G||!f&&a.S||!a.v||a.T||0>a.speed.y)return!1;f=a.b.x+a.C.x-a.c.x/2;if(f+a.c.x<=b+1||f>=b+d-1)return!1;b=a.C.y+a.c.y/2;d=a.Ya.y+b;return a.b.y+b>=c-1*e.step&&d<=c+(2+a.speed.y)*e.step?(a.b.y=c-b,a.ga(e),a.speed.y*=-a.qa,!0):!1}
function Ya(a,b,c,d,e,f){if(!a.G||!f&&a.S||!a.v||a.T||0<a.speed.y)return!1;f=a.b.x+a.C.x-a.c.x/2;if(f+a.c.x<=b+1||f>=b+d-1)return!1;b=a.C.y-a.c.y/2;d=a.Ya.y+b;return a.b.y+b<=c+1*e.step&&d>=c-(2-a.speed.y)*e.step?(a.b.y=c-b,a.Sa(e),a.speed.y*=-a.qa,!0):!1}
function U(a,b,c,d,e,f,g){!a.G||!g&&a.S||!a.v||a.T||0>a.speed.x*e||(g=a.b.y+a.C.y-a.c.y/2,g+a.c.y<=c+1||g>=c+d-1||(c=a.C.x+a.c.x/2*e,d=a.Ya.x+c,g=a.b.x+c,!(0<e&&g>=b-1*f.step&&d<=b+(2+a.speed.x)*f.step||0>e&&g<=b+1*f.step&&d>=b-(2-a.speed.x)*f.step)))||(a.b.x=b-c,a.ba(e,f),a.speed.x*=-a.Ra)}class Za extends Wa{constructor(a,b){super(a,b);this.c=this.K.clone();this.fb=this.S=!1;this.qa=this.Ra=0}ga(){}ba(){}Sa(){}};class $a extends Za{constructor(){super(0,0);this.v=!1;this.f=new M(8,8);this.a=new t(.015,.1);this.qa=this.Ra=.75;this.c=new t(4,4);this.C=new t(0,7);this.g=!0}ja(a,b,c,d,e){this.b=new t(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.target.y=4;this.v=!0;K(this.f,4*Math.random()|0,e);this.g=!0}xb(){this.v=!1}s(a){this.v&&this.G&&this.f.s(a,a.A.chips,this.b.x-4,this.b.y+3,0)}ga(){!this.g&&.1>this.speed.y&&(this.v=!1);this.g=!1}};const ab=[1,4,8,2,9,6,3,5,12,10,7,13,14,11,15];class bb{constructor(){this.b=new t(0,0);this.c=this.g=this.speed=this.a=0;this.v=!1}ja(a,b,c,d,e){this.a=0;this.speed=d;this.g=c;this.c=e;this.b=new t(a,b);this.v=!0}update(a,b){this.v&&16<=(this.a+=this.speed*b.step)&&(ta(a.$,this.g,this.b.x,this.b.y+1,this.c+1),this.v=!1)}s(a){this.v&&z(a,a.A.tileset,this.c%16*16,16*(this.c/16|0),16,16,16*this.b.x,16*this.b.y+this.a|0,0)}}
function cb(a){a.$=ua(a.ga);a.I=ua(a.ba);for(let b of a.g)b.v=!1;for(let b of a.i)b.v=!1}
function db(a,b,c,d){if(b.v&&b.G&&!b.T){var e=b.b.x/16|0,f=b.b.y/16|0,g=e-2,h=f-2;e+=4;f+=4;for(let R=0;R<a.$.ea.length-1;++R)for(let S=h;S<=f;++S)for(let L=g;L<=e;++L){var l=sa(a.$,R,L,S);if(0!=l){var m=a.I.ea[0][l-1];if(null!=m)if(0<m&&m<=ab.length)eb(b,m-1,L,S,d);else{var r=a,n=b,u=m-1,I=l-1;l=L;m=S;var T=R,ka=c,v=d,A=[2,0,2,8],F=[8,2,0,2],W=[12,8,12,8],O=[8,12,8,12];switch(u){case 15:void 0!=n.Xa&&n.Xa(16*l,16*m,16,16,v);break;case 16:case 17:case 18:case 19:void 0!=n.Oa&&n.Oa(16*l+A[u-16],16*
m+F[u-16],W[u-16],O[u-16],3,v);break;case 20:case 21:case 22:case 23:case 24:if(void 0!=n.Ab&&(A=n.Ab(16*l+2,16*m,12,16,v)-1,2>A&&A>=u-20||2==A&&21!=u||0<=A&&23<=u)){ta(r.$,T,l,m,0);{let Ea,Fa;A=r;F=16*l+8;W=16*m+8;O=u-20;var X=Math.random()*Math.PI;let Ub=2*Math.PI/6;for(let Ga=0;6>Ga;++Ga)Fa=X+Ub*Ga,Ea=1.5*Math.random()+1,q(A.g,$a).ja(F,W,Math.cos(Fa)*Ea,Math.sin(Fa)*Ea*1.75,O);H(v.audio,v.o.B["break"],.5)}20==u?(sa(r.$,T,l,m-1)==I+1&&(ta(r.$,T,l,m-1,0),u=l,A=m-1,q(r.i,bb).ja(u,A,T,1,I)),fb(ka,
16*l+8,16*m+8,n.b)):23==u?gb(r,l,m):24==u&&hb(r,l,m);break}eb(n,14,l,m,v);break;case 25:if(n.fb)break;U(n,16*l+4,16*m,16,1,v);U(n,16*l+12,16*m,16,-1,v);void 0!=n.Oa&&n.Oa(16*l+2,16*m,14,16,3,v);break;case 26:if(n.fb)break;Xa(n,16*l,16*m+4,16,v);Ya(n,16*l,16*m+8,16,v);void 0!=n.Oa&&n.Oa(16*l,16*m+2,16,14,3,v);break;case 27:void 0!=n.Xa&&n.Xa(16*l+8,16*m,16,16,v);break;case 29:void 0!=n.ob&&n.ob(16*l,16*m+8,16,8,!0,v);break;case 30:void 0!=n.ob&&n.ob(16*l,16*m+2,16,14,!1,v);break;case 31:Xa(n,16*l,
16*(m+1),16,v);void 0!=n.Xa&&n.Xa(16*l,16*m+8,16,8,v,4);break;case 32:void 0!=n.Ib&&n.Ib(16*l,16*m,16,16)||eb(n,14,l,m,v)}}}}Ya(b,-256,20,512+16*a.width,d,!0)}}function ib(a,b,c,d){jb(b,a.$.ea[a.$.ea.length-1],a.width,a.height,c,d)}function eb(a,b,c,d,e){b=ab[b|0];1==(b&1)&&Xa(a,16*c,16*d,16,e);8==(b&8)&&Ya(a,16*c,16*(d+1),16,e);4==(b&4)&&U(a,16*(c+1),16*d,16,-1,e,!1);2==(b&2)&&U(a,16*c,16*d,16,1,e,!1)}
function kb(a,b,c,d){b=10*(b/10|0);c=9*(c/9|0);let e;for(let f=0;f<a.$.ea.length-1;++f)for(let g=c;g<c+9;++g)for(let h=b;h<b+10;++h)e=sa(a.$,f,h,g),d(e,f,h,g)}function gb(a,b,c){kb(a,b,c,(d,e,f,g)=>{252!=d&&253!=d||ta(a.$,e,f,g,252==d?253:252)})}function hb(a,b,c){kb(a,b,c,(d,e,f,g)=>{330!=d&&331!=d||ta(a.$,e,f,g,0)})}
function lb(a){let b=Array(a.width*a.height).fill(0);for(let d=0;d<a.$.ea.length-1;++d)for(let e=0;e<a.$.ea[d].length;++e){var c=a.$.ea[d][e]-1;c=a.I.ea[0][c]-1;29==c||30==c?b[e]=Math.max(b[e],1):0<=c&&14>=c?b[e]=Math.max(b[e],2):20<=c&&22>=c?b[e]=Math.max(b[e],3):15==c&&(b[e]=Math.max(b[e],4))}return{width:a.width,height:a.height,data:b}}
class mb{constructor(a,b){this.u=b;this.ga=a.Db[b?"intro":"base"];this.ba=a.Db.collisions;this.$=ua(this.ga);this.I=ua(this.ba);this.width=this.$.width;this.height=this.$.height;this.m=this.h=this.F=0;this.g=[];this.i=[];this.S=new M(16,16);this.c=Array(2).fill(0);this.a=Array(2).fill(0);this.j=Array(3).fill(0)}update(a,b){const c=[.25,.5,1];this.F=(this.F+.5*b.step)%96;this.h=(this.h+1*b.step)%128;this.m=(this.m+.125*b.step)%16;if(this.u){{var d=[.3,.4];const e=[.2,.3],f=[.025,.03];let g;for(let h=
0;2>h;++h)g=d[h]+e[h]*Math.sin(this.a[h]),this.c[h]+=g*b.step,this.c[h]%=64,this.a[h]+=f[h]*b.step,this.a[h]%=2*Math.PI}for(d=0;d<this.j.length;++d)this.j[d]=(this.j[d]+c[d]*b.step)%160}for(let e of this.g)e.Ma(a),e.update(b),db(this,e,null,b);for(let e of this.i)e.update(this,b);J(this.S,0,0,3,3,b.step)}s(a,b,c){let d=(10*b.P.x|0)-1;b=(9*b.P.y|0)-1;let e=(a.width/16|0)+2,f=(a.height/16|0)+2;for(let F=0;F<this.$.ea.length-1;++F){{var g=void 0,h=void 0,l=void 0,m=a,r=a.A[c?"tilesetNight":"tileset"],
n=F,u=d,I=b,T=e,ka=f;const W=[133,329,330];for(let O=I;O<I+ka;++O)for(let X=u;X<u+T;++X)if(l=sa(this.$,n,X,O),0!=l--)if(W.includes(l)){{var v=void 0;h=m;var A=r;g=X;v=O;let R=l%16|0,S=l/16|0,L=16*v;switch(l){case 133:L+=1+Math.round(Math.sin(this.m/16*Math.PI*2));v=this.m|0;v%2!=L%2&&++R;z(h,A,16*R+v,16*S,16-v,16,16*g,L,0);0<v&&z(h,A,16*R,16*S,v,16,16*(g+1)-v,L,0);break;case 329:case 330:A=this.S,z(h,h.A.electricity,A.width*this.S.c,A.height*(l-329),A.width,A.height,16*g,16*v,0)}}}else h=l%16|0,g=
l/16|0,z(m,r,16*h,16*g,16,16,16*X,16*O,0)}}for(let F of this.i)F.s(a);for(let F of this.g)F.s(a)}};function nb(a,b){a.T=!0;Q(a);H(b.audio,b.o.B.hit2,.5)}
class ob extends Za{constructor(){super(0,0);this.v=!1;this.f=new M(16,16);this.c=new t(2,2);this.K=new t(6,6);this.a=new t(.05,.05);this.g=1;this.fb=!0}ja(a,b,c,d,e,f,g){this.b=new t(a,b);this.speed=new t(c,d);this.target=this.speed.clone();f&&(this.target.y=2);this.g=null==g?1:g;K(this.f,0,e);this.v=!0;this.S=[2,3].includes(e)}pb(a){J(this.f,this.f.a,4,8,4,a.step);return 8==this.f.c}Ta(a){J(this.f,this.f.a,0,3,4,a.step)}xb(){this.v=!1}s(a){this.v&&this.G&&this.f.s(a,a.A.bullets,this.b.x-8,this.b.y-
8,0)}ga(a){nb(this,a)}Sa(a){nb(this,a)}ba(a,b){nb(this,b)}Fa(a,b){!this.v||!this.G||this.T||0<a.O||!Va(a,this)||(a.dir=a.b.x<this.b.x?1:-1,a.eb(this.g,b),nb(this,b))}};class V{constructor(a,b){this.b=new t(a,b);this.f=new M(16,16);this.G=!1;this.c=0;this.I=this.m=this.disabled=!1;this.K=new t(16,16)}Ma(a){this.G=Ta(a,this)}l(){}g(){}i(){}Fa(a,b,c,d){this.disabled||!this.G||b.T||(this.i(b),!this.m&&null!=d&&P(b,this.b.x-this.K.x/2,this.b.y-this.K.y/2,this.K.x,this.K.y)&&(this.l(b,d),b.M&&(b.Ga=!0,b.qb=0,oa(d.input)&&(this.I||H(d.audio,d.o.B.activate,.5),b.Ga=!1,this.g(a,b,c,d)))))}};function pb(a,b,c){switch(a){case 0:a=c.progress;a.Y+=2;a.na+=2;break;case 1:qb(c.progress,b);break;case 2:a=c.progress;a.keys+=1;break;case 3:a=c.progress;a.oa+=1;break;case 4:rb(c.progress)}}function sb(a,b,c,d){var e=["heart","item","key","orb","potion"];let f=e[c]+"Name";e=e[c]+"Desc";1==c?(c=a.obtain+" "+a[f][d],a=a[e][d]):(c=a.obtain+" "+a[f],a=a[e]);Y(b,c);for(let g of a)Y(b,g)}
class tb extends V{constructor(a,b,c,d){super(a,b);this.j=this.a=!1;this.type=c;this.id=d;this.c=0;K(this.f,((a/16|0)+(b/16|0))%4,2*this.type);this.u=0;this.K=new t(12,16)}update(a){this.G&&!this.a&&(this.j||J(this.f,2*this.type,0,3,8,a.step))}s(a){this.G&&this.f.s(a,a.A.chest,this.b.x-8,this.b.y-8,this.c)}g(a,b,c,d){this.j||this.a||(c=d.o.Z.en,ub(b,this.b.x,this.b.y,b.b.x<this.b.x?-1:1),this.disabled=this.j=!0,K(this.f,0,1+2*this.type),Ia(d.audio),sb(c,a,this.type,this.id),vb(a,e=>{if(0<this.u)return 0>=
(this.u-=e.step);J(this.f,2*this.type+1,0,4,3==this.f.c?30:6,e.step);4==this.f.c&&(this.a=!0,this.j=!1,this.u=60,K(this.f,3,2*this.type+1),wb(b,this.type,1==this.type?this.id:0),H(e.audio,e.o.B.treasure,.5));return!1}).H(e=>{Ja(e.audio);pb(this.type,this.id,b);b.progress.Pa[this.type][this.id]=!0},!1))}i(a){this.c=a.b.x<this.b.x?0:1}Da(a){if(this.a=a.Pa[this.type][this.id])this.j=!1,this.disabled=!0,K(this.f,3,1+2*this.type)}Lb(){return this.a&&!this.j}};class xb extends Za{constructor(){super(0,0);this.v=!1;this.f=new M(16,16);this.a=new t(.01,.05);this.qa=this.Ra=.75;this.c=new t(4,8);this.K=new t(8,8);this.C.y=-1;this.id=0;this.g=!1;this.i=!0}ja(a,b,c,d,e){this.b=new t(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.v=!0;this.id=e;K(this.f,0,e);this.g=!1;this.i=!0}Ta(a){this.a.x=.01;this.a.y=.05;this.target.y=2;this.g&&(this.i&&(this.speed.x/=2,this.speed.y/=2,this.i=!1),this.a.x/=2,this.a.y/=2,this.target.y/=2);this.g=!1;J(this.f,this.f.a,
0<=this.speed.x?0:3,0<=this.speed.x?3:0,6,a.step)}s(a){this.v&&this.G&&this.f.s(a,a.A.collectibles,this.b.x-8,this.b.y-8,0)}ab(a,b){this.Ma(a);this.G?a.ia||(U(this,a.P.x*a.width,a.P.y*a.height,a.height,-1,b),U(this,(a.P.x+1)*a.width,a.P.y*a.height,a.height,1,b)):this.v=!1}Fa(a,b,c){if(this.v&&Va(a,this)){if(0==this.id)yb(a.progress,1);else{var d=a.progress,e=2;d.J[19]&&(e*=2);d.Y=Math.min(d.na,d.Y+e)}this.v=!1;H(c.audio,c.o.B[["coin","heal"][this.id]],.6);c=a.b.x;a=a.b.y+a.C.y-a.f.height/2;d="+"+
String.fromCharCode(64+p(1,0,9))+String.fromCharCode(33+this.id);q(b.bb,zb).ja(c,a,1,16,30,d)}}ob(a,b,c,d){return P(this,a,b,c,d)?this.g=!0:!1}};class Ab extends V{constructor(a,b,c,d){super(a,b);this.active=!1;this.Jb=c;this.yb=null;this.f=new M(32,32);this.K=new t(8,32);this.id=d;this.Kb=!0;this.a=this.j=c}update(a){if(this.disabled=this.j&&!this.a)J(this.f,0,0,4,8,a.step),this.a=4==this.f.c;this.I=this.j&&this.a}s(a){this.G&&!this.a&&this.f.s(a,a.A.door,this.b.x-16,this.b.y-16,0)}g(a,b,c,d){let e=d.o.Z.en;this.j?(d.U.H(!0,1,1/30,f=>{let g=this.yb.b.clone();g.y+=8;b.moveTo(g,c);Bb(b,!0);f.U.C=new t(b.b.x%160,b.b.y%144)},null,new x(0,0,0)),
d.U.C=new t(this.b.x%160,this.b.y%144),b.b.x=this.b.x,Bb(b,!1),H(d.audio,d.o.B.door,.7)):0>=b.progress.keys?Y(a,e.needKey).H(()=>{},!1):Y(a,e.openDoor).H(f=>{this.j=!0;this.a=!1;var g=b.progress;g.keys+=-1;b.progress.wb[this.id]=!0;b.Wa=32;H(f.audio,f.o.B.open,.8)},!0)}Da(a){this.a=this.j=a.wb[this.id]}};function Cb(a,b){a.ca=b}function Db(a){a.va();a.O=0;a.Y=0;a.T=!0;a.g=0;K(a.f,0,0)}function Eb(a,b,c){b.move(c,0);a.Ba(b);a.f.s(b,b.A.enemies,Math.round(a.b.x+a.F.x-a.f.width/2),Math.round(a.b.y+a.F.y-a.f.height/2),a.g);b.move(-c,0)}
class Z extends Za{constructor(a,b,c,d,e){super(a,b);this.I=this.b.clone();this.f=new M(16,16);K(this.f,0,c+1);this.Y=this.na=d;this.Za=e;this.O=0;this.Ua=this.Ia=-1;this.dir=1;this.g=0;this.M=!1;this.a=new t(.1,.1);this.j=1;this.K=new t(8,8);this.c=new t(8,8);this.F=new t(0,0);this.ha=!1;this.ca=()=>{};this.fb=this.Bb=this.wa=this.Ha=this.ra=this.hb=!1}V(){}m(){}i(){}u(){}Ja(){}va(){}pb(a){J(this.f,0,0,4,6,a.step);return 4<=this.f.c}H(){this.S=this.ha=!1;this.V(this.I.x,this.I.y)}Ta(a){this.ha||
(this.m(a),this.i(a),0<this.O&&(this.O-=a.step))}kb(){this.M=!1}eb(a,b,c,d,e){this.Y-=b;this.hb||(this.speed.x=this.j*a);this.O=30+this.O%2;0>=this.Y&&(this.va(),Db(this),fb(c,this.b.x,this.b.y+this.C.y,d.b));H(e.audio,e.o.B[this.T?"kill":"hit"],.6);a=this.b.x;d=this.b.y+this.C.y-this.f.height/2;q(c.bb,zb).ja(a,d,1,16,30,"-"+String(b))}Fa(a,b,c){if(this.v&&!this.T&&this.G&&!this.ha&&(this.u(a),0>=this.O&&!this.Ha&&a.Oa(this.b.x+this.C.x-this.K.x/2,this.b.y+this.C.y-this.K.y/2,this.K.x,this.K.y,this.Za,
c)&&this.Ja(c),!this.ra))if(Fb(a)&&a.rb>this.Ia&&ba(this.b,this.C,this.K,a.pa.x-a.Aa.x/2,a.pa.y-a.Aa.y/2,a.Aa.x,a.Aa.y)){var d=a.progress.J[23]?3:2;a.fa?++d:a.ua&&(d*=2);this.eb(a.fa?0:2*a.dir*(a.ua?1.5:1),d,b,a,c);this.Ia=a.rb;!this.T&&a.ua&&0<a.X&&(a.speed.x=0,a.target.x=0);a.fa&&(a.fa=!1,a.ma=4,a.za=!1)}else a.R.v&&a.R.cb>this.Ua&&Va(this,a.R)&&(this.eb(2*(this.b.x<a.R.b.x?-1:1),a.progress.J[24]?2:1,b,a.R,c),b=a.R,b.i||b.g||(Q(b),b.m=0,b.g=!0),this.Ua=a.R.cb)}Ba(){}s(a,b){this.ha||!this.v||!this.G||
0<this.O&&0==Math.floor(this.O/2)%2||(Eb(this,a,0),b.ia&&(Eb(this,a,b.ta*b.width),Eb(this,a,-b.ta*b.width)))}ga(){this.M=!0}ab(a,b){if(this.v){var c=this.G;this.G=this.G&&a.gb&&a.ia||Ta(a,this);if(!this.G){if(this.T){this.v=!1;return}if(this.ha){this.H();return}}!this.T&&this.G!=c&&c&&(this.b=this.I.clone(),Q(this),this.Y=this.na,this.O=0,a.ia||(this.S=this.ha=!0));if(!a.ia&&this.G){c=a.P.x*a.width;var d=a.P.y*a.height;U(this,c,d,a.height,-1,b,!0);U(this,c+a.width,d,a.height,1,b,!0);this.wa&&(Xa(this,
c,d+a.height,a.width,b,!0),Ya(this,c,d,a.width,b,!0))}}}sa(){}};function Gb(a){const b=[Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Vb,Wb,Xb,Yb,Zb,$b,ac,bc];return b[p(a,0,b.length-1)|0]}
class Hb extends Z{constructor(a,b){super(a,b,0,3,2);this.a.x=.025;this.h=!0;this.C.y=2;this.c=new t(4,12);this.F.y=1;this.j=.5}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.x=.25;this.speed.x=this.target.x}m(a){this.target.x=.25*this.dir;this.target.y=2;this.h&&!this.M&&0>=this.O&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.h=this.M}i(a){this.g=0<this.dir?1:0;this.M&&J(this.f,this.f.a,0,3,6,a.step)}ba(){this.speed.x*=-1;this.target.x*=-1;
this.dir*=-1}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class Ib extends Z{constructor(a,b){super(a,b,1,2,1);this.C.y=2;this.c=new t(4,12);this.F.y=1;this.a.y=.05;this.j=.5;this.h=0}V(a){this.h=60-(a/16|0)%2*30}m(a){this.target.y=2;this.M&&0>=(this.h-=a.step)&&(this.h+=60,this.speed.y=-1.75,H(a.audio,a.o.B.jump2,.5))}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);K(this.f,a,this.f.a)}u(a){this.dir=a.b.x>this.b.x?1:-1}}
class Kb extends Z{constructor(a,b){super(a,b,3,2,1);this.a.x=.1;this.l=!0;this.C.y=4;this.c=new t(4,8);this.K=new t(8,6);this.F.y=1;this.j=.5;this.h=!1}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}m(a){this.target.x=0;this.target.y=2;0!=this.f.c%2&&(this.target.x=.6*this.dir);!this.h&&this.l&&!this.M&&0>=this.O&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.l=this.M}i(a){this.g=0<this.dir?1:0;this.M?J(this.f,this.f.a,0,3,0==this.f.c%2?30:6,a.step):K(this.f,
2,this.f.a)}ba(a){this.dir=-a}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}u(a){this.h=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class Jb extends Z{constructor(a,b){super(a,b,2,3,2);this.C.y=2;this.c=new t(4,10);this.F.y=0;this.a.x=.05;this.a.y=.1;this.j=.5;this.l=60+(a/16|0)%2*30;this.h=1-(a/16|0)%2*2;this.Ra=-1}V(){}m(a){this.target.y=4;this.M?(this.target.x=0,0>=(this.l-=a.step)&&(this.l+=60,this.speed.y=-2.5,this.target.x=.5*this.h,this.speed.x=this.target.x,this.dir=this.h,H(a.audio,a.o.B.jump2,.5))):this.dir=0<=this.speed.x?1:-1}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);K(this.f,
a,this.f.a)}u(a){this.h=a.b.x>this.b.x?1:-1;if(Fb(a)||a.R.v&&!a.R.g)this.h*=-1}ba(a){this.dir=-a}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.speed.x*=-1,this.dir*=-1}}
class Lb extends Z{constructor(a,b){super(a,b,4,3,2);this.a.x=.05;this.C.y=2;this.c=new t(4,12);this.F.y=1;this.j=.75;this.h=60;this.l=!0;this.L=0;this.D=1;this.W=0}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.h=60;this.l=!0}m(a){this.target.y=3;let b=this.D;0>=(this.h-=a.step)&&(this.h+=60,this.l&&(this.D+=this.L,this.L=b,20<=++this.W&&(this.W=0,this.D=1,this.L=0),this.dir=1-this.D%2*2,this.h+=(this.b.x|0)%60),this.l=!this.l);this.target.x=this.l?0:.5*this.dir}i(a){this.g=0<this.dir?1:
0;this.M?this.l?K(this.f,0,this.f.a):J(this.f,this.f.a,0,3,8,a.step):K(this.f,4,this.f.a)}ba(){this.l||(this.dir*=-1)}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}}
class Mb extends Z{constructor(a,b){super(a,b,5,2,1);this.a.x=.015;this.a.y=.015;this.c=new t(4,4);this.j=.33;this.l=30;this.h=!0;this.D=new t(0,0);this.qa=this.Ra=1}V(){}m(a){0>=(this.l-=a.step)&&(this.l+=this.h?60:30,this.h?(this.speed.x=.5*this.D.x,this.speed.y=.5*this.D.y):ca(this.target),this.h=!this.h);this.h||(this.target=this.speed.clone())}i(a){J(this.f,this.f.a,0,3,this.h?5:3,a.step)}u(a){this.h&&(this.D=w(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0))}sa(a){this.h||(a=w(new t(this.b.x-a.b.x,
this.b.y-a.b.y),!0),this.speed.x=.5*a.x)}}
class Nb extends Z{constructor(a,b){super(a,b,6,3,2);this.a.x=.033;this.a.y=.033;this.c=new t(6,6);this.j=.5;this.l=new t(0,0);this.active=!1;this.h=0}V(){this.b.y-=4;this.active=!1;this.h=0}m(a){this.active&&(0<this.h?this.h-=a.step:(this.target.x=.33*this.l.x,this.target.y=.33*this.l.y))}i(a){this.active?0<this.h?K(this.f,1,this.f.a):J(this.f,this.f.a,1,4,6,a.step):K(this.f,0,this.f.a);this.g=0<this.h?2:0}u(a){if(this.active)this.l=w(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0);else if(this.active=
0<this.O||a.b.y>this.b.y&&48>Math.abs(a.b.x-this.b.x))this.h=30,this.target.y=1}}
class cc extends Z{constructor(a,b,c,d,e,f,g,h){super(a,b,c,d,e);this.a.x=.025;this.c=new t(8,8);this.K=new t(10,8);this.j=.5;this.h=0;this.l=f;this.L=g;this.D=h}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.h=(this.b.x+this.b.y)%(2*Math.PI)}m(a){this.target.x=this.D*this.dir;this.h=(this.h+this.L*a.step)%(2*Math.PI);this.b.y=this.I.y+Math.round(Math.sin(this.h)*this.l)}ba(){this.speed.x*=-1;this.target.x*=-1;this.dir*=-1}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=
-1,this.speed.x*=-1,this.target.x*=-1}}class Ob extends cc{constructor(a,b){super(a,b,7,3,2,2,.1,.125)}i(){this.g=0<this.dir?1:0;let a=1,b=Math.sin(this.h);-.5>b?a=0:.5<b&&(a=2);K(this.f,a,this.f.a)}}function dc(a,b){a.speed.y=-1;H(b.audio,b.o.B.jump2,.5)}
class Pb extends Z{constructor(a,b){super(a,b,8,2,1);this.C.y=2;this.c=new t(4,12);this.F.y=1;this.a.y=.025;this.j=.5;this.h=0}V(a){this.h=60-(a/16|0)%2*30}m(a){const b=this.target.y/3;this.target.y=2;this.M?0>=(this.h-=a.step)&&dc(this,a):0>=this.h&&this.speed.y>=b&&dc(this,a)}i(){this.g=0<this.dir?1:0;let a=0;.25<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);K(this.f,a,this.f.a)}Sa(){this.h=60}}
class ec extends Z{constructor(a,b,c,d,e){super(a,b,c,d,e);this.C.y=2;this.c=new t(4,12);this.F.y=1;this.j=.5;this.h=!1;this.l=60-(a/16|0)%2*30;this.W=!1}V(){}D(){}m(a){this.target.y=2;!this.h&&0>=(this.l-=a.step)&&(K(this.f,1,this.f.a),this.h=!0,this.l=60,this.D(a))}i(a){this.g=0<this.dir?1:0;this.h?(J(this.f,this.f.a,1,3,1==this.f.c?6:30,a.step),3==this.f.c&&(K(this.f,this.W?1:0,this.f.a),this.h=!1)):0!=this.f.c?J(this.f,this.f.a,1,0,6,a.step):K(this.f,0,this.f.a)}u(a){this.dir=a.b.x>this.b.x?1:
-1}}class Qb extends ec{constructor(a,b){super(a,b,9,3,2)}D(a){this.ca(this.b.x+4*this.dir,this.b.y,2*this.dir,0,0,!1,1);H(a.audio,a.o.B.snowball,.5)}}class Rb extends cc{constructor(a,b){super(a,b,10,3,2,4,.1,.33);this.a.x=.025;this.j=.5}i(a){this.g=0<this.dir?1:0;J(this.f,this.f.a,0,3,4,a.step)}}function fc(a,b,c){a.h&&(a.speed.y=b,H(c.audio,c.o.B.jump2,.5))}
class Sb extends Z{constructor(a,b){super(a,b,11,6,3);this.a.x=.025;this.C.y=2;this.c=new t(4,12);this.F.y=1;this.j=.33;this.L=this.l=!1;this.D=0;this.h=!1}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}m(a){this.target.x=.33*this.dir;this.target.y=4;!this.M&&this.h&&0<this.speed.x/this.dir&&this.L&&fc(this,-2.5,a);(this.h=this.M)&&this.l&&fc(this,-p(this.D/16,1.75,2.75),a)}i(a){this.g=0<this.dir?1:0;let b=5;this.M?J(this.f,this.f.a,0,3,8,a.step):(-.5>this.speed.y?b=4:.5<this.speed.y&&(b=6),K(this.f,
b,this.f.a))}ba(a,b){this.dir==a&&fc(this,-2.75,b)}u(a){this.L=a.b.y<this.b.y;this.l=48>this.b.y-a.b.y&&24<this.b.y-a.b.y&&a.M;this.dir=a.b.x>this.b.x?1:-1;this.D=Math.abs(a.b.y-this.b.y)}}class Tb extends ec{constructor(a,b){super(a,b,12,3,2);this.W=!0;this.L=0}D(a){this.ca(this.b.x+2*this.dir,this.b.y-4,this.L/80,-2,1,!0,1);H(a.audio,a.o.B.snowball,.5)}u(a){this.dir=a.b.x>this.b.x?1:-1;this.L=a.b.x-this.b.x}}
class Vb extends Z{constructor(a,b){super(a,b,13,6,3);this.a.y=.1;this.c=new t(16,14);this.F.y=2;this.K=new t(12,12);this.C.y=2;this.j=.5;this.h=this.D=!1;this.l=0;this.hb=this.L=!0;this.I.y-=2;--this.b.y}V(){--this.b.y;this.h=this.D=!1;this.l=0;this.L=!0}m(a){0<this.l&&0>=(this.l-=a.step)&&(this.h=!0);this.h&&(this.target.y=-.5,this.speed.y=-.5,this.b.y<this.I.y&&(this.b.y=this.I.y,this.h=!1,Q(this)))}i(){let a=0;this.D?a=1:0<this.l?a=2:this.h&&(a=3);K(this.f,a,this.f.a)}u(a){0>=this.l&&!this.D&&
!this.h&&a.b.y>this.b.y&&24>Math.abs(a.b.x-this.b.x)&&(this.D=!0,this.target.y=6)}ga(a){this.D&&(this.l=60,this.L=this.D=!1,H(a.audio,a.o.B.quake,.4))}Sa(){this.h&&(this.b.y=this.I.y,Q(this),this.h=!1)}Ba(a){this.L||(a.nb=this.l,a.mb=new t(3,3),this.L=!0)}}
class Wb extends Z{constructor(a,b){super(a,b,14,5,3);this.C.y=2;this.c=new t(4,10);this.F.y=0;this.a.x=.025;this.a.y=.1;this.j=.5;this.dir=1-(a/16|0)%2*2;this.qa=this.Ra=-1}V(a){this.dir=1-(a/16|0)%2*2;this.target.x=.5*this.dir;this.speed.x=this.target.x}m(){this.target.x=.5*this.dir;this.target.y=4}i(a){J(this.f,this.f.a,0,3,6,a.step);this.g=0>this.dir?0:1}ba(a){this.dir=-a;this.speed.x*=-1;this.target.x=this.speed.x}ga(a){this.speed.y=-2.25;H(a.audio,a.o.B.jump2,.5)}sa(a){if(0<this.speed.x&&a.b.x>
this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class Xb extends Z{constructor(a,b){super(a,b,15,3,2);this.a.x=.015;this.a.y=.033;this.c=new t(6,6);this.j=.5;this.l=new t(0,0);this.h=0}V(){this.h=Math.random()*Math.PI*2;this.S=!0}m(a){this.h=(this.h+.05*a.step)%(2*Math.PI);this.target.x=.33*this.l.x;this.target.y=.33*(this.l.y+1.5*Math.sin(this.h))}i(){let a=1;-.125>this.speed.y?a=0:.125<this.speed.y&&(a=2);K(this.f,a,this.f.a);this.g=0<this.target.x?1:0}u(a){this.l=w(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class Yb extends Z{constructor(a,b){super(a,b,16,3,2);this.a.y=.05;this.c=new t(6,6);this.j=.5;this.l=this.L=0;this.wa=!0;this.qa=-1;this.W=this.h=this.D=0;this.la=new t(0,0)}V(a,b){this.l=Math.random()*Math.PI*2;this.h=0;this.L=0==(b/16|0)%2?1:-1;this.W=0;this.D=120-(a/16|0)%2*60}m(a){this.b.x=this.I.x+Math.round(4*Math.sin(this.W));0<this.h?this.h-=a.step:(this.W=(this.W+.05*a.step)%(2*Math.PI),this.l=(this.l+.1*a.step)%(2*Math.PI),this.target.y=this.L*(Math.sin(this.l)+.2)*.5,0>=(this.D-=a.step)&&
(this.ca(this.b.x+4*(0==this.g?-1:1),this.b.y+2,1*this.la.x,1*this.la.y,2,!1,2),H(a.audio,a.o.B.snowball,.5),this.h=30,Q(this),this.D+=120))}i(){if(0<this.h)K(this.f,3,this.f.a);else{var a=1;-.25>this.speed.y?a=0:.25<this.speed.y&&(a=2);K(this.f,a,this.f.a);this.g=0<this.target.x?1:0}}ga(){this.L=-1;this.target.y*=-1;this.l=0}Sa(){this.L=1;this.target.y*=-1;this.l=0}u(a){this.g=a.b.x<this.b.x?0:1;this.la=w(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class Zb extends Z{constructor(a,b){super(a,b,17,1,3);this.a.x=.025;this.C.y=2;this.c=new t(4,12);this.F.y=1;this.j=.33}V(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}m(){this.target.x=this.dir;this.target.y=4}i(a){this.g=0<this.dir?1:0;this.M?J(this.f,this.f.a,0,3,6,a.step):K(this.f,4,this.f.a)}u(a){this.dir=a.b.x>this.b.x?1:-1}Ja(a){H(a.audio,a.o.B.kill,.6);Db(this)}va(){let a;for(let b=0;4>b;++b)a=Math.PI/4+b*Math.PI/2,this.ca(this.b.x,this.b.y+this.C.y,2*Math.cos(a),2*Math.sin(a),3,!1,2)}}
class $b extends Z{constructor(a,b){super(a,b,18,1,1);this.a.y=.1;this.c=new t(8,10);this.F.y=2;this.C.y=2;this.j=.5;this.ra=this.hb=!0;this.I.y-=4;this.b.y-=4;this.l=this.h=0;this.Bb=!0}V(a){this.h=0;this.l=60-(a/16|0)%2*60/2;K(this.f,8,this.f.a)}m(a){this.Ha=this.ra=2!=this.h;this.target.y=0;0==this.h?0>=(this.l-=a.step)&&(this.h=1,K(this.f,0,this.f.a)):2==this.h&&(this.target.y=2)}i(a){0==this.h?K(this.f,8,this.f.a):1==this.h?(J(this.f,this.f.a,0,4,10,a.step),4==this.f.c&&(this.h=2)):3==this.h&&
(J(this.f,this.f.a,5,8,6,a.step),8==this.f.c&&(this.h=0,this.b=this.I.clone(),this.l=60))}ga(a){2==this.h&&(this.h=3,Q(this),H(a.audio,a.o.B.blob,.7))}}
class ac extends Z{constructor(a,b){super(a,b,19,6,3);this.a.x=.05;this.L=!0;this.C.y=2;this.c=new t(8,12);this.F.y=1;this.j=.75;this.D=!1;this.l=0;this.h=!1}V(a){this.h=!1;this.l=60-(a/16|0)%2*60/2;this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0}m(a){this.target.x=.5*this.dir;this.target.y=4;!this.D&&this.L&&!this.M&&0>=this.O&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.L=this.M;0>=(this.l-=a.step)&&(this.h=!this.h,this.l+=this.h?30:60,this.h&&(this.ca(this.b.x+
8*this.dir,this.b.y+2,2*this.dir,0,4,!1,2),H(a.audio,a.o.B.snowball,.5)))}i(a){this.g=0<this.dir?1:0;let b=this.h?5:0;this.M?J(this.f,this.f.a,b,b+3,8,a.step):K(this.f,b+4,this.f.a)}ba(a){this.dir=-a}sa(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}u(a){this.D=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class bc extends Z{constructor(a,b){super(a,b,20,6,3);this.a.x=.025;this.a.y=.025;this.c=new t(6,6);this.j=.66;this.D=0;this.L=new t(0,0);this.W=new t(0,0);this.la=this.h=this.l=0;this.wa=!0}V(a){this.D=this.b.y%(2*Math.PI);this.S=!0;this.l=120-(a/16|0)%2*120/2}m(a){0<this.h?this.h-=a.step:(this.target.x=.75*this.L.x,this.target.y=.75*this.L.y,this.D=(this.D+.025*a.step)%(2*Math.PI),0>=(this.l-=a.step)&&(this.ca(this.b.x,this.b.y,1.5*this.W.x,1.5*this.W.y,3,!1,2),H(a.audio,a.o.B.snowball,.5),this.h=
30,this.la=this.f.c,K(this.f,this.f.c+5,this.f.a),Q(this),this.l+=120))}i(a){0<this.h?K(this.f,this.la+Math.floor(this.h/8)%2*5,this.f.a):(J(this.f,this.f.a,0,4,5,a.step),this.g=0<this.target.x?1:0)}u(a){this.L=w(new t(a.b.x+32*Math.cos(this.D)-this.b.x,a.b.y+32*Math.sin(this.D)-this.b.y),!0);this.W=w(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}};class zb{constructor(){this.b=new t(0,0);this.speed=0;this.text="";this.c=this.a=0;this.v=!1}ja(a,b,c,d,e,f){this.b=new t(a,b);this.speed=c;this.a=d;this.c=e;this.text=f;this.v=!0}update(a){this.v&&(0<this.a?(this.a-=a.step,this.b.y-=this.speed):0>=(this.c-=a.step)&&(this.v=!1))}s(a){this.v&&C(a,a.A.spcfont,this.text,this.b.x|0,this.b.y-5|0,-3,0,!0)}};class gc extends V{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new M(32,32);K(this.f,0,1);this.S=new M(24,24);this.K=new t(12,16);this.progress=c;this.h=-1;this.a=c.jb;this.u=c.Ea;this.j=Math.PI/2;this.F=0;this.ga=this.b.y;this.ca=d;this.ba=!1;this.qa=()=>{}}update(a){const b=[4,2];this.ba?(this.qa(a),this.ba=!1):this.G&&!this.u&&(this.a&&(J(this.S,0,1,4,1==this.S.c?30:8,a.step),this.j+=.05*a.step,0==this.F&&this.j>=2*Math.PI&&(this.F=1),this.j%=2*Math.PI),this.ga=this.b.y-b[0]+Math.round(Math.sin(this.j)*
b[this.F]))}s(a){if(this.G)if(this.u)this.f.s(a,a.A.nightOrb,this.b.x-16,this.b.y-20+1,!1);else if(this.S.s(a,a.A.nightOrb,this.b.x-12,this.ga-12+1,!1),!this.a){var b=String.fromCharCode(24)+String.fromCharCode(25)+String(this.progress.oa)+"/"+String(this.h);C(a,a.A.font,b,this.b.x-4,this.b.y-24,-1,0,!0)}}g(a,b,c,d){Y(a,d.o.Z.en[this.a?"nightOrbOverdrive":"nightOrbActivate"]).H(e=>{b.b.x=this.b.x;this.a?(b.Wa=60,hc(b),Ka(e.audio),H(e.audio,e.o.B.night,.6),this.ba=!0,this.qa=f=>{f.U.H(!0,3,1/120,g=>
{b.ya=new t(this.b.x,this.b.y+4);this.u=!0;this.progress.Ea=!0;this.ca(g)},new t(80,4))}):(this.a=!0,this.progress.oa=0,this.progress.jb=!0,b.Wa=90,Bb(b,!1))},!0)}i(){this.a=this.progress.jb;this.m=this.u||!this.a&&this.progress.oa<this.h||this.a&&0==this.F}};class ic extends V{constructor(a,b,c,d){super(a,b);this.u=c;K(this.f,((a/16|0)+(b/16|0))%4,d?1:0);this.K=new t(10,16);this.j=d}update(a){this.G&&!this.a&&J(this.f,this.f.a,0,3,10,a.step)}s(a){this.G&&this.f.s(a,a.A.npc,this.b.x-8,this.b.y-8+1,this.c)}g(a,b,c,d){b=d.o.Z.en;b=this.j?b.meow:b.npc[this.u];for(let e of b)Y(a,e);a.H(()=>{},!1)}i(a){this.c=a.b.x<this.b.x?0:1}};class jc{constructor(){this.b=new t(0,0);this.a=0;this.speed=1;this.v=!1}ja(a,b,c){this.b.x=a;this.b.y=b;this.speed=c;this.a=1;this.v=!0}update(a){this.v&&0>=(this.a-=this.speed*a.step)&&(this.v=!1)}s(a){this.v&&z(a,a.A.figure,16*(5+p(Math.round(5*(1-this.a)),0,4)),80,16,16,Math.round(this.b.x-8),Math.round(this.b.y-8),0)}}
class kc extends Za{constructor(){super(0,0);this.f=new M(16,16);this.g=!1;this.m=0;this.I=null;this.h=0;this.a=new t(.1,.1);this.c=new t(4,4);this.K=new t(10,10);this.j=this.G=this.v=!1;this.cb=0;this.F=[];this.u=0;this.i=!1;this.fb=!0;this.l=!1}ja(a,b,c,d,e,f,g,h){this.b=new t(a,b);this.speed=new t(c,d);this.target=this.speed.clone();this.g=!1;this.m=e;this.I=f;this.h=this.speed.length();this.G=this.v=!0;this.j=this.S=this.T=!1;++this.cb;this.i=g;this.l=h}Cb(a){if(this.i){for(let b of this.F)b.update(a);
this.v&&0>=(this.u-=a.step)&&(q(this.F,jc).ja(this.b.x,this.b.y,.05),this.u+=6)}}Ta(a){let b=new t(this.b.x-this.I.b.x,this.b.y-this.I.b.y),c=b.length();w(b,!1);this.g?(this.target.x=-b.x*this.h,this.target.y=-b.y*this.h,this.j||(this.j=Math.sign(this.target.x)==Math.sign(this.speed.x)&&Math.sign(this.target.y)==Math.sign(this.speed.y)),12>c&&(this.v=!1)):0>=(this.m-=a.step)&&(this.i&&++this.cb,this.g=!0);J(this.f,this.l?10:5,1,4,4,a.step);this.S=this.g&&this.j}s(a){this.v&&this.f.s(a,a.A.figure,
this.b.x-8|0,this.b.y-8|0,0<=this.speed.x?0:1)}ba(){this.j=!0;this.g||(this.m=0,this.g=!0,this.i&&++this.cb)}Ab(a,b,c,d){return this.v&&P(this,a,b,c,d)?this.i?3:1:0}};function qb(a,b){a.J[b]=!0;13==b&&yb(a,50)}function rb(a){a.Y=a.na}function lc(a){a.Y=6;a.J[12]&&(a.Y=Math.min(a.na,12))}function yb(a,b){a.Na+=b}
class mc{constructor(a,b){this.Y=this.na=6;this.oa=this.keys=this.Na=this.Gb=0;this.Pa=Array(4);for(let c=0;c<this.Pa.length;++c)this.Pa[c]=Array(4).fill(!1);this.wb=Array(16).fill(!1);this.Ca=Array(10).fill(!1);this.J=Array(32).fill(!1);this.Qa=Array(a*b).fill(!1);this.c=a;this.Ea=this.jb=this.a=!1}removeItem(a){this.J[a]=!1}vb(a,b){this.a||(this.Qa[b*this.c+a]=!0)}};function ub(a,b,c,d){a.b.x=b+8*d;a.b.y=c;a.dir=d;a.g=0<d?1:0;K(a.f,4,6);a.O=0}function wb(a,b,c){K(a.f,0,8);a.W=new t(c,b);a.O=0;a.va=!0}function Bb(a,b){K(a.f,b?1:2,8);a.O=0}function Fb(a){return a.fa&&0<=a.speed.y||a.wa&&a.X>(a.ua?0:11)}function hc(a){K(a.f,3,8);a.g=0}
function nc(a,b){a.u&&(a.dir*=-1,a.g=0==a.g?1:0);a.h=!1;a.X=16;Q(a);b?a.i||(a.speed.x=1.25*a.dir,a.target.x=a.speed.x):a.progress.J[7]&&(a.X+=12);a.ua=b;a.ma=0;a.j=0;a.wa=!0;var c=a.b.y+2;a.pa.x=a.b.x+14*a.dir;a.pa.y=c;a.Aa.x=16;a.Aa.y=b?10:8;++a.rb}function oc(a,b,c){!c&&a.progress.J[22]?(rb(a.progress),a.T=!1,H(b.audio,b.o.B.heal,.6),Y(a.message,b.o.Z.en.lifePotionUsed).H(()=>{a.progress.removeItem(22)},!1)):(a.T=!0,K(a.f,0,7),Q(a),Ka(b.audio),H(b.audio,b.o.B.die,.5))}
class pc extends Za{constructor(a,b,c,d){super(a,b);this.ya=new t(a,b);this.Fb=null;this.f=new M(16,16);K(this.f,4,4);this.Ba=new M(16,16);this.g=0;this.a=new t(.1,.15);this.C=new t(0,2);this.K=new t(8,12);this.c=new t(6,12);this.M=!1;this.ma=0;this.za=!1;this.I=0;this.m=this.L=this.zb=this.i=!1;this.ha=0;this.ra=!1;this.j=0;this.Ja=!1;this.X=0;this.D=this.h=this.wa=!1;this.Ha=0;this.ua=!1;this.pa=new t(0,0);this.Aa=new t(0,0);this.rb=0;this.fa=!1;this.ca=0;this.u=!1;this.Eb=this.F=0;this.R=new kc;
this.R.v=!1;this.dir=1;this.l=this.O=0;this.progress=c;this.message=d;this.Za=this.Ia=!1;this.G=!0;this.Ua=0;this.Ga=!1;this.la=this.qb=0;this.W=null;this.Wa=0;this.va=!1;this.vb()}vb(){this.progress.vb((this.b.x/16|0)/10|0,(this.b.y/16|0)/9|0)}Ta(a){if(!this.va){this.L&&!this.i&&(this.L=!1);this.dir=0==this.g?1:-1;var b=a.input.actions.fire2.state;(b=b==E||b==D)&&this.progress.J[7]&&(this.D&&b?(this.D=!1,this.Ha=0,nc(this,!0),H(a.audio,a.o.B.powerAttack,.6)):!this.ua&&0<this.X&&12>=this.X&&(this.X=
0));if(!(0<this.X||this.fa||this.Ja||(this.target.y=2,0<this.l))){this.target.x=1*a.input.N.x;this.u&&!this.m&&(this.target.y*=.25);this.a=new t(.1,.15);this.progress.J[17]&&(this.target.x*=1.2,this.a.x*=1.2);a:if(this.progress.J[0]){if(a.input.actions.fire2.state==G){if(this.progress.J[6]&&!this.i&&!this.m&&!this.M&&.1<a.input.N.y){Q(this);this.speed.y=-2;this.target.y=4;this.a.y=.35;this.fa=!0;this.ca=0;b=this.b.y+16;this.pa.x=this.b.x;this.pa.y=b;this.Aa.x=8;this.Aa.y=12;++this.rb;H(a.audio,a.o.B.downAttack,
.6);b=!0;break a}if(this.h){nc(this,!1);H(a.audio,a.o.B.sword,.5);b=!0;break a}}b=!1}else b=void 0;if(b=!b)!this.progress.J[2]||this.R.v?b=!1:(this.u&&(this.dir*=-1,this.g=0==this.g?1:0),a.input.actions.fire3.state==G?(this.R.ja(this.b.x+4*this.dir,this.b.y+2,2*this.dir,0,24,this,this.progress.J[11],this.progress.J[24]),this.R.Ya.x=this.b.x,Q(this),this.X=30,this.wa=!1,this.j=this.ma=0,H(a.audio,a.o.B["throw"],.6),b=!0):b=!1),b=!b;if(b&&(this.m&&(this.a.x*=.5,this.a.y*=.25,this.target.x*=.5,this.target.y*=
.25,this.u=!1,this.F=0),b=a.input.actions.fire1.state,this.i?(.1<a.input.N.x?this.g=0:-.1>a.input.N.x&&(this.g=1),this.target.y=.5*a.input.N.y,this.target.x=0,b==G&&(.1>a.input.N.y&&(this.ma=14),this.L=this.i=this.za=!1,H(a.audio,a.o.B.jump,.5)),b=!0):b=!1,!b)){b=a.input.actions.fire1.state;if(b==G)if(this.progress.J[5]&&!this.m&&this.M&&.1<a.input.N.y)this.j=20,H(a.audio,a.o.B.jump,.5);else{if(this.M||0<this.I||this.progress.J[10]&&!this.za||0<this.F)this.ma=(this.za=!this.M&&0>=this.I&&0>=this.F)?
8:14,this.M=!1,this.I=0,0<this.F&&(this.speed.x=-2*this.Eb),this.u=!1,this.F=0,this.h=!0,this.Za=!1,H(a.audio,a.o.B.jump,.5)}else b==E&&(0<this.ma?this.ma=0:0<this.j&&!this.Ja&&(this.j=0),this.Za=!0);if(this.Ia=!this.M&&this.progress.J[9]&&this.Za&&(!this.progress.J[10]||this.za)&&0>=this.X&&1==(b&1)&&0>=this.ma)this.target.y=.5,this.speed.y=this.target.y}}0<this.X&&this.ua?this.pa.x+=this.speed.x*a.step:this.fa&&(this.pa.y+=this.speed.y*a.step);a:{b=1/30;if(this.progress.J[3]&&!this.progress.J[4]&&
this.ra&&this.m){if(0>=(this.ha-=a.step)){oc(this,a);break a}}else this.ha=0;this.Ga&&(this.la+=b*a.step,this.la%=1);0<this.ma&&(this.speed.y=-2,this.m&&this.progress.J[3]&&(this.speed.y*=.5,this.target.y*=.5),this.ma-=(this.progress.J[1]?1:2)*a.step);0<this.j&&(this.speed.x=2*this.dir,this.target.x=this.speed.x,this.j-=a.step);0<this.I&&(this.I-=a.step);0<this.F&&(this.F-=a.step);0<this.X&&(this.X-=a.step,this.progress.J[7]&&!this.ua&&this.wa&&0>=this.X&&(this.D=!0,H(a.audio,a.o.B.charge,.5)));0<
this.ca&&0>=(this.ca-=a.step)&&(this.fa=!1);this.D&&(this.Ha=(this.Ha+a.step)%20);0<this.O&&(0<this.l?(this.l-=a.step,0>=this.progress.Y&&0>=this.l&&oc(this,a)):this.O-=a.step)}{let c=this.f.c,d=this.f.a;if(!this.va)if(0<this.l)K(this.f,0,5);else if(this.fa)K(this.Ba,3,4),K(this.f,1,4);else if(b=this.progress.J[23]?9:4,0<this.X)K(this.f,0,4),this.ua?J(this.Ba,b,7,8,4,a.step):K(this.Ba,2,b);else if(0<this.j)K(this.f,4,1);else if(.1<Math.abs(this.target.x)&&(this.g=0>this.target.x?1:0),this.u)K(this.f,
3,1);else if(this.m)0<=this.speed.y&&.1<Math.abs(this.target.x)?J(this.f,3,0,1,10,a.step):(b=0>this.speed.y?2:0,K(this.f,b,3));else if(this.i){if(3!=this.f.a||.1<Math.abs(this.target.y))J(this.f,3,3,4,10,a.step),(this.f.a!=d||this.f.c!=c&&3==this.f.c)&&H(a.audio,a.o.B.climb,.6)}else this.Ia?(J(this.f,6,0,3,3,a.step),(this.f.a!=d||this.f.c!=c&&0==this.f.c)&&H(a.audio,a.o.B.flap,.5)):this.M?.1>Math.abs(this.speed.x)&&.1>Math.abs(this.target.x)?K(this.f,0,0):(b=12-6*Math.abs(this.speed.x),J(this.f,0,
1,4,b,a.step)):this.za&&0>this.speed.y?J(this.f,2,0,4,4,a.step):(b=0,.5>Math.abs(this.speed.y)?b=1:0<this.speed.y&&(b=2),K(this.f,b,1))}this.R.Cb(a);this.R.update(a);this.zb=this.i;this.m=this.i=!1;this.S=this.fa&&-.01>this.speed.y}}kb(){this.va?this.va=!1:(this.Ga=this.u=this.M=!1,this.W=null,this.ra=this.Ja=!1)}pb(a){J(this.f,7,0,2,3,a.step);return 120<=(this.Ua+=a.step)}s(a){if(this.v){var b=this.R;if(b.i)for(var c of b.F)c.s(a);if(this.T){b=1*this.Ua;for(var d=0;8>d;++d){var e=2*Math.PI/8*d;c=
this.b.x+this.C.x+Math.cos(e)*b;e=this.b.y+this.C.y+Math.sin(e)*b;this.f.s(a,a.A.figure,c-8,e-8,0)}this.R.s(a)}else 0<this.O&&0!=Math.floor(this.O/2)%2||(d=this.f.c,this.D&&0==Math.floor(this.Ha/2)%2&&(d+=5),b=Math.round(this.b.x-8),c=Math.round(this.b.y-7),0<this.X&&this.wa&&this.Ba.s(a,a.A.figure,b+12-24*this.g,c+1,this.g),e=this.f,z(a,a.A[this.progress.J[15]?"figure":"figureNaked"],e.width*d,e.height*this.f.a,e.width,e.height,b,c,this.g),this.fa&&this.Ba.s(a,a.A.figure,b+3-6*this.g,c+7,this.g),
this.R.s(a),this.Ga&&(d=this.f,z(a,a.A.figure,d.width*(3+2*this.qb+Math.floor(this.la/.5)),7*d.height,d.width,d.height,b,c-16,0)),null!=this.W&&z(a,a.A.items,16*this.W.x,16*this.W.y,16,16,b,c-16,0),this.progress.J[3]&&!this.progress.J[4]&&this.m&&this.ra&&0<this.ha&&C(a,a.A.font,String(Math.round(this.ha/60)),b+8,c-10,-1,0,!0))}}ga(){this.M=!0;this.za=!1;this.I=12;.1<this.speed.y&&(this.L=this.i=!1);this.h=!0;this.fa&&0>=this.ca&&(this.ca=20);this.F=0;this.u=!1}ba(a,b){!this.i&&!this.fa&&0>=this.X&&
!this.m&&0<this.speed.y&&.1<b.input.N.x*a&&(this.progress.J[8]&&(this.u=!0,this.F=15),this.Eb=a,this.h=!0)}Sa(){this.ma=0}Xa(a,b,c,d,e,f){if(!P(this,a+4,b,c-8,d))return!1;this.Ga||this.zb?this.zb&&1==this.qb&&(this.Ga=!1):(this.Ga=!0,this.qb=1);return this.L?(this.h=!0,void 0==f&&(this.i=!0),!0):oa(e.input)||pa(e.input)?(this.L=this.i=this.h=!0,this.b.x=a+8,void 0!=f&&(this.b.y=b+f),Q(this),!0):!1}ob(a,b,c,d,e,f){return e||this.progress.J[3]?P(this,a,b,c,d)?(this.ra=this.ra||!e,0>=this.ha&&!this.m&&
(this.ha=300),this.m=!0,this.I=1,this.za=!1,this.j=0,this.h=!0):!1:Xa(this,a,b-4,c,f,!1)}ab(a,b){let c=a.b.x*a.width,d=a.b.y*a.height,e=a.target.x-a.b.x,f=a.target.y-a.b.y,g=(this.K.x+2)*a.ib,h=10*a.ib,l=0,m=0;if(a.ia)this.b.x+=e*g*b.step,this.b.y+=f*h*b.step;else if(0>=this.l&&!this.S){if(0<this.speed.x&&this.b.x+this.C.x+this.K.x/2>c+a.width?l=1:0>this.speed.x&&this.b.x+this.C.x-this.K.x/2<c?l=-1:0<this.speed.y&&this.b.y+this.C.y+4>d+a.height?m=1:0>this.speed.y&&this.b.y+this.C.y-4<d&&(m=-1),0!=
l||0!=m)0!=(b=a.move(l,m,.05))&&(this.b.x+=b*a.width*a.ta),this.vb()}else U(this,a.P.x*a.width,a.P.y*a.height,a.height,-1,b),U(this,(a.P.x+1)*a.width,a.P.y*a.height,a.height,1,b);null!=this.R&&this.R.v&&!Ta(a,this.R)&&(this.R.v=!1)}eb(a,b){this.g=0<this.dir?0:1;this.O=60;this.l=30;this.target.x=0;this.speed.x=2*-this.dir;this.i=!1;this.X=0;this.Ia=this.D=this.u=this.fa=!1;var c=this.progress;c.J[18]&&(a=Math.max(1,a-1));c.Y=Math.max(0,c.Y-a);H(b.audio,b.o.B.hurt,.5)}Oa(a,b,c,d,e,f){if(!(0<this.O))return P(this,
a,b,c,d)?(this.dir=this.b.x<a+c/2?1:-1,this.eb(e,f),!0):!1}Ab(a,b,c,d,e){return(Fb(this)||0<this.ca)&&ba(this.pa,null,this.Aa,a,b,c,d)?this.ua||this.fa?2:1:this.progress.J[14]&&Ya(this,a,b+16,c,e,!1)?2:0}moveTo(a,b){this.b=a.clone();Q(this);b.setPosition(this.b.x/160|0,this.b.y/144|0)}Ib(a,b,c,d){return(0<this.I||this.M)&&0<this.j&&P(this,a,b,c,d)?(this.j=5,this.Ja=!0):!1}};class qc extends V{constructor(a,b,c,d){super(a,b);this.f=new M(32,40);K(this.f,0,c);this.K=new t(12,40);this.id=c;this.j=!1;this.I=!0;this.Ka=d}update(a){this.m=!this.j;this.j?J(this.f,this.id,1,3,6,a.step):K(this.f,0,this.id)}s(a){this.G&&!this.a&&this.f.s(a,a.A.portal,this.b.x-16,this.b.y-20,0)}i(a){this.j=0==this.id&&a.progress.J[15]}g(a,b,c,d){d.U.H(!0,1,1/60,e=>{this.Ka(e)},null,new x(255,255,255));d.U.C=new t(this.b.x%160,this.b.y%144+8);b.b.x=this.b.x;Bb(b,!1);H(d.audio,d.o.B.teleport,.5)}Da(){}}
;function rc(a){let b={};var c=Object.assign(a.progress);b.progress={health:c.Y,maxHealth:c.na,gems:c.Gb,coins:c.Na,keys:c.keys,orbs:c.oa,openedChests:c.Pa,openedDoors:c.wb,boughtItems:c.Ca,obtainedItems:c.J,visitedRooms:c.Qa,nightOrbActivated:c.jb,isNight:c.Ea};b.savePoint={x:a.ya.x,y:a.ya.y};a=JSON.stringify(b);try{window.localStorage.setItem("agff_savedata",a)}catch(d){return console.log("Save error: "+d),!1}return!0}
function sc(a){var b=null;try{b=window.localStorage.getItem("agff_savedata")}catch(e){console.log("SAVE ERROR: "+e);return}if(null!=b){b=JSON.parse(b);if(void 0!=b.progress){var c=a.progress,d=b.progress;c.na=d.maxHealth;c.Y=d.health;c.jb=d.nightOrbActivated;c.Ea=d.isNight;c.Gb=d.gems;c.Na=d.coins;c.keys=d.keys;c.oa=d.orbs;if(void 0!=d.openedChests)for(let e=0;e<c.Pa.length;++e)c.Pa[e]=Array.from(d.openedChests[e]);void 0!=d.openedDoors&&(c.wb=Array.from(d.openedDoors));void 0!=d.boughtItems&&(c.Ca=
Array.from(d.boughtItems));void 0!=d.obtainedItems&&(c.J=Array.from(d.obtainedItems));void 0!=d.visitedRooms&&(c.Qa=Array.from(d.visitedRooms))}void 0!=b.savePoint&&(a.ya=(new t(b.savePoint.x,b.savePoint.y)).clone(),a.b=a.ya.clone())}};class tc extends V{constructor(a,b){super(a,b);this.active=!1;this.K=new t(10,16)}update(a){this.G&&(this.active?J(this.f,0,1,8,6,a.step):K(this.f,0,0))}s(a){this.G&&this.f.s(a,a.A.savepoint,this.b.x-8,this.b.y-8,0)}l(a,b){this.active||(this.active=!0,a.ya=this.b.clone(),a.Fb=this,null!=b&&H(b.audio,b.o.B.savepoint,.5))}g(a,b,c,d){let e=d.o.Z.en;Y(a,e.saveGame).H(()=>{let f=rc(b);Y(a,e[f?"goodResult":"badResult"]).H(()=>{},!1)},!0)}i(a){this.active=a.Fb==this}};class uc extends V{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new M(24,24);this.K=new t(12,16);this.f.c=4*Math.random()|0;K(this.f,0,d);this.id=d;this.a=c}update(a){this.G&&J(this.f,this.id,0,3,10,a.step)}s(a){this.G&&this.f.s(a,a.A.shopkeeper,this.b.x-12,this.b.y-12,this.c)}g(a,b,c,d){Y(a,d.o.Z.en.shopkeeper[this.id]).H(()=>{this.a.H(this.id)},!1)}i(a){this.c=a.b.x<this.b.x?0:1}};function vc(a){switch(a.id){case 0:return 30<=a.progress.Na;case 1:return a.progress.J[21];case 2:return a.progress.J[22];default:return!1}}function wc(a){switch(a.id){case 0:return yb(a.progress,-30),a=a.progress,a.oa+=1,[16,3];case 1:return a.progress.removeItem(21),qb(a.progress,23),a.m=!0,[23,1];case 2:return a.progress.removeItem(22),qb(a.progress,24),a.m=!0,[24,1];default:return[-1,-1]}}
class xc extends V{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new M(24,24);this.K=new t(12,16);this.f.c=4*Math.random()|0;K(this.f,0,d%2);this.id=d;this.progress=c;this.a=0}update(a){this.G&&J(this.f,this.id%2,0,3,10,a.step)}s(a){this.G&&this.f.s(a,a.A.specialNPC,this.b.x-12,this.b.y-12,this.c)}g(a,b,c,d){let e=d.o.Z.en;for(let f of e.specialNPC[this.id])Y(a,f);a.H(()=>{vc(this)&&Y(a,e.specialQuestion[this.id]).H(()=>{Y(a,e.specialReply[this.id]).H(f=>{let g=wc(this);H(f.audio,f.o.B.treasure,
.5);Ia(f.audio);wb(b,g[1],g[0]);this.a=60;vb(a,h=>0>=(this.a-=h.step));for(let h of e.specialResult[this.id])Y(a,h);a.H(h=>{0==this.id&&(this.id=2);pb(g[1],g[0],b);Ja(h.audio)},!1)},!1)},!0)},!1)}i(a){this.c=a.b.x<this.b.x?0:1}};function jb(a,b,c,d,e,f){var g=0;let h=0,l=0,m=null,r=a.progress.Ea;for(let n=0;n<d;++n)for(let u=0;u<c;++u)if(h=b[n*c+u]-512,!(0>=h)){--h;g=0;0<n&&(g=Math.max(0,b[(n-1)*c+u]-512-240-1));switch(h){case 42:a.c.push(new qc(16*u+8,16*n-4,1,e));case 0:a.a=new pc(16*u+8,16*n+8,a.progress,a.message);break;case 32:a.c.push(new tc(16*u+8,16*n+8));break;case 33:case 34:case 35:case 36:a.c.push(new tb(16*u+8,16*n+8,h-33,g));36==h&&++l;break;case 37:a.c.push(new ic(16*u+8,16*n+8,g,r));break;case 38:case 39:a.c.push(new Ab(16*
u+8,16*n,39==h,g));break;case 40:a.c.push(new uc(16*u+8,16*n+4,a.m,g));break;case 41:a.c.push(new qc(16*u+8,16*n-4,g,e));break;case 43:a.c.push(new xc(16*u,16*n+4,a.progress,g));break;case 44:a.c.push(m=new gc(16*u,16*n+4,a.progress,f))}if(1<=h&&31>=h){g=a.g.length;for(let I=0;I<a.g.length;++I)if(!a.g[I].v){g=I;break}a.g[g]=new (Gb(h-1).prototype.constructor)(16*u+8,16*n+8);a.g[g].V(16*u+8,16*n+8);Cb(a.g[g],(I,T,ka,v,A,F,W)=>{q(a.i,ob).ja(I,T,ka,v,A,F,W)})}}null!=m&&(m.h=l+1);yc(a)}
function fb(a,b,c,d){let e=(b-d.x)/16*.75;e=p(e,-.75,.75);d=Math.max(0,c-d.y)/16*2;d=p(d,-2,2);var f=a.a.progress;f=Math.random()<.25*(1-f.Y/f.na)?1:0;q(a.j,xb).ja(b,c,e,-1.5+d,f)}function yc(a){for(let b of a.c)if(void 0!=b.Kb)for(let c of a.c)void 0!=c.Kb&&c.id==b.id&&c.Jb!=b.Jb&&(c.yb=b,b.yb=c)}function zc(a,b){b.setPosition(a.a.b.x/160|0,a.a.b.y/144|0)}function Ac(a,b,c,d,e){let f=a.a.ya.clone();a.g=[];a.bb=[];a.j=[];a.i=[];a.c=[];ib(b,a,c,d);e||(a=a.a,a.ya=f.clone(),a.b=a.ya.clone())}
function Bc(a,b){b.C=new t((a.a.b.x|0)%160,(a.a.b.y|0)%144)}
class Cc{constructor(a,b,c){this.a=null;this.g=[];this.bb=[];this.j=[];this.i=[];this.c=[];this.progress=a;this.m=b;this.message=c}update(a,b,c,d){var e=this.a;0>=e.Wa?e=!1:(e.Wa-=d.step,e=!0);if(!e){for(let h of this.g)if(h.ab(a,d),a.ia||(h.update(d),h.Fa(this.a,this,d),db(b,h,this,d)),h.v&&!h.T&&h.G)for(let l of this.g)if(l!=h)a:{var f=void 0;e=h;var g=l;if(!g.v||g.T||!g.G||!e.v||e.T||!e.G||g.Bb||e.Bb)break a;f=Math.hypot(e.K.x/2,e.K.y/2);let m=Math.hypot(g.K.x/2,g.K.y/2),r=new t(e.b.x+e.C.x-g.b.x-
g.C.x,e.b.y+e.C.y-g.b.y-g.C.y),n=r.length();w(r);n<f+m&&(f=f+m-n,e.hb||(e.b.x+=r.x*f/2,e.b.y+=r.y*f/2),e.sa(g),g.hb||(g.b.x-=r.x*f/2,g.b.y-=r.y*f/2),g.sa(e))}a.ia||(this.a.update(d),db(b,this.a,this,d),this.a.R.v&&db(b,this.a.R,this,d));this.a.ab(a,d)}for(let h of this.bb)h.update(d);for(let h of this.c)h.Ma(a),h.update(d),h.Fa(c,this.a,a,d);for(let h of this.i)h.Ma(a),h.update(d),db(b,h,this,d),h.Fa(this.a,d);for(let h of this.j)h.ab(a,d),h.update(d),h.Fa(this.a,this,d),db(b,h,this,d);return this.a.v}s(a,
b){for(let c of this.c)c.s(a);for(let c of this.g)c.s(a,b);for(let c of this.j)c.s(a);this.a.s(a);for(let c of this.i)c.s(a);for(let c of this.bb)c.s(a)}Da(a){for(let b of this.g)b.Ma(a);for(let b of this.c)b.Ma(a),b.Fa(null,this.a,null),void 0!=b.Da&&b.Da(this.a.progress)}};function Dc(a,b,c,d,e){const f=[[0,0,0],[255,255,255][0,0,0],[0,85,170]];let g=f.length-1;for(let h=0;h<f.length;++h,--g)y(a,f[h][0],f[h][1],f[h][2],1),a.fillRect(b-g,c-g,d+2*g,e+2*g)};function Y(a,b){b=10==b.charCodeAt(b.length-1)?b.substr(0,b.length-1):b;a.a.push(b);a.j.push(Ec(b));return a}function vb(a,b){a.S=b;return a}function Ec(a){let b=new t(0,0);a=a.split("\n").map(c=>c.length);b.x=8*Math.max(...a);b.y=10*a.length;return b}
class Fc{constructor(a){a=a.o.Z.en;this.a=[];this.j=[];this.c=this.g=this.char=0;this.active=!1;this.h=0;this.m=()=>{};this.i=!1;this.S=()=>!0;this.I=new Qa(12,!0,[new N(a.yes,b=>{this.aa();this.m(b)},!1),new N(a.no,()=>{this.aa()},!0)]);this.F=this.u=!1}H(a,b){this.active=!0;this.c=this.g=0;this.m=a;this.i=!1;this.u=b;this.F=!1;this.I.H(1)}update(a){if(this.active){var b=a.input.$a();if(!this.i&&(this.i=this.S(a),!this.i))return;this.F=this.c==this.a[0].length&&1==this.a.length;this.c<this.a[0].length?
b?this.c=this.a[0].length:2<=(this.g+=1*a.step)&&(this.g-=2,++this.c,a=this.a[0].charCodeAt(this.c),this.c<this.a[0].length&&"\n"==a&&++this.c):1==this.a.length&&this.u?this.I.update(a):(b&&(this.a.shift(),this.j.shift(),this.g=this.c=0,H(a.audio,a.o.B.next,.6),0==this.a.length&&(this.aa(),null!=this.m&&this.m(a))),this.h=(this.h+.1*a.step)%(2*Math.PI))}}s(a,b){if(this.active&&this.i){var c=this.j[0].x+4,d=this.j[0].y+4,e=a.width/2-c/2,f=a.height/2-d/2;b&&Dc(a,e,f,c,d);C(a,a.A.font,this.a[0].substr(0,
this.c),e+2,f+2,0,2,!1);this.F&&this.u?(c=e+c-20,b=f+d+14,Dc(a,c-18,b-12-2,36,24),this.I.s(a,c,b)):this.c==this.a[0].length&&(b=Math.round(Math.sin(this.h))|0,z(a,a.A.font,24,0,8,8,e+c-8,f+d-4+b,!1))}}aa(){this.active=!1;this.S=()=>!0;this.a.length=0;this.j.length=0}};function Gc(a,b){Y(a.message,b.o.Z.en.respawnText).H(c=>{a.g(c);a.a.aa();a.active=!1},!0)}function Hc(a,b){Y(a.message,b.o.Z.en.quitText).H(c=>{a.c(c);a.a.aa();a.active=!1},!0)}
class Ic{constructor(a,b,c,d){let e=d.o.Z.en;this.message=new Fc(d);this.a=new Qa(12,!0,[new N(e.resume,f=>{this.aa(f)},!1),new N(e.respawn,f=>{Gc(this,f)},!1),new N(e.map,f=>{c(f)},!1),new N(e.quit,f=>{Hc(this,f)},!1)]);this.g=a;this.c=b;this.active=!1}H(a){this.active=!0;this.a.H(0);this.a.buttons[2].disabled=!a.J[16]}aa(a){this.a.aa();this.active=!1;Ja(a.audio)}update(a){this.active&&(this.message.active?this.message.update(a):a.input.actions.back.state==G?(H(a.audio,a.o.B.deny,.6),this.aa(a)):
this.a.update(a))}s(a,b){this.active&&!b&&(y(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.active?this.message.s(a,!0):(Dc(a,a.width/2-38,a.height/2-24,76,48),this.a.s(a,a.width/2,a.height/2+1)))}};const Jc=[4,0,2,1,1,1,1,1,1,1],Kc=[0,16,16,16,17,18,19,20,21,22],Lc=[10,15,10,15,10,30,20,30,50,20];
function Mc(a,b,c){let d=c.o.Z.en;c=d.shopItemNames;let e=[];for(let f=0;f<c.length;++f){e.push([]);for(let g=0;g<c[f].length;++g)e[f].push(new N(" "+c[f][g],()=>{let h=5*f+g;a.progress.Ca[h]||(a.progress.Na<Lc[h]?Y(a.message,d.cannotAfford).H(()=>{},!1):Y(a.message,d.confirmTransaction).H(l=>{4!=Jc[h]&&(a.progress.Ca[h]=!0,a.a[a.id].buttons[g].disabled=!0);yb(a.progress,-Lc[h]);sb(a.g,a.i,Jc[h],Kc[h]);H(l.audio,l.o.B.treasure,.5);a.c=60;a.aa();wb(b,Jc[h],1==Jc[h]?Kc[h]:0);Ia(l.audio);vb(a.i,m=>0>=
(a.c-=m.step)).H(m=>{pb(Jc[h],Kc[h],b);Ja(m.audio)},!1)},!0))},!1));e[f].push(new N(d.back,()=>{a.aa()},!0))}return e}function Nc(a,b,c){b=Mc(a,b,c);a.a=[];for(c=0;c<b.length;++c)a.a[c]=new Qa(12,!0,b[c])}function Oc(a){for(let b=0;b<a.a.length;++b)for(let c=0;c<a.a[b].buttons.length-1;++c)a.progress.Ca[5*b+c]&&(a.a[b].buttons[c].disabled=!0)}
class Pc{constructor(a,b,c){this.progress=a;this.a=[];this.active=!1;this.g=c.o.Z.en;this.message=new Fc(c);this.i=b;this.id=this.c=0}update(a){this.active&&(this.message.active?this.message.update(a):a.input.actions.back.state==G?(H(a.audio,a.o.B.deny,.6),this.aa()):this.a[this.id].update(a))}s(a){if(this.active){y(a,0,0,0,.67);a.fillRect(0,0,a.width,a.height);var b=a.height/2-this.a[this.id].height/2+-12;Dc(a,a.width/2-24,4,48,12);C(a,a.A.font,"SHOP",a.width/2,6,0,0,!0);Dc(a,a.width/2-74,b-2,148,
this.a[this.id].height);this.a[this.id].s(a,64,a.height/2+-12);for(var c=0;5>c;++c)z(a,a.A.shopicons,8*(5*this.id+c),this.progress.Ca[5*this.id+c]?8:0,8,8,60-(this.a[this.id].width-8)/2+7,b+c*this.a[this.id].offset,0);for(let f=0;5>f;++f){if(this.progress.Ca[5*this.id+f]){c=this.g.sold;var d="fontGray"}else d=this.a[this.id].ka==f?"fontYellow":"font",c=String(Lc[5*this.id+f])+String.fromCharCode(6);var e=152-8*c.length;C(a,a.A[d],c,e,b+f*this.a[this.id].offset,0,0,!1)}b=b+this.a[this.id].height+-4+
12;Dc(a,a.width/2-74,b-4,148,40);this.a[this.id].ka<this.a[this.id].buttons.length-1&&(c=this.g.shopItemDesc[this.id][this.a[this.id].ka],C(a,a.A.font,c,8,b-2,0,1,!1));this.message.active&&(y(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.s(a,!0))}}H(a){this.id=a;this.active=!0;this.a[this.id].H(this.a[this.id].buttons.length-1);this.c=0;this.progress.J[22]||1!=a||(this.a[this.id].buttons[4].disabled=!1,this.progress.Ca[9]=!1)}aa(){this.a[this.id].aa();this.active=!1}};class Qc{constructor(a,b,c){this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=b;this.width=a;this.height=b;this.active=!1;this.m=new t(0,0);this.c=new t(0,0);this.i=0;this.Qa=[];this.u=a/10|0;this.I=b/9|0;this.a=this.g=0;this.F=c.o.Z.en;this.j=[]}update(a){this.active&&(1!=this.a?0>=(this.g-=a.step)&&(0==this.a?++this.a:this.active=!1,this.g=0):a.input.actions.start.state==G||a.input.actions.select.state==G||a.input.actions.fire1.state==G||a.input.actions.back.state==
G?(this.a=2,this.g=30,H(a.audio,a.o.B.accept,.6)):this.i=(this.i+a.step)%60)}H(a,b,c,d,e){this.active=!0;{const f=["rgb(0,85,170)","rgb(0,0,0)","rgb(85,85,85)","rgb(85,170,0)"];let g=this.canvas.getContext("2d");g.clearRect(0,0,this.width,this.height);let h;for(let l=0;l<a.height;++l)for(let m=0;m<a.width;++m)h=a.data[l*a.width+m],0!=h&&(g.fillStyle=f[h-1],g.fillRect(m|0,l|0,1,1));this.Qa=Array.from(d.Qa)}this.m.x=Math.round(b.x/16);this.m.y=Math.round(b.y/16);this.c.x=Math.floor(c.b.x);this.c.y=
Math.floor(c.b.y);this.i=0;this.g=30;this.a=0;this.j=[];if(d.J[20])for(let f of e)void 0==f.Lb||f.Lb()||this.j.push(new t(f.b.x/16|0,f.b.y/16|0))}s(a){if(this.active){var b=a.width/2-this.width/2|0,c=a.height/2-this.height/2|0;y(a,0,0,0,.67);a.fillRect(0,0,a.width,a.height);var d=this.g/30;2>this.a&&(d=1-d);d=10+10*Math.round((this.width-10)*d/10-1);{var e=a.width/2-d/2,f=c-4,g=this.height;let m=a.A.map;z(a,m,0,0,10,9,e-10,f-9,0);z(a,m,20,0,10,9,e+d,f-9,0);z(a,m,0,27,10,9,e-10,f+g+9,0);z(a,m,20,27,
10,9,e+d,f+g+9,0);var h=(g/9|0)+1;for(let r=0;r<h;++r){var l=r==h-1?18:9;z(a,m,0,l,10,9,e-10,f+9*r,0);z(a,m,20,l,10,9,e+d,f+9*r,0)}l=d/10|0;for(h=0;h<l;++h)z(a,m,10,0,10,9,e+10*h,f-9,0),z(a,m,10,18,10,9,e+10*h,f+g,0)}if(1!=this.a)y(a,170,85,0),a.fillRect(a.width/2-d/2,c-4,d,this.height);else{y(a,255,170,85);a.fillRect(b,c-4,this.width,this.height);y(a,170,85,0);a.fillRect(b,c-4,this.width,4);y(a,255,255,85);a.fillRect(b+10*this.c.x,c+9*this.c.y,10,9);B(a,this.canvas,b,c);30>this.i&&(y(a,255,0,0),
a.fillRect(b+this.m.x-1,c+this.m.y-2,3,3));y(a,170,85,0);for(d=0;d<this.I;++d)for(e=0;e<this.u;++e)e==this.c.x&&d==this.c.y||this.Qa[d*this.u+e]||a.fillRect(b+10*e,c+9*d,10,9);if(0<this.j.length&&30>this.i){a.move(b,c);y(a,85,255,255);for(let m of this.j)a.fillRect(m.x-1,m.y-1,3,3);a.move(-b,-c)}C(a,a.A.font,this.F.mapHeader,a.width/2,c-9,0,0,!0)}}}};function Rc(a,b){a.j&&(Ka(b.audio),a.j=!1,a.g=new mb(b.o,!1),a.a=new Ua(0,0,160,144,a.g.width/10|0,a.g.height/9|0,!0),Sc(a,b,!0),a.progress.a=!1)}function Tc(a){a.U.H(!0,2,1/30,b=>{b.La(Uc);b.U.aa()},new x(0,0,0))}function Vc(a,b,c,d){let e=d.o.Z.en;if(a.progress.J[16])a.m.H(lb(a.g),a.c.a.b,a.a,a.progress,a.c.c),c&&H(d.audio,d.o.B.pause,.6);else{for(let f of e.noMap)Y(b,f);b.H(()=>{},!1);c&&H(d.audio,d.o.B.deny,.6)}}
function Wc(a,b){var c=b.audio;a=b.o.B[a.j?"intro":a.progress.Ea?"theme1":"theme2"];c.c&&(null!=c.a&&(c.a.stop(),c.a=null),a.play(c.da,.4,!0,0),c.a=a)}function Sc(a,b,c){cb(a.g);Ac(a.c,a.g,d=>Rc(a,d),d=>{Sc(a,d,!1)},c);Ra(a.a);zc(a.c,a.a);Bc(a.c,b.U);a.c.Da(a.a);lc(a.progress);Nc(a.i,a.c.a,b);Oc(a.i);Wc(a,b)}function Xc(a,b){b.U.H(!0,1,1/30,c=>Sc(a,c,!1),new x(0,0,0));Bc(a.c,b.U)}
function Yc(a,b,c){let d=b.A.font;y(b,0,0,0,.33);b.fillRect(0,0,b.width,10);var e=String.fromCharCode(6)+String.fromCharCode(2)+String(a.progress.Na);C(b,d,e,b.width-8*e.length-1,1,0,0,!1);if(!c){for(e=0;e<a.progress.na;++e)c=9*(e/2|0),0==e%2&&z(b,d,40,0,8,8,c+2,1),a.progress.Y>e&&z(b,d,32+e%2*4,0,4,8,c+2+e%2*4,1);(0<a.progress.keys||0<a.progress.oa)&&b.fillRect(0,b.height-10,b.width,10);0<a.progress.keys&&C(b,d,String.fromCharCode(7)+String.fromCharCode(2)+String(a.progress.keys),2,b.height-9,1,
0,!1);0<a.progress.oa&&(e=String.fromCharCode(8)+String.fromCharCode(2)+String(a.progress.oa),C(b,d,e,b.width-8*e.length-2-1,b.height-9,1,0,!1))}}
class Zc extends ra{constructor(a,b){super(a,b);this.j=!0!==b;this.g=new mb(a.o,this.j);this.a=new Ua(0,0,160,144,this.g.width/10|0,this.g.height/9|0,!0);this.progress=new mc(this.a.ta,this.a.i);this.progress.a=this.j;this.message=new Fc(a);this.i=new Pc(this.progress,this.message,a);this.c=new Cc(this.progress,this.i,this.message);ib(this.g,this.c,c=>Rc(this,c),c=>{Sc(this,c,!1)});zc(this.c,this.a);Nc(this.i,this.c.a,a);this.u=new Ic(c=>{var d=this.c;!d.a.T&&d.a.v&&oc(d.a,c,!0)},c=>{Tc(c)},c=>{Vc(this,
this.u.message,!1,c)},a);Wc(this,a);a.U.H(!1,1,this.j?1/60:1/30,null,new x(0,0,0));Bc(this.c,a.U);this.c.Da(this.a);!0===b&&(sc(this.c.a),zc(this.c,this.a));Oc(this.i);this.m=new Qc(this.g.width,this.g.height,a)}refresh(a){this.a.c&&(this.c.Da(this.a),this.a.c=!1);a.U.active||(this.m.active?this.m.update(a):this.message.active?this.message.update(a):this.i.active?this.i.update(a):this.u.active?this.u.update(a):this.a.ia||a.input.actions.select.state!=G?a.input.actions.start.state==G?(this.u.H(this.progress),
Ia(a.audio),H(a.audio,a.o.B.pause,.6)):(this.g.update(this.a,a),this.c.update(this.a,this.g,this.message,a)?this.a.update(a):Xc(this,a)):Vc(this,this.message,!0,a))}tb(){}lb(a){a.moveTo(0,0);var b=this.g,c=this.a,d=this.progress.Ea;if(b.u)for(a.clear(255,255,255),B(a,a.A.introBackground,0,0),d=0;3>d;++d)for(var e=0;2>e;++e)z(a,a.A.clouds,0,72*d,160,72,-Math.floor(b.j[d])+160*e,56+12*d,0);else{e=d?80:0;d?(a.clear(0,0,0),B(a,a.A.nightBg,0,0)):a.clear(85,170,255);b=k(b.F,96);z(a,a.A.background,16,e+
32,64,48,96,16,0);c=16*c.P.y|0;a.move(0,-c);for(var f=0;3>f;++f)z(a,a.A.background,0,e,96,32,Math.round(-b+96*f),96,0);d?y(a,255,170,255):y(a,255,255,255);a.fillRect(0,128,a.width,16);for(b=0;b<a.width/16|0;++b)z(a,a.A.background,0,e+32,16,32,16*b,144,0);d?y(a,85,0,170):y(a,0,85,170);a.fillRect(0,176,a.width,Math.max(0,a.height+c-176));a.move(0,c)}Sa(this.a,a);this.paused||0>=a.nb||a.move(Math.round(Math.random()*a.mb.x*2)-(a.mb.x|0),Math.round(Math.random()*a.mb.y*2)-(a.mb.y|0));this.g.s(a,this.a,
this.progress.Ea);this.c.s(a,this.a);Sa(this.a,a);e=this.g;d=this.a;a.moveTo(0,-Math.round(d.P.y*d.height));if(e.u){{b=[16,24];c=a.width/64|0;f=a.height/64|0;let g,h,l;for(let m=0;2>m;++m){l=Math.sin(e.a[m])*b[m];g=k(e.c[m]*m+d.P.x*a.width,64);h=e.c[m];for(let r=-1;r<c+1;++r)for(let n=-1;n<f+1;++n)z(a,a.A.ash,0,64*m,64,64,64*r-g+l,64*n+h,0)}}}else if(e=k(e.h+10*d.P.x,128),b=a.A.darkClouds,!(9*d.P.y>b.height+-8))for(d=0;3>d;++d)B(a,b,-e+d*b.width,-8);a.moveTo(0,0);Yc(this,a,!1);this.message.active&&
this.message.s(a,!0);this.u.s(a,this.m.active);this.i.s(a);this.i.active&&Yc(this,a,!0);this.m.s(a)}};class $c extends ra{constructor(a,b){super(a,b);b=a.o.Z.en;this.message=new Fc(a);for(let c of b.storyIntro)Y(this.message,c);this.a=new M(64,32);K(this.a,0,1);this.c=0}refresh(a){0==this.c?1==this.a.a?(J(this.a,1,0,3,10,a.step),3==this.a.c&&K(this.a,0,0)):(J(this.a,0,0,3,8,a.step),3==this.a.c&&(this.c=1,this.message.H(()=>{this.c=2;this.message.aa()},!1))):1==this.c?this.message.update(a):0==this.a.a?(J(this.a,0,3,0,8,a.step),0==this.a.c&&K(this.a,3,1)):(J(this.a,1,3,-1,10,a.step),-1==this.a.c&&
a.La(Zc))}tb(){return null}lb(a){a.clear(0,0,0);a.moveTo(0,0);this.a.s(a,a.A.eye,a.width/2-32,20,0);a.moveTo(0,24);this.message.s(a,!1)}};function ad(a,b){b.U.H(!0,1,1/30,c=>{c.La(a.load?Zc:$c);a.load||c.U.aa()},new x(0,0,0));b.U.C=new t(78,24)}
class Uc extends ra{constructor(a,b){super(a,b);this.g=a.o.Z.en;this.i=new Qa(12,!0,[new N(this.g.newgame,c=>{this.load=!1;ad(this,c)},!1),new N(this.g["continue"],c=>{let d=!1;try{d=window.localStorage.getItem("agff_savedata")}catch(e){d=!1}d?(this.load=!0,ad(this,c)):(H(c.audio,c.o.B.deny,.6),Y(this.message,this.g.noSaveData).H(()=>{},!1))},!0)]);this.a=0;this.c=60;this.load=!1;this.message=new Fc(a)}refresh(a){if(!a.U.active)if(this.message.active)this.message.update(a);else if(0==this.a)0>=(this.c-=
a.step)&&(++this.a,this.c=29);else if(1==this.a){if(a.input.actions.start.state==G||a.input.actions.fire1.state==G)++this.a,H(a.audio,a.o.B.pause,.6);this.c=(this.c+a.step)%60}else 2==this.a&&this.i.update(a)}lb(a){a.clear(0,0,0);let b=0;0==this.a&&(b=this.c/60);let c=a.A.titlebg;B(a,c,0,c.height*b);c=a.A.logo;B(a,a.A.logo,0,-c.height*b+8);C(a,a.A.font,this.g.copyright,a.width/2+a.width*b,a.height-9,0,0,!0);2==this.a?this.i.s(a,a.width/2,a.height-32):1==this.a&&30<=this.c&&C(a,a.A.font,"Press Enter or (Start)",
a.width/2,a.height/2+32,-1,0,!0);this.message.s(a,!0)}tb(){return this.load}};class bd extends ra{constructor(a,b){super(a,b);a=a.o.Z.en;this.a=new Qa(12,!0,[new N(a.yes,c=>{c.audio.toggle(!0);c.audio.Hb=p(.6,0,1);c.La(Uc)},!1),new N(a.no,c=>{c.audio.toggle(!1);c.La(Uc)},!0)]);this.c=a.audiointro}refresh(a){this.a.update(a)}lb(a){a.clear(0,85,170);C(a,a.A.font,this.c,32,a.height/2-32,0,2,!1);this.a.s(a,a.width/2,a.height/2+16)}};window.onload=()=>{var a=new Pa(160,144,0);a.o.load("assets/assets.json");var b=[{name:"fire1",key:"KeyZ",xa:0},{name:"fire2",key:"KeyX",xa:2},{name:"fire3",key:"KeyC",xa:1},{name:"start",key:"Enter",xa:9,Va:7},{name:"back",key:"Escape",xa:8,Va:6},{name:"select",key:"ShiftLeft",xa:4,Va:5}];for(let c of b)na(a.a.input,c.name,c.key,c.xa,c.Va);a.i=bd;a.j=!1;a.loop(0)};
</script>
</body>
</html>
