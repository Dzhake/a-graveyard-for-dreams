<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="overflow: hidden; cursor: none; background-color: black;">
<script>
'use strict';class k{constructor(a,b){this.x=void 0==a?0:a;this.y=void 0==b?0:b}length(){return Math.hypot(this.x,this.y)}clone(){return new k(this.x,this.y)}};function t(a,b){b|=0;return((a|0)%b+b)%b}function aa(a,b){for(let c of a)if(!c.i)return c;a.push(new b.prototype.constructor);return a[a.length-1]}function ba(a,b,c){return a<b?Math.min(b,a+c):Math.max(b,a-c)}function v(a,b,c,d,e,f,g){null==b&&(b=new k(0,0));let h=a.x+b.x-c.x/2;a=a.y+b.y-c.y/2;return h+c.x>=d&&h<d+f&&a+c.y>=e&&a<e+g};function ca(a,b,c){let d=document.createElement("div");d.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;");a.c=document.createElement("canvas");a.c.width=b;a.c.height=c;a.c.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");d.appendChild(a.c);document.body.appendChild(d);a.J=a.c.getContext("2d");a.J.imageSmoothingEnabled=!1;da(a)}
function da(a){var b=window.innerWidth,c=window.innerHeight;a=a.c;var d=Math.min(b/a.width|0,c/a.height|0);let e=a.width*d;d*=a.height;c=String(c/2-d/2|0)+"px";b=String(b/2-e/2|0)+"px";a.style.width=String(e|0)+"px";a.style.height=String(d|0)+"px";a.style.top=c;a.style.left=b}function x(a,b,c,d,e){b=void 0==b?255:b;c=void 0==c?b:c;b="rgba("+String(b|0)+","+String(c|0)+","+String((void 0==d?c:d)|0)+","+String(void 0!=e?e:1);a.J.fillStyle=b;a.J.strokeStyle=b}
function y(a,b,c,d,e,f,g,h,l,n,m){if(!(null==b||0>=e||0>=f)){var p=a.J;g+=a.a.x;h+=a.a.y;c|=0;d|=0;e|=0;f|=0;g|=0;h|=0;l|=0;n|=0;m|=0;0!=m&&p.save();0!=(m&1)&&(p.translate(l,0),p.scale(-1,1),g*=-1);0!=(m&2)&&(p.translate(0,n),p.scale(1,-1),h*=-1);p.drawImage(b,c,d,e,f,g,h,l,n);0!=m&&p.restore()}}function z(a,b,c,d,e,f,g){let h=b.width/16|0,l=d;g&&(l=d-=c.length*(h+0)/2);for(let n=0;n<c.length;++n)g=c.charCodeAt(n),10==g?(l=d,e+=h+f):(y(a,b,g%16*h,(g/16|0)*h,h,h,l,e,h,h,!1),l+=h+0)}
class ea{constructor(a,b,c){this.J=this.c=null;ca(this,a,b);this.width=a;this.height=b;window.addEventListener("resize",()=>da(this));this.a=new k(0,0);this.A=null==c?{}:c}clear(a,b,c){this.J.fillStyle="rgba("+String(a|0)+","+String(b|0)+","+String(c|0)+",1";this.J.fillRect(0,0,this.width,this.height)}fillRect(a,b,c,d){a+=this.a.x;b+=this.a.y;this.J.fillRect(a|0,b|0,c|0,d|0)}moveTo(a,b){this.a=new k(a,b)}move(a,b){this.a.x+=a;this.a.y+=b}};function fa(a,b){if(null==b)for(b=0;b<a.buttons.length;++b)a.buttons[b]=D;else for(let c=0;c<b.buttons.length;++c){if(c>=a.buttons.length)for(let d=0;d<c-a.buttons.length;++d)a.buttons.push(D);a.buttons[c]=b.buttons[c].pressed?a.buttons[c]==D||a.buttons[c]==G?H:I:a.buttons[c]==I||a.buttons[c]==H?G:D}}
function ha(a,b){null!=b&&(a.j.x=0,a.j.y=0,.05<Math.hypot(b.axes[0],b.axes[1])&&(a.j.x=b.axes[0],a.j.y=b.axes[1]),8<=b.axes.length&&.1>Math.hypot(a.j.x,a.j.y)&&.05<Math.hypot(b.axes[6],b.axes[7])&&(a.j.x=b.axes[6],a.j.y=b.axes[7]))}function ia(a,b){return null==b||0>b||b>=a.buttons.length?D:a.buttons[b]}
class ja{constructor(){this.j=new k(0,0);this.buttons=[];this.a=null;this.index=0;window.addEventListener("gamepadconnected",a=>{console.log("Gamepad with index "+String(a.gamepad.index)+" connected.");let b=navigator.getGamepads()[a.gamepad.index];this.index=a.gamepad.index;a=this.a=b;ha(this,a);fa(this,a)})}update(){this.j.x=0;this.j.y=0;if(null!=this.a){var a=navigator;a=null==a?null:a.getGamepads?a.getGamepads():a.webkitGetGamepads?a.webkitGetGamepads:null;null!=a&&(this.a=a[this.index])}a=this.a;
ha(this,a);fa(this,a)}};var D=0,G=2,I=1,H=3;function J(a,b,c,d,e){a.actions[b]={state:D,key:c,ca:d,sa:e};a.h[c]=!0;return a}
function ka(a){a.c.update();for(var b in a.actions)a.actions[b].state=a.a[a.actions[b].key]|D,a.actions[b].state==D&&(null!=a.actions[b].ca&&(a.actions[b].state=ia(a.c,a.actions[b].ca)),a.actions[b].state==D&&null!=a.actions[b].sa&&(a.actions[b].state=ia(a.c,a.actions[b].sa)));a.f=a.j.clone();b=a.j;b.x=0;b.y=0;.1<a.c.j.length()&&(a.j=a.c.j.clone());a.actions.right.state&1?a.j.x=1:a.actions.left.state&1&&(a.j.x=-1);a.actions.down.state&1?a.j.y=1:a.actions.up.state&1&&(a.j.y=-1);a.l=new k(a.j.x-a.f.x,
a.j.y-a.f.y)}function la(a){return 0>a.j.y&&-.25<=a.f.y&&-.25>a.l.y}function ma(a){return 0<a.j.y&&.25>=a.f.y&&.25<a.l.y}
class na{constructor(){this.a={};this.h={};this.actions={};this.c=new ja;this.j=new k(0,0);this.f=new k(0,0);this.l=new k(0,0);window.addEventListener("keydown",a=>{var b=a.code;this.a[b]!=I&&(this.a[b]=H);this.h[b]&&a.preventDefault()});window.addEventListener("keyup",a=>{var b=a.code;this.a[b]!=D&&(this.a[b]=G);this.h[b]&&a.preventDefault()});window.addEventListener("contextmenu",a=>{a.preventDefault()});window.addEventListener("mousemove",()=>{window.focus()});window.addEventListener("mousedown",
()=>{window.focus()})}ka(){var a=this.a;for(let b in a)a[b]==H?a[b]=I:a[b]==G&&(a[b]=D)}};class M{constructor(){}refresh(){}Ca(){}Ka(){}};function N(a,b,c,d){return a.Z[b][t(d,a.height)*a.width+t(c,a.width)]}function O(a,b,c,d,e){c=t(c,a.width);d=t(d,a.height);a.Z[b][d*a.width+c]=e}
class oa{constructor(a){a=(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("map")[0];this.width=String(a.getAttribute("width"));this.height=String(a.getAttribute("height"));let b=a.getElementsByTagName("layer");this.Z=[];let c=9999;for(var d of b)d.id<c&&(c=d.id);for(let f=0;f<b.length;++f){d=b[f].id-c;var e=b[f].getElementsByTagName("data")[0].childNodes[0].nodeValue.replace(/(\r\n|\n|\r)/gm,"");e=e.split(",");this.Z[d]=[];for(let g=0;g<e.length;++g)this.Z[d][g]=parseInt(e[g])}this.a=
{};a=a.getElementsByTagName("properties")[0];if(void 0!=a)for(let f of a.getElementsByTagName("property"))void 0!=f.getAttribute("name")&&(this.a[f.getAttribute("name")]=f.getAttribute("value"))}};class pa{constructor(a,b){this.data=b;this.a=null;this.gain=a.createGain();this.h=this.c=this.f=0;this.loop=!1}play(a,b,c,d){null!=this.a&&(this.a.disconnect(),this.a=null);let e=a.createBufferSource();e.buffer=this.data;e.loop=!!c;b=Math.max(0,Math.min(b,1));this.gain.gain.value=b;this.f=a.currentTime-d;this.c=0;this.h=b;this.loop=c;e.connect(this.gain).connect(a.destination);e.start(0,d);this.a=e}stop(){this.a.disconnect();this.a.stop(0);this.a=null}pause(a){null!=this.a&&(this.c=a.currentTime-
this.f,this.stop())}resume(a){this.play(a,this.h,this.loop,this.c)}};function qa(a,b){ra(a,b,"json",c=>{c=JSON.parse(c);for(let d in c.bitmaps)sa(a,c.bitmaps[d].name,c.bitmapPath+c.bitmaps[d].path);for(let d in c.tilemaps)ta(a,c.tilemaps[d].name,c.tilemapPath+c.tilemaps[d].path);for(let d in c.samples)ua(a,c.samples[d].name,c.samplePath+c.samples[d].path)})}
function ra(a,b,c,d){let e=new XMLHttpRequest;e.overrideMimeType("text/"+c);e.open("GET",b,!0);++a.total;e.onreadystatechange=()=>{4==e.readyState&&("200"==String(e.status)&&void 0!=d&&d(e.responseText),++a.loaded)};e.send(null)}function sa(a,b,c){++a.total;let d=new Image;d.onload=()=>{++a.loaded;a.A[b]=d};d.src=c}function ta(a,b,c){++a.total;ra(a,c,"xml",d=>{a.Da[b]=new oa(d);++a.loaded})}
function ua(a,b,c){++a.total;let d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=()=>{a.a.J.decodeAudioData(d.response,e=>{++a.loaded;a.G[b]=new pa(a.a.J,e)})};d.send(null)}function va(a){return 0==a.total||a.loaded>=a.total}class wa{constructor(a){this.A={};this.Da={};this.G={};this.loaded=this.total=0;this.a=a}load(a){qa(this,a)}};function Q(a,b,c){a.c&&b.play(a.J,a.La*c,!1,0)}class xa{constructor(){this.J=new AudioContext;this.a=null;this.La=1;this.c=!1}toggle(a){this.c=a}};function ya(a,b){var c=b.width/4;let d=c/8;b.clear(0,0,0);a=a.m;var e=0==a.total?0:a.loaded/a.total;a=b.width/2-c/2;let f=b.height/2-d/2;a|=0;f|=0;x(b,255,255,255);b.fillRect(a-2,f-2,c+4,d+4);x(b,0);b.fillRect(a-1,f-1,c+2,d+2);c=c*e|0;x(b,255);b.fillRect(a,f,c,d)}
class za{constructor(a,b,c){this.c=this.D=0;this.audio=new xa;this.m=new wa(this.audio);this.s=new ea(a,b,this.m.A);this.a={step:c+1,m:this.m,audio:this.audio,input:J(J(J(J(new na,"left","ArrowLeft",14,null),"up","ArrowUp",12,null),"right","ArrowRight",15,null),"down","ArrowDown",13,null),ta:d=>this.ta(d)};this.f=new M(this.a,null);this.l=!1;this.h=this.f}loop(a){const b=16.66667*this.a.step;this.c+=a-this.D;this.c=Math.min(5*b,this.c);this.D=a;a=this.c/b|0;let c=!0,d=va(this.m);d&&!this.l&&(this.f=
new this.h.prototype.constructor(this.a,null),this.h=null,this.l=!0);for(;0<a--;)c&&ka(this.a.input),d&&this.f.refresh(this.a),c&&(this.a.input.ka(),c=!1),this.c-=b;va(this.m)?this.f.Ca(this.s):ya(this,this.s);window.requestAnimationFrame(e=>this.loop(e))}ta(a){this.f=new a.prototype.constructor(this.a,this.f.Ka())}};function R(a,b,c,d,e,f){b|=0;c|=0;d|=0;e|=0;if(c==d)a.f=0,a.a=c,a.c=b;else{a.c!=b&&(a.f=0,a.a=d>c?c:d,a.c=b);if(c<d&&a.a<c||c>d&&a.a>c)a.a=c;a.f+=f;a.f>e&&(c<d?++a.a>d&&(a.a=c):--a.a<d&&(a.a=c),a.f-=e)}}function S(a,b,c){a.a=b;a.c=c;a.f=0}class T{constructor(a,b){this.width=a;this.height=b;this.f=this.c=this.a=0}o(a,b,c,d,e){var f=this.width,g=this.height;y(a,b,this.width*this.a,this.height*this.c,f,g,c,d,f,g,e)}};class Aa{constructor(a,b){this.text=a;this.Ia=b}}
class Ba{constructor(a,b,c){this.buttons=[];for(let d of c)this.buttons.push(d);this.width=8*(Math.max(...this.buttons.map(d=>d.text.length))+1);this.height=this.buttons.length*a;this.a=0;this.active=!!b;this.c=a}update(a){if(this.active){var b=this.a;la(a.input)?--this.a:ma(a.input)&&++this.a;this.a=t(this.a,this.buttons.length);this.a!=b&&Q(a.audio,a.m.G.next,.6);b=this.buttons[this.a];if(a.input.actions.start.state==H||a.input.actions.fire1.state==H)null!=b.Ia&&b.Ia(a),Q(a.audio,a.m.G.accept,.6)}}o(a,
b,c){if(this.active){b-=this.width/2;c-=this.height/2;for(let e=0;e<this.buttons.length;++e){var d=this.a==e?"@":" ";d+=this.buttons[e].text;z(a,a.A.font,d,b,c+e*this.c,0,!1)}}}};function U(a,b,c,d,e){return v(a.b,a.C,a.v,b,c,d,e)}function V(a){var b=a.speed;b.x=0;b.y=0;a=a.target;a.x=0;a.y=0}
class Ca{constructor(a,b){this.b=new k(a,b);this.ja=this.b.clone();this.speed=new k(0,0);this.target=this.speed.clone();this.c=new k(1,1);this.C=new k(0,0);this.v=new k(0,0);this.i=!0;this.F=this.P=!1;this.g=new T(0,0)}Ga(){}pa(){}ka(){}Fa(){return!0}update(a){this.i&&(this.F?this.P?this.Fa(a)&&(this.P=this.i=!1):(this.ja=this.b.clone(),this.pa(a),this.speed.x=ba(this.speed.x,this.target.x,this.c.x*a.step),this.speed.y=ba(this.speed.y,this.target.y,this.c.y*a.step),this.b.x+=this.speed.x*a.step,this.b.y+=
this.speed.y*a.step,this.ka()):this.Ga())}o(){}};function Da(a,b,c,d){if(!(!a.F||a.da||!a.i||a.P||0>a.speed.y)){var e=a.b.x+a.C.x-a.L.x/2;e+a.L.x<=b+1||e>=b+16-1||(b=a.C.y+a.L.y/2,e=a.ja.y+b,a.b.y+b>=c-1*d.step&&e<=c+(2+a.speed.y)*d.step&&(a.b.y=c-b,a.oa(),a.speed.y*=-a.xa))}}
function W(a,b,c,d,e,f){if(!(!a.F||a.da||!a.i||a.P||0>a.speed.x*e)){var g=a.b.y+a.C.y-a.L.y/2;!(g+a.L.y<=c+1||g>=c+d-1)&&(c=a.C.x+a.L.x/2*e,d=a.ja.x+c,g=a.b.x+c,0<e&&g>=b-1*f.step&&d<=b+(2+a.speed.x)*f.step||0>e&&g<=b+1*f.step&&d>=b-(2-a.speed.x)*f.step)&&(a.b.x=b-c,a.qa(e,f),a.speed.x*=-a.Ea)}}class X extends Ca{constructor(a,b){super(a,b);this.L=this.v.clone();this.da=!1;this.xa=this.Ea=0}oa(){}qa(){}Ja(){}};class Ea extends X{constructor(){super(0,0);this.i=!1;this.g=new T(8,8);this.c=new k(.015,.1);this.xa=this.Ea=.75;this.L=new k(4,4);this.C=new k(0,7)}la(a,b,c,d,e){this.b=new k(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.target.y=4;this.i=!0;S(this.g,4*Math.random()|0,e);this.a=!0}Ga(){this.i=!1}o(a){this.i&&this.F&&this.g.o(a,a.A.chips,this.b.x-4,this.b.y+3,0)}oa(){!this.a&&.1>this.speed.y&&(this.i=!1);this.a=!1}};const Fa=[1,4,8,2,9,6,3,5,12,10,7,13,14,11,15];class Ga{constructor(){this.b=new k(0,0);this.a=this.f=this.speed=this.c=0;this.i=!1}la(a,b,c,d,e){this.c=0;this.speed=d;this.f=c;this.a=e;this.b=new k(a,b);this.i=!0}update(a,b){this.i&&16<=(this.c+=this.speed*b.step)&&(O(a.O,this.f,this.b.x,this.b.y+1,this.a+1),this.i=!1)}o(a){this.i&&y(a,a.A.tileset,this.a%16*16,16*(this.a/16|0),16,16,16*this.b.x,16*this.b.y+this.c|0,16,16,0)}}
function Y(a,b,c){if(b.i&&b.F&&!b.P){var d=b.b.x/16|0,e=b.b.y/16|0,f=d-2,g=e-2;d+=4;e+=4;for(let B=0;B<a.O.Z.length-1;++B)for(let C=g;C<=e;++C)for(let u=f;u<=d;++u){var h=N(a.O,B,u,C);if(0!=h){var l=a.l.Z[0][h-1];if(null!=l)if(0<l&&l<=Fa.length)Ha(b,l-1,u,C,c);else{var n=a,m=b,p=l-1;l=h-1;var q=u,r=C;h=B;var w=c,K=[2,0,2,8],A=[8,2,0,2],P=[12,8,12,8],E=[8,12,8,12];switch(p){case 15:void 0!=m.ga&&m.ga(16*q,16*r,16,16,w);break;case 16:case 17:case 18:case 19:void 0!=m.Ba&&m.Ba(16*q+K[p-16],16*r+A[p-
16],P[p-16],E[p-16],2,w);break;case 20:case 21:case 22:if(void 0!=m.ya&&m.ya(16*q,16*r,16,16,w)-1>=p-20){O(n.O,h,q,r,0);{let F,L;m=n;K=16*q+8;A=16*r+8;P=p-20;E=Math.random()*Math.PI;let Ma=2*Math.PI/6;for(let Z=0;6>Z;++Z)L=E+Ma*Z,F=1.5*Math.random()+1,aa(m.c,Ea).la(K,A,Math.cos(L)*F,Math.sin(L)*F*1.75,P);Q(w.audio,w.m.G["break"],.5)}20==p&&N(n.O,h,q,r-1)==l+1&&(O(n.O,h,q,r-1,0),p=q,--r,aa(n.h,Ga).la(p,r,h,.5,l));break}Ha(m,14,q,r,w);break;case 27:void 0!=m.ga&&m.ga(16*q+8,16*r,16,16,w);break;case 29:void 0!=
m.va&&m.va(16*q,16*r+8,16,8,w);break;case 30:void 0!=m.va&&m.va(16*q,16*r,16,16,w);break;case 31:Da(m,16*q,16*(r+1),w),void 0!=m.ga&&m.ga(16*q,16*r+8,16,8,w,4)}}}}}}
function Ha(a,b,c,d,e){b=Fa[b|0];1==(b&1)&&Da(a,16*c,16*d,e);if(8==(b&8)){var f=16*c,g=16*(d+1);if(!(!a.F||a.da||!a.i||a.P||0<a.speed.y)){var h=a.b.x+a.C.x-a.L.x/2;h+a.L.x<=f+1||h>=f+16-1||(f=a.C.y-a.L.y/2,h=a.ja.y+f,a.b.y+f<=g+1*e.step&&h>=g-(2-a.speed.y)*e.step&&(a.b.y=g-f,a.Ja(),a.speed.y*=-a.xa))}}4==(b&4)&&W(a,16*(c+1),16*d,16,-1,e);2==(b&2)&&W(a,16*c,16*d,16,1,e)}
class Ia{constructor(a){this.O=a.Da.base;this.l=a.Da.collisions;this.width=this.O.width;this.height=this.O.height;this.a=this.f=0;this.c=[];this.h=[]}update(a,b){this.f=(this.f+.5*b.step)%96;this.a=(this.a+.125*b.step)%16;for(let c of this.c)c.F=Ja(a,c),c.update(b),Y(this,c,b);for(let c of this.h)c.update(this,b)}o(a,b){let c=(10*b.I.x|0)-1;b=(9*b.I.y|0)-1;let d=(a.width/16|0)+2,e=(a.height/16|0)+2;for(let A=0;A<this.O.Z.length-1;++A){{var f=void 0,g=void 0,h=void 0,l=a,n=a.A.tileset,m=A,p=c,q=b,
r=d,w=e;const P=[133];for(let E=q;E<q+w;++E)for(let B=p;B<p+r;++B)if(h=N(this.O,m,B,E),0!=h--)if(P.includes(h)){{let C,u;g=l;f=n;var K=B;let F=h%16|0,L=h/16|0;switch(h){case 133:C=16*E+(1+Math.round(Math.sin(this.a/16*Math.PI*2))),u=this.a|0,u%2!=C%2&&++F,h=16-u,y(g,f,16*F+u,16*L,h,16,16*K,C,h,16,0),0<u&&y(g,f,16*F,16*L,u,16,16*(K+1)-u,C,u,16,0)}}}else g=h%16|0,f=h/16|0,y(l,n,16*g,16*f,16,16,16*B,16*E,16,16,0)}}for(let A of this.h)A.o(a);for(let A of this.c)A.o(a)}};function Ka(a,b,c,d){a.D-=c;a.speed.x=a.T*b;a.a=30+a.a%2;0>=a.D&&(a.a=0,a.P=!0,a.s=0,S(a.g,0,0));Q(d.audio,d.m.G[a.P?"kill":"hit"],.6)}
class La extends X{constructor(a,b,c,d,e){super(a,b);this.X=this.b.clone();this.g=new T(16,16);S(this.g,0,c+1);this.D=d;this.ba=e;this.a=0;this.W=this.S=-1;this.f=1;this.s=0;this.l=!1;this.c=new k(.1,.1);this.T=1;this.v=new k(8,8);this.L=new k(8,8);this.N=new k(0,0);this.h=!1;this.M(a)}M(){}Y(){}R(){}Fa(a){R(this.g,0,0,4,6,a.step);return 4<=this.g.a}pa(a){this.h||(this.Y(a),this.R(a),0<this.a&&(this.a-=a.step))}ka(){this.l=!1}o(a){this.h||!this.i||!this.F||0<this.a&&0==Math.floor(this.a/2)%2||this.g.o(a,
a.A.enemies,this.b.x+this.N.x-this.g.width/2|0,this.b.y+this.N.y-this.g.height/2|0,this.s)}oa(){this.l=!0}za(a,b){if(this.i){var c=this.F;this.F=Ja(a,this);!this.F&&this.h?(this.da=this.h=!1,this.M(this.X.x)):(!this.P&&this.F!=c&&c&&(this.b=this.X.clone(),V(this),a.Ma||(this.da=this.h=!0)),!a.Ma&&this.F&&(W(this,a.I.x*a.width,a.I.y*a.height,a.height,-1,b),W(this,(a.I.x+1)*a.width,a.I.y*a.height,a.height,1,b)))}}}
class Na extends La{constructor(a,b){super(a,b,0,2,1);this.c.x=.025;this.V=!0;this.C.y=2;this.L=new k(4,12);this.N.y=1;this.T=.5}M(a){this.f=2-(a/16|0)%2;this.s=0<this.f?1:0;this.target.x=.25;this.speed.x=this.target.x;this.target.y=2}Y(a){this.V&&!this.l&&0>=this.a&&(this.f*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.V=this.l}R(a){this.s=0<this.f?1:0;this.l&&R(this.g,this.g.c,0,3,6,a.step)}qa(){this.speed.x*=-1;this.target.x*=-1;this.f*=-1}};class Oa extends X{constructor(){super(0,0);this.g=new T(16,16);this.a=!1;this.h=0;this.l=null;this.s=0;this.c=new k(.1,.1);this.L=new k(4,4);this.v=new k(8,8);this.f=this.F=this.i=!1;this.Aa=0}la(a,b,c,d,e,f){this.b=new k(a,b);this.speed=new k(c,d);this.target=this.speed.clone();this.a=!1;this.h=e;this.l=f;this.s=this.speed.length();this.F=this.i=!0;this.f=this.da=this.P=!1;++this.Aa}pa(a){let b=new k(this.b.x-this.l.b.x,this.b.y-this.l.b.y),c=b.length();{let d=b.length();1E-4>d?(b.x=0,b.y=0):(b.x/=
d,b.y/=d,b.clone())}this.a?(this.target.x=-b.x*this.s,this.target.y=-b.y*this.s,this.f||(this.f=Math.sign(this.target.x)==Math.sign(this.speed.x)&&Math.sign(this.target.y)==Math.sign(this.speed.y)),12>c&&(this.i=!1)):0>=(this.h-=a.step)&&(this.a=!0);R(this.g,5,1,4,4,a.step);this.da=this.a&&this.f}o(a){this.i&&this.g.o(a,a.A.figure,this.b.x-8|0,this.b.y-8|0,0<=this.speed.x?0:1)}qa(){this.f=!0;this.a||(this.h=0,this.a=!0)}ya(a,b,c,d){return this.i&&U(this,a,b,c,d)?1:0}};function Pa(a,b){a.D&&(a.K*=-1,a.a=0==a.a?1:0);a.R=!1;a.u=20;V(a);b?a.f||(a.speed.x=1.25*a.K,a.target.x=a.speed.x):a.u+=10;a.$=b;a.h=0;a.s=0;a.ha=!0;var c=a.b.y+2;a.U.x=a.b.x+13*a.K;a.U.y=c;a.aa.x=12;a.aa.y=b?10:4;++a.ra}
class Qa extends X{constructor(a,b,c){super(a,b);this.g=new T(16,16);this.ia=new T(16,16);this.a=0;this.c=new k(.1,.15);this.C=new k(0,2);this.v=new k(8,12);this.L=new k(6,12);this.N=!1;this.h=0;this.l=!1;this.S=0;this.T=this.Y=this.f=!1;this.u=this.s=0;this.X=this.R=this.ha=!1;this.ma=0;this.$=!1;this.U=new k(0,0);this.aa=new k(0,0);this.ra=0;this.H=!1;this.W=0;this.D=!1;this.Ha=this.M=0;this.B=new Oa;this.B.i=!1;this.K=1;this.ba=this.V=0;this.progress=c;this.wa=this.na=!1;this.F=!0}pa(a){this.Y&&
!this.f&&(this.Y=!1);this.K=0==this.a?1:-1;var b=a.input.actions.fire2.state;if(b=b==G||b==D)this.X&&b?(this.X=!1,this.ma=0,Pa(this,!0),Q(a.audio,a.m.G.powerAttack,.6)):!this.$&&0<this.u&&10>=this.u&&(this.u=0);if(!(0<this.u||this.H||(this.target.y=2,0<this.ba))){this.target.x=1*a.input.j.x;this.D&&(this.target.y*=.25);this.c=new k(.1,.15);a:{if(a.input.actions.fire2.state==H){if(!this.f&&!this.T&&!this.N&&.1<a.input.j.y){V(this);this.speed.y=-3;this.target.y=4;this.c.y=.35;this.H=!0;this.W=0;b=this.b.y+
8;this.U.x=this.b.x;this.U.y=b;this.aa.x=12;this.aa.y=16;++this.ra;Q(a.audio,a.m.G.downAttack,.6);b=!0;break a}if(this.R){Pa(this,!1);Q(a.audio,a.m.G.sword,.5);b=!0;break a}}b=!1}if(b=!b)this.B.i?b=!1:(this.D&&(this.K*=-1,this.a=0==this.a?1:0),a.input.actions.fire3.state==H?(this.B.la(this.b.x+4*this.K,this.b.y+2,2*this.K,0,24,this),this.B.ja.x=this.b.x,V(this),this.u=30,this.ha=!1,this.s=this.h=0,Q(a.audio,a.m.G["throw"],.6),b=!0):b=!1),b=!b;if(b&&(this.T&&(this.c.x*=.5,this.c.y*=.25,this.target.x*=
.5,this.target.y*=.25,this.D=!1,this.M=0),b=a.input.actions.fire1.state,this.f?(.1<a.input.j.x?this.a=0:-.1>a.input.j.x&&(this.a=1),this.target.y=.5*a.input.j.y,this.target.x=0,b==H&&(.1>a.input.j.y&&(this.h=14),this.Y=this.f=this.l=!1,Q(a.audio,a.m.G.jump,.5)),b=!0):b=!1,!b)){b=a.input.actions.fire1.state;if(b==H)if(!this.T&&this.N&&.1<a.input.j.y)this.s=20,Q(a.audio,a.m.G.jump,.5);else{if(this.N||0<this.S||!this.l||0<this.M)this.h=(this.l=!this.N&&0>=this.S&&0>=this.M)?8:14,this.N=!1,this.S=0,0<
this.M&&(this.speed.x=-2*this.Ha),this.D=!1,this.M=0,this.R=!0,this.wa=!1,Q(a.audio,a.m.G.jump,.5)}else b==G&&(0<this.h?this.h=0:0<this.s&&(this.s=0),this.wa=!0);if(this.na=this.wa&&this.l&&0>=this.u&&this.l&&1==(b&1)&&0>=this.h)this.target.y=.5,this.speed.y=this.target.y}}0<this.u&&this.$?this.U.x+=this.speed.x*a.step:this.H&&(this.U.y+=this.speed.y*a.step);0<this.h&&(this.speed.y=-2,this.T&&(this.speed.y*=.5),this.h-=a.step);0<this.s&&(this.speed.x=2*this.K,this.target.x=this.speed.x,this.s-=a.step);
0<this.S&&(this.S-=a.step);0<this.M&&(this.M-=a.step);0<this.u&&(this.u-=a.step,!this.$&&this.ha&&0>=this.u&&(this.X=!0,Q(a.audio,a.m.G.charge,.5)));0<this.W&&0>=(this.W-=a.step)&&(this.H=!1);this.X&&(this.ma=(this.ma+a.step)%20);0<this.V&&(0<this.ba?this.ba-=a.step:this.V-=a.step);{b=this.g.a;let c=this.g.c;if(0<this.ba)S(this.g,0,5);else if(this.H)S(this.ia,3,4),S(this.g,1,4);else if(0<this.u)S(this.g,0,4),this.$?R(this.ia,4,7,8,4,a.step):S(this.ia,2,4);else if(0<this.s)S(this.g,4,1);else if(.1<
Math.abs(this.target.x)&&(this.a=0>this.target.x?1:0),this.D)S(this.g,3,1);else if(this.T)0<=this.speed.y&&.1<Math.abs(this.target.x)?R(this.g,3,0,1,10,a.step):(b=0>this.speed.y?2:0,S(this.g,b,3));else if(this.f){if(3!=this.g.c||.1<Math.abs(this.target.y))R(this.g,3,3,4,10,a.step),(this.g.c!=c||this.g.a!=b&&3==this.g.a)&&Q(a.audio,a.m.G.climb,.6)}else this.na?(R(this.g,6,0,3,3,a.step),(this.g.c!=c||this.g.a!=b&&0==this.g.a)&&Q(a.audio,a.m.G.flap,.5)):this.N?.1>Math.abs(this.speed.x)&&.1>Math.abs(this.target.x)?
S(this.g,0,0):(b=12-6*Math.abs(this.speed.x),R(this.g,0,1,4,b,a.step)):this.l&&0>this.speed.y?R(this.g,2,0,4,4,a.step):(b=0,.5>Math.abs(this.speed.y)?b=1:0<this.speed.y&&(b=2),S(this.g,b,1))}this.B.update(a);this.T=this.f=!1}ka(){this.D=this.N=!1}o(a){if(!(0<this.V&&0!=Math.floor(this.V/2)%2)){var b=this.g.a;this.X&&0==Math.floor(this.ma/2)%2&&(b+=5);var c=Math.round(this.b.x-8),d=Math.round(this.b.y-7);0<this.u&&this.ha&&this.ia.o(a,a.A.figure,c+12-24*this.a,d+1,this.a);var e=this.g,f=e.width,g=
e.height;y(a,a.A.figure,e.width*b,e.height*this.g.c,f,g,c,d,f,g,this.a);this.H&&this.ia.o(a,a.A.figure,c+3-6*this.a,d+7,this.a);this.B.o(a)}}oa(){this.N=!0;this.l=!1;this.S=12;.1<this.speed.y&&(this.Y=this.f=!1);this.R=!0;this.H&&0>=this.W&&(this.W=20);this.M=0;this.D=!1}qa(a,b){!this.f&&!this.H&&0>=this.u&&!this.T&&0<this.speed.y&&.1<b.input.j.x*a&&(this.D=!0,this.M=15,this.Ha=a,this.R=!0)}Ja(){this.h=0}ga(a,b,c,d,e,f){return U(this,a+4,b,c-8,d)?this.Y?(this.R=!0,void 0==f&&(this.f=!0),!0):la(e.input)||
ma(e.input)?(this.Y=this.f=this.R=!0,this.b.x=a+8,void 0!=f&&(this.b.y=b+f),V(this),!0):!1:!1}va(a,b,c,d){return U(this,a,b,c,d)?(this.T=!0,this.S=1,this.l=!1,this.s=0,this.R=!0):!1}za(a,b){let c=a.b.x*a.width,d=a.b.y*a.height,e=a.target.x-a.b.x,f=a.target.y-a.b.y,g=(this.v.x+2)*a.ua,h=(this.v.y+2)*a.ua,l=0,n=0,m;a.ea?(this.b.x+=e*g*b.step,this.b.y+=f*h*b.step):(0<this.speed.x&&this.b.x+this.C.x+this.v.x/2>c+a.width?l=1:0>this.speed.x&&this.b.x+this.C.x-this.v.x/2<c?l=-1:0<this.speed.y&&this.b.y+
this.C.y+this.v.y/2>d+a.height?n=1:0>this.speed.y&&this.b.y+this.C.y-this.v.y/2<d&&(n=-1),0==l&&0==n||0==(m=a.move(l,n,.05))||(this.b.x+=m*a.width*a.fa));null!=this.B&&this.B.i&&!Ja(a,this.B)&&(this.B.i=!1)}Ba(a,b,c,d,e,f){if(!(0<this.V))return U(this,a,b,c,d)?(this.K=this.b.x<a+c/2?1:-1,this.a=0<this.K?0:1,this.V=60,this.ba=30,this.target.x=0,this.speed.x=2*-this.K,this.f=!1,this.u=0,this.na=this.X=this.D=this.H=!1,a=this.progress,a.a=Math.max(0,a.a-e),Q(f.audio,f.m.G.hurt,.5),!0):!1}ya(a,b,c,d){return(0<
this.u&&this.ha||0<this.speed.y&&this.H||0<this.W)&&v(this.U,null,this.aa,a,b,c,d)?this.$||this.H?2:1:0}};class Ra{constructor(a){this.a=null;this.c=[];this.progress=a}update(a,b,c){for(let h of this.c)if(h.za(a,c),!a.ea){h.update(c);var d=h,e=this.a,f=c;if(d.i&&!d.P&&d.F&&!d.h)if(e.Ba(d.b.x+d.C.x-d.v.x/2,d.b.y+d.C.y-d.v.y/2,d.v.x,d.v.y,d.ba,f),(e.H||e.ha&&0<e.u)&&e.ra>d.S&&v(d.b,d.C,d.v,e.U.x-e.aa.x/2,e.U.y-e.aa.y/2,e.aa.x,e.aa.y))Ka(d,e.H?0:2*e.K*(e.$?1.5:1),e.$||e.H?2:1,f),d.S=e.ra,d=e,d.$&&0<d.u&&(d.speed.x=0,d.target.x=0),e.H&&(e.H=!1,e.h=8,e.l=!1);else{var g;if(g=e.B.i&&e.B.Aa>d.W)g=e.B,g=U(d,g.b.x-
g.v.x/2,g.b.y-g.v.y/2,g.v.x,g.v.y);g&&(Ka(d,2*(d.b.x<e.B.b.x?-1:1),1,f),f=e.B,f.h=0,f.a=!0,d.W=e.B.Aa)}Y(b,h,c)}a.ea||(this.a.update(c),Y(b,this.a,c),this.a.B.i&&Y(b,this.a.B,c));this.a.za(a,c)}o(a){for(let b of this.c)b.o(a);this.a.o(a)}};class Sa{constructor(){this.a=this.c=6}};function Ja(a,b){if(void 0==b.g)return!1;let c=a.I.x*a.width,d=a.I.y*a.height;return b.b.x+b.g.width/2>=c&&b.b.y+b.g.height/2>=d&&b.b.x-b.g.width/2<c+a.width&&b.b.y-b.g.height/2<d+a.height}
class Ta{constructor(a,b,c,d,e,f,g){this.b=new k(a,b);this.target=this.b.clone();this.I=this.b.clone();this.width=c;this.height=d;this.ea=!1;this.ua=this.a=0;this.fa=e;this.f=f;this.c=g}move(a,b,c){if(this.ea||!this.c&&(0==this.b.x&&0>a||this.b.x==this.fa-1&&0<a)||!this.h&&(0==this.b.y&&0>b||this.b.y==this.f-1&&0<b))return 0;this.a=1;this.ua=c;this.target.x=this.b.x+a|0;this.target.y=this.b.y+b|0;this.ea=!0;return this.c&&0>this.target.x?(this.b.x+=this.fa,this.target.x+=this.fa,1):this.c&&this.target.x>=
this.fa?(this.b.x-=this.fa,this.target.x-=this.fa,-1):0}update(a){this.ea&&(0>=(this.a-=this.ua*a.step)?(this.a=0,this.b=this.target.clone(),this.I=this.b.clone(),this.ea=!1):(a=this.a,this.I.x=a*this.b.x+(1-a)*this.target.x,this.I.y=a*this.b.y+(1-a)*this.target.y))}setPosition(a,b){this.b=new k(a,b);this.target=this.b.clone();this.I=this.b.clone()}};class Ua extends M{constructor(a,b){super(a,b);this.c=new Ia(a.m);this.a=new Ta(0,0,160,144,this.c.width/10|0,this.c.height/9|0,!0);this.progress=new Sa;this.h=new Ra(this.progress);var c=this.c;{b=this.h;var d=c.O.Z[c.O.Z.length-1],e=c.width;c=c.height;let h;for(let l=0;l<c;++l)for(let n=0;n<e;++n){var f=d[l*e+n]-512;if(!(0>=f)){--f;switch(f){case 0:b.a=new Qa(16*n+8,16*l+8,b.progress)}if(1<=f&&15>=f){h=b.c.length;for(var g=0;g<b.c.length;++g)if(!b.c[g].i){h=g;break}g=[Na];f=g[Math.max(0,Math.min(f-
1,g.length-1))|0];b.c[h]=new f.prototype.constructor(16*n+8,16*l+8)}}}}b=this.h;this.a.setPosition(b.a.b.x/160|0,b.a.b.y/144|0);this.f=!1;b=a.audio;a=a.m.G.testTrack;b.c&&(null!=b.a&&(b.a.stop(),b.a=null),a.play(b.J,.6,!0,0),b.a=a)}refresh(a){if(a.input.actions.start.state==H)if(this.f=!this.f){var b=a.audio;b.c&&null!=b.a&&b.a.pause(b.J)}else b=a.audio,b.c&&null!=b.a&&b.a.resume(b.J);this.f||(this.c.update(this.a,a),this.h.update(this.a,this.c,a),this.a.update(a))}Ka(){}Ca(a){a.moveTo(0,0);var b=
this.a,c=t(this.c.f+16*b.I.x,96);a.clear(85,170,255);y(a,a.A.background,16,32,48,48,96,16,48,48,0);b=16*b.I.y|0;a.move(0,-b);for(var d=0;3>d;++d)y(a,a.A.background,0,0,96,32,Math.round(-c+96*d),96,96,32,0);x(a,255,255,255);a.fillRect(0,128,a.width,16);for(c=0;c<a.width/16|0;++c)y(a,a.A.background,0,32,16,32,16*c,144,16,32,0);x(a,0,85,170);a.fillRect(0,176,a.width,Math.max(0,a.height+b-176));a.move(0,b);c=this.a;a.moveTo(-Math.round(c.I.x*c.width),-Math.round(c.I.y*c.height));this.c.o(a,this.a);this.h.o(a);
a.moveTo();c=a.A.font;for(d=0;d<this.progress.c;++d)b=9*(d/2|0),0==d%2&&y(a,c,40,0,8,8,1+b,1,8,8,void 0),this.progress.a>d&&y(a,c,32+d%2*4,0,4,8,1+b+d%2*4,1,4,8,void 0);this.f&&(x(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),z(a,a.A.font,"PAUSED",a.width/2,a.height/2-4,0,!0))}};class Va extends M{constructor(a,b){super(a,b);this.a=new Ba(12,!0,[new Aa("YES",c=>{c.audio.toggle(!0);c.audio.La=.7;c.ta(Ua)}),new Aa("NO",c=>{c.audio.toggle(!1);c.ta(Ua)})])}refresh(a){this.a.update(a)}Ca(a){a.clear(0,85,170);z(a,a.A.font,"ENABLE AUDIO?\nPRESS ENTER\nTO CONFIRM.",32,a.height/2-32,2,!1);this.a.o(a,a.width/2,a.height/2+16)}};window.onload=()=>{var a=new za(160,144,0);a.m.load("assets/assets.json");var b=[{name:"fire1",key:"KeyZ",ca:0},{name:"fire2",key:"KeyX",ca:2},{name:"fire3",key:"KeyC",ca:1},{name:"start",key:"Enter",ca:9,sa:7},{name:"back",key:"Escape"}];for(let c of b)J(a.a.input,c.name,c.key,c.ca,c.sa);a.h=Va;a.l=!1;a.loop(0)};
</script>
</body>
</html>
