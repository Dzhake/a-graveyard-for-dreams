'use strict';function h(a,b){b|=0;return((a|0)%b+b)%b}function m(a,b,c){return Math.max(b,Math.min(a,c))}function p(a,b){for(let c of a)if(!c.u)return c;a.push(new b.prototype.constructor);return a[a.length-1]}function da(a,b,c){return a<b?Math.min(b,a+c):Math.max(b,a-c)}function ea(a,b,c,d,e,f,g){null==b&&(b=new t(0,0));let k=a.x+b.x-c.x/2;a=a.y+b.y-c.y/2;return k+c.x>=d&&k<d+f&&a+c.y>=e&&a<e+g};function v(a,b){let c=a.length();if(1E-4>c)a.x=b?1:0,a.y=0;else return a.x/=c,a.y/=c,a.clone()}function fa(a){a.x=0;a.y=0}class t{constructor(a,b){this.x=void 0==a?0:a;this.y=void 0==b?0:b}length(){return Math.hypot(this.x,this.y)}clone(){return new t(this.x,this.y)}}class w{constructor(a,b,c){this.r=m(a,0,255);this.gb=m(b,0,255);this.eb=m(c,0,255)}clone(){return new w(this.r,this.gb,this.eb)}};function ha(a,b,c){let d=document.createElement("div");d.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;");a.c=document.createElement("canvas");a.c.width=b;a.c.height=c;a.c.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");d.appendChild(a.c);document.body.appendChild(d);a.X=a.c.getContext("2d");a.X.imageSmoothingEnabled=!1;ia(a)}
function ia(a){var b=window.innerWidth,c=window.innerHeight;a=a.c;var d=Math.min(b/a.width|0,c/a.height|0);let e=a.width*d;d*=a.height;c=String(c/2-d/2|0)+"px";b=String(b/2-e/2|0)+"px";a.style.width=String(e|0)+"px";a.style.height=String(d|0)+"px";a.style.top=c;a.style.left=b}function y(a,b,c,d,e){b=void 0==b?255:b;c=void 0==c?b:c;b="rgba("+String(b|0)+","+String(c|0)+","+String((void 0==d?c:d)|0)+","+String(void 0!=e?e:1);a.X.fillStyle=b;a.X.strokeStyle=b}
function z(a,b,c,d,e,f,g,k,l){var n=e,r=f;if(!(null==b||0>=n||0>=r)){var q=a.X;g+=a.a.x;a=k+a.a.y;c|=0;d|=0;n|=0;r|=0;g|=0;a|=0;e|=0;f|=0;l|=0;0!=l&&q.save();0!=(l&1)&&(q.translate(e,0),q.scale(-1,1),g*=-1);0!=(l&2)&&(q.translate(0,f),q.scale(1,-1),a*=-1);q.drawImage(b,c,d,n,r,g,a,e,f);0!=l&&q.restore()}}function A(a,b,c,d,e,f,g,k){let l=b.width/16|0,n=d;k&&(n=d-=c.length*(l+f)/2);for(let r=0;r<c.length;++r)k=c.charCodeAt(r),10==k?(n=d,e+=l+g):(z(a,b,k%16*l,(k/16|0)*l,l,l,n,e,!1),n+=l+f)}
class ja{constructor(a,b,c){this.X=this.c=null;ha(this,a,b);this.width=a;this.height=b;window.addEventListener("resize",()=>ia(this));this.a=new t(0,0);this.F=null==c?{}:c;this.Za=0;this.Ya=new t(0,0)}clear(a,b,c){this.X.fillStyle="rgba("+String(a|0)+","+String(b|0)+","+String(c|0)+",1";this.X.fillRect(0,0,this.width,this.height)}fillRect(a,b,c,d){a+=this.a.x;b+=this.a.y;this.X.fillRect(a|0,b|0,c|0,d|0)}moveTo(a,b){this.a=new t(a,b)}move(a,b){this.a.x+=a;this.a.y+=b}update(a){0<this.Za&&(this.Za-=
a.step)}};function ka(a,b){if(null==b)for(b=0;b<a.buttons.length;++b)a.buttons[b]=B;else for(let c=0;c<b.buttons.length;++c){if(c>=a.buttons.length)for(let d=0;d<c-a.buttons.length;++d)a.buttons.push(B);b.buttons[c].pressed?a.buttons[c]==B||a.buttons[c]==C?(a.Pa=!0,a.buttons[c]=D):a.buttons[c]=ma:a.buttons[c]=a.buttons[c]==ma||a.buttons[c]==D?C:B}}
function na(a,b){null!=b&&(a.J.x=0,a.J.y=0,.05<Math.hypot(b.axes[0],b.axes[1])&&(a.J.x=b.axes[0],a.J.y=b.axes[1]),8<=b.axes.length&&.1>Math.hypot(a.J.x,a.J.y)&&.05<Math.hypot(b.axes[6],b.axes[7])&&(a.J.x=b.axes[6],a.J.y=b.axes[7]))}function oa(a,b){return null==b||0>b||b>=a.buttons.length?B:a.buttons[b]}
class pa{constructor(){this.J=new t(0,0);this.buttons=[];this.a=null;this.index=0;window.addEventListener("gamepadconnected",a=>{console.log("Gamepad with index "+String(a.gamepad.index)+" connected.");let b=navigator.getGamepads()[a.gamepad.index];this.index=a.gamepad.index;a=this.a=b;na(this,a);ka(this,a)});this.Pa=!1}update(){this.Pa=!1;this.J.x=0;this.J.y=0;if(null!=this.a){var a=navigator;a=null==a?null:a.getGamepads?a.getGamepads():a.webkitGetGamepads?a.webkitGetGamepads:null;null!=a&&(this.a=
a[this.index])}a=this.a;na(this,a);ka(this,a)}};var B=0,C=2,ma=1,D=3;function E(a,b,c,d,e){a.actions[b]={state:B,key:c,ua:d,Qa:e};a.l[c]=!0;return a}
function qa(a){a.a.update();for(let b in a.actions)a.actions[b].state=a.c[a.actions[b].key]|B,a.actions[b].state==B&&(null!=a.actions[b].ua&&(a.actions[b].state=oa(a.a,a.actions[b].ua)),a.actions[b].state==B&&null!=a.actions[b].Qa&&(a.actions[b].state=oa(a.a,a.actions[b].Qa)));a.g=a.J.clone();fa(a.J);.1<a.a.J.length()&&(a.J=a.a.J.clone());a.actions.right.state&1?a.J.x=1:a.actions.left.state&1&&(a.J.x=-1);a.actions.down.state&1?a.J.y=1:a.actions.up.state&1&&(a.J.y=-1);a.o=new t(a.J.x-a.g.x,a.J.y-a.g.y)}
function ra(a){return 0>a.J.y&&-.25<=a.g.y&&-.25>a.o.y}function sa(a){return 0<a.J.y&&.25>=a.g.y&&.25<a.o.y}
class ta{constructor(){this.c={};this.l={};this.actions={};this.a=new pa;this.J=new t(0,0);this.g=new t(0,0);this.o=new t(0,0);window.addEventListener("keydown",a=>{var b=a.code;this.i=!0;this.c[b]!=ma&&(this.c[b]=D);this.l[b]&&a.preventDefault()});window.addEventListener("keyup",a=>{var b=a.code;this.c[b]!=B&&(this.c[b]=C);this.l[b]&&a.preventDefault()});window.addEventListener("contextmenu",a=>{a.preventDefault()});window.addEventListener("mousemove",()=>{window.focus()});window.addEventListener("mousedown",
()=>{window.focus()});this.i=!1}Xa(){var a=this.c;for(let b in a)a[b]==D?a[b]=ma:a[b]==C&&(a[b]=B);this.i=!1}Pa(){return this.i||this.a.Pa}};class ua{constructor(){}refresh(){}ib(){}mb(){}};function va(a,b,c,d){return a.ha[b][h(d,a.height)*a.width+h(c,a.width)]}function wa(a,b,c,d,e){c=h(c,a.width);d=h(d,a.height);a.ha[b][d*a.width+c]=e}function xa(a){let b=new Ba;for(let c of a.ha)b.ha.push(Array.from(c));b.width=a.width;b.height=a.height;b.a=a.a;return b}class Ba{constructor(){this.height=this.width=0;this.ha=[];this.a={}}};class Ca{constructor(a,b){this.data=b;this.a=null;this.gain=a.createGain();this.i=this.c=this.g=0;this.loop=!1}play(a,b,c,d){null!=this.a&&(this.a.disconnect(),this.a=null);let e=a.createBufferSource();e.buffer=this.data;e.loop=!!c;b=m(b,0,1);this.gain.gain.value=b;this.g=a.currentTime-d;this.c=0;this.i=b;this.loop=c;e.connect(this.gain).connect(a.destination);e.start(0,d);this.a=e}stop(){null!=this.a&&(this.a.disconnect(),this.a.stop(0),this.a=null)}pause(a){null!=this.a&&(this.c=a.currentTime-this.g,
this.stop())}resume(a){this.play(a,this.i,this.loop,this.c)}};function Da(a,b){Ea(a,b,"json",c=>{c=JSON.parse(c);for(let d in c.bitmaps)Fa(a,c.bitmaps[d].name,c.bitmapPath+c.bitmaps[d].path);for(let d in c.tilemaps)Ga(a,c.tilemaps[d].name,c.tilemapPath+c.tilemaps[d].path);for(let d in c.samples)Ha(a,c.samples[d].name,c.samplePath+c.samples[d].path);for(let d in c.localization)Ia(a,c.localization[d].name,c.localizationPath+c.localization[d].path)})}
function Ea(a,b,c,d){let e=new XMLHttpRequest;e.overrideMimeType("text/"+c);e.open("GET",b,!0);++a.total;e.onreadystatechange=()=>{4==e.readyState&&("200"==String(e.status)&&void 0!=d&&d(e.responseText),++a.loaded)};e.send(null)}function Fa(a,b,c){++a.total;let d=new Image;d.onload=()=>{++a.loaded;a.F[b]=d};d.src=c}
function Ga(a,b,c){++a.total;Ea(a,c,"xml",d=>{var e=a.qb;{var f=new Ba;d=(new DOMParser).parseFromString(d,"text/xml").getElementsByTagName("map")[0];f.width=String(d.getAttribute("width"));f.height=String(d.getAttribute("height"));let l=d.getElementsByTagName("layer");f.ha=[];let n=9999;for(var g of l)g.id<n&&(n=g.id);for(let r=0;r<l.length;++r){g=l[r].id-n;var k=l[r].getElementsByTagName("data")[0].childNodes[0].nodeValue.replace(/(\r\n|\n|\r)/gm,"");k=k.split(",");f.ha[g]=[];for(let q=0;q<k.length;++q)f.ha[g][q]=
parseInt(k[q])}f.a={};d=d.getElementsByTagName("properties")[0];if(void 0!=d)for(let r of d.getElementsByTagName("property"))void 0!=r.getAttribute("name")&&(f.a[r.getAttribute("name")]=r.getAttribute("value"))}e[b]=f;++a.loaded})}function Ha(a,b,c){++a.total;let d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=()=>{a.a.X.decodeAudioData(d.response,e=>{++a.loaded;a.B[b]=new Ca(a.a.X,e)})};d.send(null)}
function Ia(a,b,c){++a.total;Ea(a,c,"json",d=>{a.ba[b]=JSON.parse(d);++a.loaded})}function Ja(a){return 0==a.total||a.loaded>=a.total}class Ka{constructor(a){this.F={};this.qb={};this.B={};this.ba={};this.loaded=this.total=0;this.a=a}load(a){Da(this,a)}};function G(a,b,c){a.c&&b.play(a.X,a.vb*c,!1,0)}function La(a,b){a.c&&(null!=a.a&&(a.a.stop(),a.a=null),b.play(a.X,.4,!0,0),a.a=b)}function Ma(a){a.c&&null!=a.a&&a.a.pause(a.X)}function Na(a){a.c&&null!=a.a&&a.a.resume(a.X)}class Oa{constructor(){this.X=new AudioContext;this.a=null;this.vb=1;this.c=!1}toggle(a){this.c=a}};class Pa{constructor(){this.c=0;this.Sa=()=>{};this.a=new w;this.active=!1;this.speed=1;this.g=!1;this.i=this.mode=0;this.A=new t(80,72)}L(a,b,c,d,e){this.a=new w;this.i=e;this.g=a;this.speed=c;this.c=1;this.Sa=d;this.mode=b;this.active=!0}update(a){this.active&&0>=(this.c-=this.speed*a.step)&&(0==(this.g=!this.g)?(this.c+=1,this.Sa(a)):(this.active=!1,this.c=0))}s(a){if(this.active&&-1!=this.mode){a.moveTo(0,0);var b=this.c;this.g&&(b=1-b);var c=this.A.x,d=this.A.y;switch(this.mode){case 0:null!=
this.i&&(b=Math.round(b*this.i)/this.i);y(a,this.a.r,this.a.gb,this.a.eb,b);a.fillRect(0,0,a.width,a.height);break;case 1:var e=Math.max(Math.hypot(c,d),Math.hypot(a.width-c,d),Math.hypot(a.width-c,a.height-d),Math.hypot(c,a.height-d));b=(1-b)*e;y(a,this.a.r,this.a.gb,this.a.eb);{let k=a.X;if(0>=b)k.fillRect(0,0,a.width,a.height);else if(!(b*b>=a.width*a.width+a.height*a.height)){null==c&&(c=a.width/2);null==d&&(d=a.height/2);var f=Math.max(0,d-b)|0;e=Math.min(a.height,d+b)|0;0<f&&k.fillRect(0,0,
a.width,f);e<a.height&&k.fillRect(0,e,a.width,a.height-e);for(let l=f;l<e;++l){var g=l-d;Math.abs(g)>=b?k.fillRect(0,l|0,a.width|0,1):(f=Math.round(c-Math.sqrt(b*b-g*g)),g=Math.round(c+Math.sqrt(b*b-g*g)),0<f&&k.fillRect(0,l|0,f|0,1),g<a.width&&k.fillRect(g|0,l|0,a.width-f|0,1))}}}break;case 2:b=Math.round(a.height/2*b),y(a,this.a.r,this.a.gb,this.a.eb),a.fillRect(0,0,a.width,b),a.fillRect(0,a.height-b,a.width,b)}y(a)}}Y(){this.active=!1}};function Qa(a,b){var c=b.width/4;let d=c/8;b.clear(0,0,0);a=a.m;var e=0==a.total?0:a.loaded/a.total;a=b.width/2-c/2;let f=b.height/2-d/2;a|=0;f|=0;y(b,255,255,255);b.fillRect(a-2,f-2,c+4,d+4);y(b,0);b.fillRect(a-1,f-1,c+2,d+2);c=c*e|0;y(b,255);b.fillRect(a,f,c,d)}
class Ra{constructor(a,b,c){this.c=this.C=0;this.audio=new Oa;this.m=new Ka(this.audio);this.i=new ja(a,b,this.m.F);this.W=new Pa;this.a={step:c+1,m:this.m,audio:this.audio,W:this.W,input:E(E(E(E(new ta,"left","ArrowLeft",14,null),"up","ArrowUp",12,null),"right","ArrowRight",15,null),"down","ArrowDown",13,null),Ja:d=>this.Ja(d)};this.g=new ua(this.a,null);this.o=!1;this.l=this.g}loop(a){const b=16.66667*this.a.step;this.c+=a-this.C;this.c=Math.min(5*b,this.c);this.C=a;a=this.c/b|0;let c=!0,d=Ja(this.m);
d&&!this.o&&(this.g=new this.l.prototype.constructor(this.a,null),this.l=null,this.o=!0);for(;0<a--;)this.i.update(this.a),this.W.update(this.a),c&&qa(this.a.input),d&&this.g.refresh(this.a),c&&(this.a.input.Xa(),c=!1),this.c-=b;Ja(this.m)?(this.g.ib(this.i),this.W.s(this.i)):Qa(this,this.i);window.requestAnimationFrame(e=>this.loop(e))}Ja(a){this.g=new a.prototype.constructor(this.a,this.g.mb())}};function H(a,b,c,d,e,f){b|=0;c|=0;d|=0;e|=0;if(c==d)a.g=0,a.c=c,a.a=b;else{a.a!=b&&(a.g=0,a.c=d>c?c:d,a.a=b);if(c<d&&a.c<c||c>d&&a.c>c)a.c=c;a.g+=f;a.g>e&&(c<d?++a.c>d&&(a.c=c):--a.c<d&&(a.c=c),a.g-=e)}}function I(a,b,c){a.c=b;a.a=c;a.g=0}class L{constructor(a,b){this.width=a;this.height=b;this.g=this.a=this.c=0}s(a,b,c,d,e){z(a,b,this.width*this.c,this.height*this.a,this.width,this.height,c,d,e)}};class M{constructor(a,b,c){this.text=a;this.Sa=b;this.Ab=c;this.disabled=!1}}
class O{constructor(a,b,c){this.buttons=[];for(let d of c)this.buttons.push(d);this.width=8*(Math.max(...this.buttons.map(d=>d.text.length))+1);this.height=this.buttons.length*a;this.da=0;this.active=!!b;this.offset=a}L(a){null!=a&&(this.da=a);this.active=!0}Y(){this.active=!1}update(a){if(this.active){var b=this.da;ra(a.input)?--this.da:sa(a.input)&&++this.da;this.da=h(this.da,this.buttons.length);this.da!=b&&G(a.audio,a.m.B.next,.6);b=this.buttons[this.da];if(a.input.actions.start.state==D||a.input.actions.fire1.state==
D)b.disabled||null==b.Sa||b.Sa(a),G(a.audio,a.m.B[b.Ab||b.disabled?"deny":"accept"],.6)}}s(a,b,c){if(this.active){b-=this.width/2;c-=this.height/2;for(let f=0;f<this.buttons.length;++f){var d=this.buttons[f].disabled?"fontGray":this.da==f?"fontYellow":"font";var e=this.da==f?"@":" ";e+=this.buttons[f].text;A(a,a.F[d],e,b,c+f*this.offset,0,0,!1)}}}};function R(a,b,c,d,e){return ea(a.b,a.A,a.D,b,c,d,e)}function Sa(a,b){return R(a,b.b.x-b.D.x/2,b.b.y-b.D.y/2,b.D.x,b.D.y)}function S(a){fa(a.speed);fa(a.target)}
class Ta{constructor(a,b){this.b=new t(a,b);this.Na=this.b.clone();this.speed=new t(0,0);this.target=this.speed.clone();this.a=new t(1,1);this.A=new t(0,0);this.D=new t(0,0);this.u=!0;this.G=this.R=!1;this.f=new L(0,0)}kb(){}Ga(){}Xa(){}bb(){return!0}update(a){this.u&&(this.G?this.R?this.bb(a)&&(this.R=this.u=!1):(this.Na=this.b.clone(),this.Ga(a),this.speed.x=da(this.speed.x,this.target.x,this.a.x*a.step),this.speed.y=da(this.speed.y,this.target.y,this.a.y*a.step),this.b.x+=this.speed.x*a.step,this.b.y+=
this.speed.y*a.step,this.Xa()):this.kb())}s(){}Aa(a){this.G=Ua(a,this)}};function Va(a,b,c,d,e,f){!a.G||!f&&a.pa||!a.u||a.R||0>a.speed.y||(f=a.b.x+a.A.x-a.c.x/2,f+a.c.x<=b+1||f>=b+d-1||(b=a.A.y+a.c.y/2,d=a.Na.y+b,a.b.y+b>=c-1*e.step&&d<=c+(2+a.speed.y)*e.step&&(a.b.y=c-b,a.qa(e),a.speed.y*=-a.ya)))}function Wa(a,b,c,d,e,f){!a.G||!f&&a.pa||!a.u||a.R||0<a.speed.y||(f=a.b.x+a.A.x-a.c.x/2,f+a.c.x<=b+1||f>=b+d-1||(b=a.A.y-a.c.y/2,d=a.Na.y+b,a.b.y+b<=c+1*e.step&&d>=c-(2-a.speed.y)*e.step&&(a.b.y=c-b,a.Fa(e),a.speed.y*=-a.ya)))}
function T(a,b,c,d,e,f,g){!a.G||!g&&a.pa||!a.u||a.R||0>a.speed.x*e||(g=a.b.y+a.A.y-a.c.y/2,g+a.c.y<=c+1||g>=c+d-1||(c=a.A.x+a.c.x/2*e,d=a.Na.x+c,g=a.b.x+c,!(0<e&&g>=b-1*f.step&&d<=b+(2+a.speed.x)*f.step||0>e&&g<=b+1*f.step&&d>=b-(2-a.speed.x)*f.step)))||(a.b.x=b-c,a.Z(e,f),a.speed.x*=-a.Ea)}class U extends Ta{constructor(a,b){super(a,b);this.c=this.D.clone();this.pa=!1;this.ya=this.Ea=0}qa(){}Z(){}Fa(){}};class Xa extends U{constructor(){super(0,0);this.u=!1;this.f=new L(8,8);this.a=new t(.015,.1);this.ya=this.Ea=.75;this.c=new t(4,4);this.A=new t(0,7);this.g=!0}ja(a,b,c,d,e){this.b=new t(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.target.y=4;this.u=!0;I(this.f,4*Math.random()|0,e);this.g=!0}kb(){this.u=!1}s(a){this.u&&this.G&&this.f.s(a,a.F.chips,this.b.x-4,this.b.y+3,0)}qa(){!this.g&&.1>this.speed.y&&(this.u=!1);this.g=!1}};const Ya=[1,4,8,2,9,6,3,5,12,10,7,13,14,11,15];class Za{constructor(){this.b=new t(0,0);this.c=this.g=this.speed=this.a=0;this.u=!1}ja(a,b,c,d,e){this.a=0;this.speed=d;this.g=c;this.c=e;this.b=new t(a,b);this.u=!0}update(a,b){this.u&&16<=(this.a+=this.speed*b.step)&&(wa(a.ea,this.g,this.b.x,this.b.y+1,this.c+1),this.u=!1)}s(a){this.u&&z(a,a.F.tileset,this.c%16*16,16*(this.c/16|0),16,16,16*this.b.x,16*this.b.y+this.a|0,0)}}
function V(a,b,c,d){if(b.u&&b.G&&!b.R){var e=b.b.x/16|0,f=b.b.y/16|0,g=e-2,k=f-2;e+=4;f+=4;for(let P=0;P<a.ea.ha.length-1;++P)for(let aa=k;aa<=f;++aa)for(let ba=g;ba<=e;++ba){var l=va(a.ea,P,ba,aa);if(0!=l){var n=a.C.ha[0][l-1];if(null!=n)if(0<n&&n<=Ya.length)$a(b,n-1,ba,aa,d);else{var r=a,q=b,x=n-1,W=l-1;l=ba;n=aa;var N=P,la=c,u=d,Q=[2,0,2,8],J=[8,2,0,2],K=[12,8,12,8],F=[8,12,8,12];switch(x){case 15:void 0!=q.La&&q.La(16*l,16*n,16,16,u);break;case 16:case 17:case 18:case 19:void 0!=q.ob&&q.ob(16*
l+Q[x-16],16*n+J[x-16],K[x-16],F[x-16],2,u);break;case 20:case 21:case 22:if(void 0!=q.lb&&q.lb(16*l+2,16*n,12,16,u)-1>=x-20){wa(r.ea,N,l,n,0);{let ya,za;Q=r;J=16*l+8;K=16*n+8;F=x-20;var ca=Math.random()*Math.PI;let Db=2*Math.PI/6;for(let Aa=0;6>Aa;++Aa)za=ca+Db*Aa,ya=1.5*Math.random()+1,p(Q.a,Xa).ja(J,K,Math.cos(za)*ya,Math.sin(za)*ya*1.75,F);G(u.audio,u.m.B["break"],.5)}20==x&&(va(r.ea,N,l,n-1)==W+1&&(wa(r.ea,N,l,n-1,0),x=l,Q=n-1,p(r.c,Za).ja(x,Q,N,1,W)),ab(la,16*l+8,16*n+8,q.b));break}$a(q,14,
l,n,u);break;case 27:void 0!=q.La&&q.La(16*l+8,16*n,16,16,u);break;case 29:void 0!=q.ab&&q.ab(16*l,16*n+8,16,8,u);break;case 30:void 0!=q.ab&&q.ab(16*l,16*n,16,16,u);break;case 31:Va(q,16*l,16*(n+1),16,u),void 0!=q.La&&q.La(16*l,16*n+8,16,8,u,4)}}}}}}function bb(a,b){cb(b,a.ea.ha[a.ea.ha.length-1],a.width,a.height)}function $a(a,b,c,d,e){b=Ya[b|0];1==(b&1)&&Va(a,16*c,16*d,16,e);8==(b&8)&&Wa(a,16*c,16*(d+1),16,e);4==(b&4)&&T(a,16*(c+1),16*d,16,-1,e,!1);2==(b&2)&&T(a,16*c,16*d,16,1,e,!1)}
class db{constructor(a){this.o=a.qb.base;this.l=a.qb.collisions;this.ea=xa(this.o);this.C=xa(this.l);this.width=this.ea.width;this.height=this.ea.height;this.g=this.i=0;this.a=[];this.c=[]}update(a,b){this.i=(this.i+.5*b.step)%96;this.g=(this.g+.125*b.step)%16;for(let c of this.a)c.Aa(a),c.update(b),V(this,c,null,b);for(let c of this.c)c.update(this,b)}s(a,b){let c=(10*b.O.x|0)-1;b=(9*b.O.y|0)-1;let d=(a.width/16|0)+2,e=(a.height/16|0)+2;for(let u=0;u<this.ea.ha.length-1;++u){{var f=void 0,g=void 0,
k=void 0,l=a,n=a.F.tileset,r=u,q=c,x=b,W=d,N=e;const Q=[133];for(let J=x;J<x+N;++J)for(let K=q;K<q+W;++K)if(k=va(this.ea,r,K,J),0!=k--)if(Q.includes(k)){{let F;g=l;f=n;var la=K;let ca=k%16|0,P=k/16|0;switch(k){case 133:k=16*J+(1+Math.round(Math.sin(this.g/16*Math.PI*2))),F=this.g|0,F%2!=k%2&&++ca,z(g,f,16*ca+F,16*P,16-F,16,16*la,k,0),0<F&&z(g,f,16*ca,16*P,F,16,16*(la+1)-F,k,0)}}}else g=k%16|0,f=k/16|0,z(l,n,16*g,16*f,16,16,16*K,16*J,0)}}for(let u of this.c)u.s(a);for(let u of this.a)u.s(a)}};function eb(a,b){a.R=!0;S(a);G(b.audio,b.m.B.hit2,.5)}
class fb extends U{constructor(){super(0,0);this.u=!1;this.f=new L(16,16);this.c=new t(2,2);this.D=new t(6,6);this.a=new t(.05,.05);this.g=1}ja(a,b,c,d,e,f,g){this.b=new t(a,b);this.speed=new t(c,d);this.target=this.speed.clone();f&&(this.target.y=2);this.g=null==g?1:g;I(this.f,0,e);this.u=!0;this.pa=[2,3].includes(e)}bb(a){H(this.f,this.f.a,4,8,4,a.step);return 8==this.f.c}Ga(a){H(this.f,this.f.a,0,3,4,a.step)}kb(){this.u=!1}s(a){this.u&&this.G&&this.f.s(a,a.F.bullets,this.b.x-8,this.b.y-8,0)}qa(a){eb(this,
a)}Fa(a){eb(this,a)}Z(a,b){eb(this,b)}xa(a,b){!this.u||!this.G||this.R||0<a.M||!Sa(a,this)||(a.dir=a.b.x<this.b.x?1:-1,a.Ua(this.g,b),eb(this,b))}};class gb{constructor(a,b){this.b=new t(a,b);this.f=new L(16,16);this.G=!1;this.c=0;this.C=this.disabled=!1;this.D=new t(16,16)}Aa(a){this.G=Ua(a,this)}I(){}i(){}l(){}xa(a,b,c,d){this.disabled||!this.G||b.R||(this.l(b),null!=d&&R(b,this.b.x-this.D.x/2,this.b.y-this.D.y/2,this.D.x,this.D.y)&&(this.I(b,d),b.K&&(b.$a=!0,ra(d.input)&&(this.C||G(d.audio,d.m.B.activate,.5),b.$a=!1,this.i(a,b,c,d)))))}};function hb(a,b){switch(a){case 0:a=b.progress;a.V+=2;a.ia+=2;break;case 2:a=b.progress;a.keys+=1;break;case 3:a=b.progress;a.Ma+=1;break;case 4:a=b.progress,a.V=a.ia}}function ib(a,b,c,d){var e=["heart","item","key","orb","potion"];let f=e[c]+"Name";e=e[c]+"Desc";1==c?(c=a.obtain+" "+a[f][d],a=a[e][d]):(c=a.obtain+" "+a[f],a=a[e]);X(b,c);for(let g of a)X(b,g)}
class jb extends gb{constructor(a,b,c,d){super(a,b);this.g=this.a=!1;this.type=c;this.id=d;this.c=0;I(this.f,((a/16|0)+(b/16|0))%4,2*this.type);this.o=0;this.D=new t(12,16)}update(a){this.G&&!this.a&&(this.g||H(this.f,2*this.type,0,3,8,a.step))}s(a){this.G&&this.f.s(a,a.F.chest,this.b.x-8,this.b.y-8,this.c)}i(a,b,c,d){this.g||this.a||(c=d.m.ba.en,kb(b,this.b.x,this.b.y,b.b.x<this.b.x?-1:1),this.disabled=this.g=!0,I(this.f,0,1+2*this.type),Ma(d.audio),ib(c,a,this.type,this.id),lb(a,e=>{if(0<this.o)return 0>=
(this.o-=e.step);H(this.f,2*this.type+1,0,4,3==this.f.c?30:6,e.step);4==this.f.c&&(this.a=!0,this.g=!1,this.o=60,I(this.f,3,2*this.type+1),mb(b,this.type,1==this.type?this.id:0),G(e.audio,e.m.B.treasure,.5));return!1}).L(e=>{Na(e.audio);hb(this.type,b);b.progress.Ca[this.type][this.id]=!0},!1))}l(a){this.c=a.b.x<this.b.x?0:1}Ba(a){if(this.a=a.Ca[this.type][this.id])this.g=!1,this.disabled=!0,I(this.f,3,1+2*this.type)}};class nb extends U{constructor(){super(0,0);this.u=!1;this.f=new L(16,16);this.a=new t(.01,.05);this.ya=this.Ea=.75;this.c=new t(4,8);this.D=new t(8,8);this.A.y=-1;this.id=0;this.g=!1;this.i=!0}ja(a,b,c,d,e){this.b=new t(a,b);this.speed.x=c;this.speed.y=d;this.target.x=0;this.u=!0;this.id=e;I(this.f,0,e);this.g=!1;this.i=!0}Ga(a){this.a.x=.01;this.a.y=.05;this.target.y=2;this.g&&(this.i&&(this.speed.x/=2,this.speed.y/=2,this.i=!1),this.a.x/=2,this.a.y/=2,this.target.y/=2);this.g=!1;H(this.f,this.f.a,
0<=this.speed.x?0:3,0<=this.speed.x?3:0,6,a.step)}s(a){this.u&&this.G&&this.f.s(a,a.F.collectibles,this.b.x-8,this.b.y-8,0)}Ra(a,b){this.Aa(a);this.G?a.yb||(T(this,a.O.x*a.width,a.O.y*a.height,a.height,-1,b),T(this,(a.O.x+1)*a.width,a.O.y*a.height,a.height,1,b)):this.u=!1}xa(a,b,c){if(this.u&&Sa(a,this)){if(0==this.id)ob(a.progress,1);else{var d=a.progress;d.V=Math.min(d.ia,d.V+2)}this.u=!1;G(c.audio,c.m.B[["coin","heal"][this.id]],.6);c=a.b.x;a=a.b.y+a.A.y-a.f.height/2;d="+"+String.fromCharCode(64+
m(1,0,9))+String.fromCharCode(33+this.id);p(b.Ta,pb).ja(c,a,1,16,30,d)}}ab(a,b,c,d){return R(this,a,b,c,d)?this.g=!0:!1}};class qb extends gb{constructor(a,b,c,d){super(a,b);this.active=!1;this.wb=c;this.jb=null;this.f=new L(32,32);this.D=new t(8,32);this.id=d;this.xb=!0;this.a=this.g=c}update(a){if(this.disabled=this.g&&!this.a)H(this.f,0,0,4,8,a.step),this.a=4==this.f.c;this.C=this.g&&this.a}s(a){this.G&&!this.a&&this.f.s(a,a.F.door,this.b.x-16,this.b.y-16,0)}i(a,b,c,d){let e=d.m.ba.en;this.g?(d.W.L(!0,1,1/30,f=>{let g=this.jb.b.clone();g.y+=8;b.moveTo(g,c);rb(b,!0);f.W.A=new t(b.b.x%160,b.b.y%144)},new w(0,0,0)),
d.W.A=new t(this.b.x%160,this.b.y%144),b.b.x=this.b.x,rb(b,!1),G(d.audio,d.m.B.door,.7)):0>=b.progress.keys?X(a,e.needKey).L(()=>{},!1):X(a,e.openDoor).L(f=>{this.g=!0;this.a=!1;var g=b.progress;g.keys+=-1;b.progress.hb[this.id]=!0;b.fb=32;G(f.audio,f.m.B.open,.8)},!0)}Ba(a){this.a=this.g=a.hb[this.id]}};function sb(a,b){a.$=b}function tb(a){a.sa();a.M=0;a.V=0;a.R=!0;a.g=0;I(a.f,0,0)}
class Y extends U{constructor(a,b,c,d,e){super(a,b);this.N=this.b.clone();this.f=new L(16,16);I(this.f,0,c+1);this.V=this.ia=d;this.zb=e;this.M=0;this.sb=this.Ia=-1;this.dir=1;this.g=0;this.K=!1;this.a=new t(.1,.1);this.l=1;this.D=new t(8,8);this.c=new t(8,8);this.I=new t(0,0);this.ca=!1;this.$=()=>{};this.pb=this.ta=this.Ha=this.la=this.Va=!1}S(){}o(){}i(){}C(){}Oa(){}sa(){}bb(a){H(this.f,0,0,4,6,a.step);return 4<=this.f.c}L(){this.pa=this.ca=!1;this.S(this.N.x,this.N.y)}Ga(a){this.ca||(this.o(a),
this.i(a),0<this.M&&(this.M-=a.step))}Xa(){this.K=!1}Ua(a,b,c,d,e){this.V-=b;this.Va||(this.speed.x=this.l*a);this.M=30+this.M%2;0>=this.V&&(this.sa(),tb(this),ab(c,this.b.x,this.b.y+this.A.y,d.b));G(e.audio,e.m.B[this.R?"kill":"hit"],.6);a=this.b.x;d=this.b.y+this.A.y-this.f.height/2;p(c.Ta,pb).ja(a,d,1,16,30,"-"+String(b))}xa(a,b,c){if(this.u&&!this.R&&this.G&&!this.ca&&(this.C(a),0>=this.M&&!this.Ha&&a.ob(this.b.x+this.A.x-this.D.x/2,this.b.y+this.A.y-this.D.y/2,this.D.x,this.D.y,this.zb,c)&&this.Oa(c),
!this.la))if(ub(a)&&a.cb>this.Ia&&ea(this.b,this.A,this.D,a.ka.x-a.ra.x/2,a.ka.y-a.ra.y/2,a.ra.x,a.ra.y)){var d=2;a.aa?++d:a.oa&&(d+=2);this.Ua(a.aa?0:2*a.dir*(a.oa?1.5:1),d,b,a,c);this.Ia=a.cb;!this.R&&a.oa&&0<a.U&&(a.speed.x=0,a.target.x=0);a.aa&&(a.aa=!1,a.ga=8,a.ma=!1)}else a.P.u&&a.P.nb>this.sb&&Sa(this,a.P)&&(this.Ua(2*(this.b.x<a.P.b.x?-1:1),1,b,a.P,c),b=a.P,b.g&&!0,S(b),b.l=0,b.g=!0,this.sb=a.P.nb)}rb(){}s(a){this.ca||!this.u||!this.G||0<this.M&&0==Math.floor(this.M/2)%2||(this.rb(a),this.f.s(a,
a.F.enemies,Math.round(this.b.x+this.I.x-this.f.width/2),Math.round(this.b.y+this.I.y-this.f.height/2),this.g))}qa(){this.K=!0}Ra(a,b){if(this.u){var c=this.G;this.G=Ua(a,this);if(!this.G){if(this.R){this.u=!1;return}if(this.ca){this.L();return}}!this.R&&this.G!=c&&c&&(this.b=this.N.clone(),S(this),this.V=this.ia,this.M=0,a.yb||(this.pa=this.ca=!0));if(!a.yb&&this.G){c=a.O.x*a.width;var d=a.O.y*a.height;T(this,c,d,a.height,-1,b,!0);T(this,c+a.width,d,a.height,1,b,!0);this.ta&&(Va(this,c,d+a.height,
a.width,b,!0),Wa(this,c,d,a.width,b,!0))}}}na(){}};function vb(a){const b=[wb,xb,yb,zb,Ab,Bb,Cb,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb];return b[m(a,0,b.length-1)|0]}
class wb extends Y{constructor(a,b){super(a,b,0,3,2);this.a.x=.025;this.h=!0;this.A.y=2;this.c=new t(4,12);this.I.y=1;this.l=.5}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.x=.25;this.speed.x=this.target.x;this.target.y=2}o(a){this.target.x=.25*this.dir;this.h&&!this.K&&0>=this.M&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.h=this.K}i(a){this.g=0<this.dir?1:0;this.K&&H(this.f,this.f.a,0,3,6,a.step)}Z(){this.speed.x*=-1;this.target.x*=-1;this.dir*=
-1}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class xb extends Y{constructor(a,b){super(a,b,1,2,1);this.A.y=2;this.c=new t(4,12);this.I.y=1;this.a.y=.05;this.l=.5;this.h=0}S(a){this.target.y=2;this.h=60-(a/16|0)%2*30}o(a){this.K&&0>=(this.h-=a.step)&&(this.h+=60,this.speed.y=-1.75,G(a.audio,a.m.B.jump2,.5))}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);I(this.f,a,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:-1}}
class zb extends Y{constructor(a,b){super(a,b,3,2,1);this.a.x=.1;this.j=!0;this.A.y=4;this.c=new t(4,8);this.D=new t(8,6);this.I.y=1;this.l=.5;this.h=!1}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.y=2}o(a){this.target.x=0;0!=this.f.c%2&&(this.target.x=.6*this.dir);!this.h&&this.j&&!this.K&&0>=this.M&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.j=this.K}i(a){this.g=0<this.dir?1:0;this.K?H(this.f,this.f.a,0,3,0==this.f.c%2?30:6,a.step):I(this.f,
2,this.f.a)}Z(a){this.dir=-a}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}C(a){this.h=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class yb extends Y{constructor(a,b){super(a,b,2,3,2);this.A.y=2;this.c=new t(4,10);this.I.y=0;this.a.x=.05;this.a.y=.1;this.l=.5;this.j=60+(a/16|0)%2*30;this.h=1-(a/16|0)%2*2;this.Ea=-1}S(){this.target.y=4}o(a){this.K?(this.target.x=0,0>=(this.j-=a.step)&&(this.j+=60,this.speed.y=-2.5,this.target.x=.5*this.h,this.speed.x=this.target.x,this.dir=this.h,G(a.audio,a.m.B.jump2,.5))):this.dir=0<=this.speed.x?1:-1}i(){this.g=0<this.dir?1:0;let a=0;.5<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);I(this.f,
a,this.f.a)}C(a){this.h=a.b.x>this.b.x?1:-1;if(ub(a)||a.P.u&&!a.P.g)this.h*=-1}Z(a){this.dir=-a}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.speed.x*=-1,this.dir*=-1}}
class Ab extends Y{constructor(a,b){super(a,b,4,3,2);this.a.x=.05;this.A.y=2;this.c=new t(4,12);this.I.y=1;this.l=.75;this.h=60;this.j=!0;this.H=0;this.v=1;this.T=0}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.y=3;this.h=60;this.j=!0}o(a){let b=this.v;0>=(this.h-=a.step)&&(this.h+=60,this.j&&(this.v+=this.H,this.H=b,20<=++this.T&&(this.T=0,this.v=1,this.H=0),this.dir=1-this.v%2*2,this.h+=(this.b.x|0)%60),this.j=!this.j);this.target.x=this.j?0:.5*this.dir}i(a){this.g=0<this.dir?1:
0;this.K?this.j?I(this.f,0,this.f.a):H(this.f,this.f.a,0,3,8,a.step):I(this.f,4,this.f.a)}Z(){this.j||(this.dir*=-1)}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}}
class Bb extends Y{constructor(a,b){super(a,b,5,2,1);this.a.x=.015;this.a.y=.015;this.c=new t(4,4);this.l=.33;this.j=30;this.h=!0;this.v=new t(0,0);this.ya=this.Ea=1}S(){}o(a){0>=(this.j-=a.step)&&(this.j+=this.h?60:30,this.h?(this.speed.x=.5*this.v.x,this.speed.y=.5*this.v.y):fa(this.target),this.h=!this.h);this.h||(this.target=this.speed.clone())}i(a){H(this.f,this.f.a,0,3,this.h?5:3,a.step)}C(a){this.h&&(this.v=v(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0))}na(a){this.h||(a=v(new t(this.b.x-a.b.x,
this.b.y-a.b.y),!0),this.speed.x=.5*a.x)}}
class Cb extends Y{constructor(a,b){super(a,b,6,3,2);this.a.x=.033;this.a.y=.033;this.c=new t(6,6);this.l=.5;this.j=new t(0,0);this.active=!1;this.h=0}S(){this.b.y-=4;this.active=!1;this.h=0}o(a){this.active&&(0<this.h?this.h-=a.step:(this.target.x=.33*this.j.x,this.target.y=.33*this.j.y))}i(a){this.active?0<this.h?I(this.f,1,this.f.a):H(this.f,this.f.a,1,4,6,a.step):I(this.f,0,this.f.a);this.g=0<this.h?2:0}C(a){if(this.active)this.j=v(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0);else if(this.active=
0<this.M||a.b.y>this.b.y&&48>Math.abs(a.b.x-this.b.x))this.h=30,this.target.y=1}}
class Sb extends Y{constructor(a,b,c,d,e,f,g,k){super(a,b,c,d,e);this.a.x=.025;this.c=new t(8,8);this.D=new t(10,8);this.l=.5;this.h=0;this.j=f;this.H=g;this.v=k}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.h=(this.b.x+this.b.y)%(2*Math.PI)}o(a){this.target.x=this.v*this.dir;this.h=(this.h+this.H*a.step)%(2*Math.PI);this.b.y=this.N.y+Math.round(Math.sin(this.h)*this.j)}Z(){this.speed.x*=-1;this.target.x*=-1;this.dir*=-1}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=
-1,this.speed.x*=-1,this.target.x*=-1}}class Eb extends Sb{constructor(a,b){super(a,b,7,3,2,2,.1,.125)}i(){this.g=0<this.dir?1:0;let a=1,b=Math.sin(this.h);-.5>b?a=0:.5<b&&(a=2);I(this.f,a,this.f.a)}}function Tb(a,b){a.speed.y=-1;G(b.audio,b.m.B.jump2,.5)}
class Fb extends Y{constructor(a,b){super(a,b,8,2,1);this.A.y=2;this.c=new t(4,12);this.I.y=1;this.a.y=.025;this.l=.5;this.h=0}S(a){this.target.y=2;this.h=60-(a/16|0)%2*30}o(a){const b=this.target.y/3;this.K?0>=(this.h-=a.step)&&Tb(this,a):0>=this.h&&this.speed.y>=b&&Tb(this,a)}i(){this.g=0<this.dir?1:0;let a=0;.25<Math.abs(this.speed.y)&&(a=0>this.speed.y?1:2);I(this.f,a,this.f.a)}Fa(){this.h=60}}
class Ub extends Y{constructor(a,b,c,d,e){super(a,b,c,d,e);this.A.y=2;this.c=new t(4,12);this.I.y=1;this.l=.5;this.h=!1;this.j=60-(a/16|0)%2*30;this.T=!1}S(){this.target.y=2}v(){}o(a){!this.h&&0>=(this.j-=a.step)&&(I(this.f,1,this.f.a),this.h=!0,this.j=60,this.v(a))}i(a){this.g=0<this.dir?1:0;this.h?(H(this.f,this.f.a,1,3,1==this.f.c?6:30,a.step),3==this.f.c&&(I(this.f,this.T?1:0,this.f.a),this.h=!1)):0!=this.f.c?H(this.f,this.f.a,1,0,6,a.step):I(this.f,0,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:
-1}}class Gb extends Ub{constructor(a,b){super(a,b,9,3,2)}v(a){this.$(this.b.x+4*this.dir,this.b.y,2*this.dir,0,0,!1,1);G(a.audio,a.m.B.snowball,.5)}}class Hb extends Sb{constructor(a,b){super(a,b,10,3,2,4,.1,.33);this.a.x=.025;this.l=.5}i(a){this.g=0<this.dir?1:0;H(this.f,this.f.a,0,3,4,a.step)}}function Vb(a,b,c){a.h&&(a.speed.y=b,G(c.audio,c.m.B.jump2,.5))}
class Ib extends Y{constructor(a,b){super(a,b,11,6,3);this.a.x=.025;this.A.y=2;this.c=new t(4,12);this.I.y=1;this.l=.33;this.H=this.j=!1;this.v=0;this.h=!1}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.y=4}o(a){this.target.x=.33*this.dir;!this.K&&this.h&&0<this.speed.x/this.dir&&this.H&&Vb(this,-2.5,a);(this.h=this.K)&&this.j&&Vb(this,-m(this.v/16,1.75,2.75),a)}i(a){this.g=0<this.dir?1:0;let b=5;this.K?H(this.f,this.f.a,0,3,8,a.step):(-.5>this.speed.y?b=4:.5<this.speed.y&&(b=6),I(this.f,
b,this.f.a))}Z(a,b){this.dir==a&&Vb(this,-2.75,b)}C(a){this.H=a.b.y<this.b.y;this.j=48>this.b.y-a.b.y&&24<this.b.y-a.b.y&&a.K;this.dir=a.b.x>this.b.x?1:-1;this.v=Math.abs(a.b.y-this.b.y)}}class Jb extends Ub{constructor(a,b){super(a,b,12,3,2);this.T=!0;this.H=0}v(a){this.$(this.b.x+2*this.dir,this.b.y-4,this.H/80,-2,1,!0,1);G(a.audio,a.m.B.snowball,.5)}C(a){this.dir=a.b.x>this.b.x?1:-1;this.H=a.b.x-this.b.x}}
class Kb extends Y{constructor(a,b){super(a,b,13,6,3);this.a.y=.1;this.c=new t(16,14);this.I.y=2;this.D=new t(12,12);this.A.y=2;this.l=.5;this.h=this.v=!1;this.j=0;this.Va=this.H=!0;this.N.y-=2;--this.b.y}S(){--this.b.y;this.h=this.v=!1;this.j=0;this.H=!0}o(a){0<this.j&&0>=(this.j-=a.step)&&(this.h=!0);this.h&&(this.target.y=-.5,this.speed.y=-.5,this.b.y<this.N.y&&(this.b.y=this.N.y,this.h=!1,S(this)))}i(){let a=0;this.v?a=1:0<this.j?a=2:this.h&&(a=3);I(this.f,a,this.f.a)}C(a){0>=this.j&&!this.v&&
!this.h&&a.b.y>this.b.y&&24>Math.abs(a.b.x-this.b.x)&&(this.v=!0,this.target.y=6)}qa(a){this.v&&(this.j=60,this.H=this.v=!1,G(a.audio,a.m.B.quake,.4))}Fa(){this.h&&(this.b.y=this.N.y,S(this),this.h=!1)}rb(a){this.H||(a.Za=this.j,a.Ya=new t(3,3),this.H=!0)}}
class Lb extends Y{constructor(a,b){super(a,b,14,5,3);this.A.y=2;this.c=new t(4,10);this.I.y=0;this.a.x=.025;this.a.y=.1;this.l=.5;this.dir=1-(a/16|0)%2*2;this.ya=this.Ea=-1}S(a){this.dir=1-(a/16|0)%2*2;this.target.x=.5*this.dir;this.speed.x=this.target.x;this.target.y=4}o(){this.target.x=.5*this.dir}i(a){H(this.f,this.f.a,0,3,6,a.step);this.g=0>this.dir?0:1}Z(a){this.dir=-a;this.speed.x*=-1;this.target.x=this.speed.x}qa(a){this.speed.y=-2.25;G(a.audio,a.m.B.jump2,.5)}na(a){if(0<this.speed.x&&a.b.x>
this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.target.x*=-1,this.speed.x*=-1,this.dir*=-1}}
class Mb extends Y{constructor(a,b){super(a,b,15,3,2);this.a.x=.015;this.a.y=.033;this.c=new t(6,6);this.l=.5;this.j=new t(0,0);this.h=0}S(){this.h=0;this.pa=!0}o(a){this.h=(this.h+.05*a.step)%(2*Math.PI);this.target.x=.33*this.j.x;this.target.y=.33*(this.j.y+1.5*Math.sin(this.h))}i(){let a=1;-.125>this.speed.y?a=0:.125<this.speed.y&&(a=2);I(this.f,a,this.f.a);this.g=0<this.target.x?1:0}C(a){this.j=v(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class Nb extends Y{constructor(a,b){super(a,b,16,3,2);this.a.y=.05;this.c=new t(6,6);this.l=.5;this.h=this.H=0;this.ta=!0;this.ya=-1;this.T=this.j=this.v=0;this.fa=new t(0,0)}S(a,b){this.j=this.h=0;this.H=0==(b/16|0)%2?1:-1;this.T=this.h=0;this.v=120-(a/16|0)%2*60}o(a){this.b.x=this.N.x+Math.round(4*Math.sin(this.T));0<this.j?this.j-=a.step:(this.T=(this.T+.05*a.step)%(2*Math.PI),this.h=(this.h+.1*a.step)%(2*Math.PI),this.target.y=this.H*(Math.sin(this.h)+.2)*.5,0>=(this.v-=a.step)&&(this.$(this.b.x+
4*(0==this.g?-1:1),this.b.y+2,1*this.fa.x,1*this.fa.y,2,!1,2),G(a.audio,a.m.B.snowball,.5),this.j=30,S(this),this.v+=120))}i(){if(0<this.j)I(this.f,3,this.f.a);else{var a=1;-.25>this.speed.y?a=0:.25<this.speed.y&&(a=2);I(this.f,a,this.f.a);this.g=0<this.target.x?1:0}}qa(){this.H=-1;this.target.y*=-1;this.h=0}Fa(){this.H=1;this.target.y*=-1;this.h=0}C(a){this.g=a.b.x<this.b.x?0:1;this.fa=v(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}}
class Ob extends Y{constructor(a,b){super(a,b,17,1,3);this.a.x=.025;this.A.y=2;this.c=new t(4,12);this.I.y=1;this.l=.33}S(a){this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.y=4}o(){this.target.x=this.dir}i(a){this.g=0<this.dir?1:0;this.K?H(this.f,this.f.a,0,3,6,a.step):I(this.f,4,this.f.a)}C(a){this.dir=a.b.x>this.b.x?1:-1}Oa(a){G(a.audio,a.m.B.kill,.6);tb(this)}sa(){let a;for(let b=0;4>b;++b)a=Math.PI/4+b*Math.PI/2,this.$(this.b.x,this.b.y+this.A.y,2*Math.cos(a),2*Math.sin(a),3,!1,2)}}
class Pb extends Y{constructor(a,b){super(a,b,18,1,1);this.a.y=.1;this.c=new t(8,10);this.I.y=2;this.A.y=2;this.l=.5;this.la=this.Va=!0;this.N.y-=4;this.b.y-=4;this.j=this.h=0;this.pb=!0}S(a){this.h=0;this.j=60-(a/16|0)%2*60/2;I(this.f,8,this.f.a)}o(a){this.Ha=this.la=2!=this.h;this.target.y=0;0==this.h?0>=(this.j-=a.step)&&(this.h=1,I(this.f,0,this.f.a)):2==this.h&&(this.target.y=2)}i(a){0==this.h?I(this.f,8,this.f.a):1==this.h?(H(this.f,this.f.a,0,4,10,a.step),4==this.f.c&&(this.h=2)):3==this.h&&
(H(this.f,this.f.a,5,8,6,a.step),8==this.f.c&&(this.h=0,this.b=this.N.clone(),this.j=60))}qa(a){2==this.h&&(this.h=3,S(this),G(a.audio,a.m.B.blob,.7))}}
class Qb extends Y{constructor(a,b){super(a,b,19,6,3);this.a.x=.05;this.H=!0;this.A.y=2;this.c=new t(8,12);this.I.y=1;this.l=.75;this.v=!1;this.j=0;this.h=!1}S(a){this.h=!1;this.j=60-(a/16|0)%2*60/2;this.dir=1-(a/16|0)%2*2;this.g=0<this.dir?1:0;this.target.y=4}o(a){this.target.x=.5*this.dir;!this.v&&this.H&&!this.K&&0>=this.M&&(this.dir*=-1,this.speed.x*=-1,this.target.x*=-1,this.b.x+=this.speed.x*a.step);this.H=this.K;0>=(this.j-=a.step)&&(this.h=!this.h,this.j+=this.h?30:60,this.h&&(this.$(this.b.x+
8*this.dir,this.b.y+2,2*this.dir,0,4,!1,2),G(a.audio,a.m.B.snowball,.5)))}i(a){this.g=0<this.dir?1:0;let b=this.h?5:0;this.K?H(this.f,this.f.a,b,b+3,8,a.step):I(this.f,b+4,this.f.a)}Z(a){this.dir=-a}na(a){if(0<this.speed.x&&a.b.x>this.b.x||0>this.speed.x&&a.b.x<this.b.x)this.dir*=-1,this.speed.x*=-1}C(a){this.v=a.b.y>this.b.y+8&&0>(this.b.x-a.b.x)*this.dir}}
class Rb extends Y{constructor(a,b){super(a,b,20,6,3);this.a.x=.025;this.a.y=.025;this.c=new t(6,6);this.l=.66;this.v=0;this.H=new t(0,0);this.T=new t(0,0);this.fa=this.h=this.j=0;this.ta=!0}S(a){this.v=this.b.y%(2*Math.PI);this.pa=!0;this.j=120-(a/16|0)%2*120/2}o(a){0<this.h?this.h-=a.step:(this.target.x=.75*this.H.x,this.target.y=.75*this.H.y,this.v=(this.v+.025*a.step)%(2*Math.PI),0>=(this.j-=a.step)&&(this.$(this.b.x,this.b.y,1.5*this.T.x,1.5*this.T.y,3,!1,2),G(a.audio,a.m.B.snowball,.5),this.h=
30,this.fa=this.f.c,I(this.f,this.f.c+5,this.f.a),S(this),this.j+=120))}i(a){0<this.h?I(this.f,this.fa+Math.floor(this.h/8)%2*5,this.f.a):(H(this.f,this.f.a,0,4,5,a.step),this.g=0<this.target.x?1:0)}C(a){this.H=v(new t(a.b.x+32*Math.cos(this.v)-this.b.x,a.b.y+32*Math.sin(this.v)-this.b.y),!0);this.T=v(new t(a.b.x-this.b.x,a.b.y-this.b.y),!0)}};class pb{constructor(){this.b=new t(0,0);this.speed=0;this.text="";this.c=this.a=0;this.u=!1}ja(a,b,c,d,e,f){this.b=new t(a,b);this.speed=c;this.a=d;this.c=e;this.text=f;this.u=!0}update(a){this.u&&(0<this.a?(this.a-=a.step,this.b.y-=this.speed):0>=(this.c-=a.step)&&(this.u=!1))}s(a){this.u&&A(a,a.F.spcfont,this.text,this.b.x|0,this.b.y-5|0,-3,0,!0)}};class Wb extends gb{constructor(a,b,c){super(a,b);this.g=c;I(this.f,((a/16|0)+(b/16|0))%4,0);this.D=new t(10,16)}update(a){this.G&&!this.a&&H(this.f,0,0,3,10,a.step)}s(a){this.G&&this.f.s(a,a.F.npc,this.b.x-8,this.b.y-8+1,this.c)}i(a,b,c,d){b=d.m.ba.en["npc"+String(this.g)];for(let e of b)X(a,e);a.L(()=>{},!1)}l(a){this.c=a.b.x<this.b.x?0:1}};class Xb extends U{constructor(){super(0,0);this.f=new L(16,16);this.g=!1;this.l=0;this.o=null;this.C=0;this.a=new t(.1,.1);this.c=new t(4,4);this.D=new t(10,10);this.i=this.G=this.u=!1;this.nb=0}ja(a,b,c,d,e,f){this.b=new t(a,b);this.speed=new t(c,d);this.target=this.speed.clone();this.g=!1;this.l=e;this.o=f;this.C=this.speed.length();this.G=this.u=!0;this.i=this.pa=this.R=!1;++this.nb}Ga(a){let b=new t(this.b.x-this.o.b.x,this.b.y-this.o.b.y),c=b.length();v(b,!1);this.g?(this.target.x=-b.x*this.C,
this.target.y=-b.y*this.C,this.i||(this.i=Math.sign(this.target.x)==Math.sign(this.speed.x)&&Math.sign(this.target.y)==Math.sign(this.speed.y)),12>c&&(this.u=!1)):0>=(this.l-=a.step)&&(this.g=!0);H(this.f,5,1,4,4,a.step);this.pa=this.g&&this.i}s(a){this.u&&this.f.s(a,a.F.figure,this.b.x-8|0,this.b.y-8|0,0<=this.speed.x?0:1)}Z(){this.i=!0;this.g||(this.l=0,this.g=!0)}lb(a,b,c,d){return this.u&&R(this,a,b,c,d)?1:0}};function kb(a,b,c,d){a.b.x=b+8*d;a.b.y=c;a.dir=d;a.g=0<d?1:0;I(a.f,4,6);a.M=0}function mb(a,b,c){I(a.f,0,8);a.H=new t(c,b);a.M=0}function rb(a,b){I(a.f,b?1:2,8);a.M=0}function ub(a){return a.aa&&0<=a.speed.y||a.la&&a.U>(a.oa?0:15)}function Yb(a,b){a.o&&(a.dir*=-1,a.g=0==a.g?1:0);a.N=!1;a.U=20;S(a);b?a.i||(a.speed.x=1.25*a.dir,a.target.x=a.speed.x):a.U+=10;a.oa=b;a.ga=0;a.l=0;a.la=!0;var c=a.b.y+2;a.ka.x=a.b.x+13*a.dir;a.ka.y=c;a.ra.x=12;a.ra.y=b?10:4;++a.cb}
function Zb(a,b){a.R=!0;I(a.f,0,7);S(a);a=b.audio;a.c&&null!=a.a&&(a.a.stop(a.X),a.a=null);G(b.audio,b.m.B.die,.5)}
class $b extends U{constructor(a,b,c){super(a,b);this.va=new t(a,b);this.tb=null;this.f=new L(16,16);I(this.f,4,4);this.fa=new L(16,16);this.g=0;this.a=new t(.1,.15);this.A=new t(0,2);this.D=new t(8,12);this.c=new t(6,12);this.K=!1;this.ga=0;this.ma=!1;this.h=0;this.I=this.v=this.i=!1;this.U=this.l=0;this.ca=this.N=this.la=!1;this.sa=0;this.oa=!1;this.ka=new t(0,0);this.ra=new t(0,0);this.cb=0;this.aa=!1;this.$=0;this.o=!1;this.Oa=this.C=0;this.P=new Xb;this.P.u=!1;this.dir=1;this.j=this.M=0;this.progress=
c;this.Ia=this.ta=!1;this.G=!0;this.Ha=0;this.$a=!1;this.T=0;this.H=null;this.fb=0}Ga(a){this.v&&!this.i&&(this.v=!1);this.dir=0==this.g?1:-1;var b=a.input.actions.fire2.state;if(b=b==C||b==B)this.ca&&b?(this.ca=!1,this.sa=0,Yb(this,!0),G(a.audio,a.m.B.powerAttack,.6)):!this.oa&&0<this.U&&10>=this.U&&(this.U=0);if(!(0<this.U||this.aa||(this.target.y=2,0<this.j))){this.target.x=1*a.input.J.x;this.o&&!this.I&&(this.target.y*=.25);this.a=new t(.1,.15);a:{if(a.input.actions.fire2.state==D){if(!this.i&&
!this.I&&!this.K&&.1<a.input.J.y){S(this);this.speed.y=-3;this.target.y=4;this.a.y=.35;this.aa=!0;this.$=0;b=this.b.y+16;this.ka.x=this.b.x;this.ka.y=b;this.ra.x=8;this.ra.y=12;++this.cb;G(a.audio,a.m.B.downAttack,.6);b=!0;break a}if(this.N){Yb(this,!1);G(a.audio,a.m.B.sword,.5);b=!0;break a}}b=!1}if(b=!b)this.P.u?b=!1:(this.o&&(this.dir*=-1,this.g=0==this.g?1:0),a.input.actions.fire3.state==D?(this.P.ja(this.b.x+4*this.dir,this.b.y+2,2*this.dir,0,24,this),this.P.Na.x=this.b.x,S(this),this.U=30,this.la=
!1,this.l=this.ga=0,G(a.audio,a.m.B["throw"],.6),b=!0):b=!1),b=!b;if(b&&(this.I&&(this.a.x*=.5,this.a.y*=.25,this.target.x*=.5,this.target.y*=.25,this.o=!1,this.C=0),b=a.input.actions.fire1.state,this.i?(.1<a.input.J.x?this.g=0:-.1>a.input.J.x&&(this.g=1),this.target.y=.5*a.input.J.y,this.target.x=0,b==D&&(.1>a.input.J.y&&(this.ga=14),this.v=this.i=this.ma=!1,G(a.audio,a.m.B.jump,.5)),b=!0):b=!1,!b)){b=a.input.actions.fire1.state;if(b==D)if(!this.I&&this.K&&.1<a.input.J.y)this.l=20,G(a.audio,a.m.B.jump,
.5);else{if(this.K||0<this.h||!this.ma||0<this.C)this.ga=(this.ma=!this.K&&0>=this.h&&0>=this.C)?8:14,this.K=!1,this.h=0,0<this.C&&(this.speed.x=-2*this.Oa),this.o=!1,this.C=0,this.N=!0,this.Ia=!1,G(a.audio,a.m.B.jump,.5)}else b==C&&(0<this.ga?this.ga=0:0<this.l&&(this.l=0),this.Ia=!0);if(this.ta=this.Ia&&this.ma&&0>=this.U&&this.ma&&1==(b&1)&&0>=this.ga)this.target.y=.5,this.speed.y=this.target.y}}0<this.U&&this.oa?this.ka.x+=this.speed.x*a.step:this.aa&&(this.ka.y+=this.speed.y*a.step);b=1/30;this.$a&&
(this.T+=b*a.step,this.T%=1);0<this.ga&&(this.speed.y=-2,this.I&&(this.speed.y*=.5),this.ga-=a.step);0<this.l&&(this.speed.x=2*this.dir,this.target.x=this.speed.x,this.l-=a.step);0<this.h&&(this.h-=a.step);0<this.C&&(this.C-=a.step);0<this.U&&(this.U-=a.step,!this.oa&&this.la&&0>=this.U&&(this.ca=!0,G(a.audio,a.m.B.charge,.5)));0<this.$&&0>=(this.$-=a.step)&&(this.aa=!1);this.ca&&(this.sa=(this.sa+a.step)%20);0<this.M&&(0<this.j?(this.j-=a.step,0>=this.progress.V&&0>=this.j&&Zb(this,a)):this.M-=a.step);
{b=this.f.c;let c=this.f.a;if(0<this.j)I(this.f,0,5);else if(this.aa)I(this.fa,3,4),I(this.f,1,4);else if(0<this.U)I(this.f,0,4),this.oa?H(this.fa,4,7,8,4,a.step):I(this.fa,2,4);else if(0<this.l)I(this.f,4,1);else if(.1<Math.abs(this.target.x)&&(this.g=0>this.target.x?1:0),this.o)I(this.f,3,1);else if(this.I)0<=this.speed.y&&.1<Math.abs(this.target.x)?H(this.f,3,0,1,10,a.step):(b=0>this.speed.y?2:0,I(this.f,b,3));else if(this.i){if(3!=this.f.a||.1<Math.abs(this.target.y))H(this.f,3,3,4,10,a.step),
(this.f.a!=c||this.f.c!=b&&3==this.f.c)&&G(a.audio,a.m.B.climb,.6)}else this.ta?(H(this.f,6,0,3,3,a.step),(this.f.a!=c||this.f.c!=b&&0==this.f.c)&&G(a.audio,a.m.B.flap,.5)):this.K?.1>Math.abs(this.speed.x)&&.1>Math.abs(this.target.x)?I(this.f,0,0):(b=12-6*Math.abs(this.speed.x),H(this.f,0,1,4,b,a.step)):this.ma&&0>this.speed.y?H(this.f,2,0,4,4,a.step):(b=0,.5>Math.abs(this.speed.y)?b=1:0<this.speed.y&&(b=2),I(this.f,b,1))}this.P.update(a);this.I=this.i=!1}Xa(){this.$a=this.o=this.K=!1;this.H=null}bb(a){H(this.f,
7,0,2,3,a.step);return 120<=(this.Ha+=a.step)}s(a){if(this.u)if(this.R){var b=1*this.Ha;for(var c=0;8>c;++c){var d=2*Math.PI/8*c;var e=this.b.x+this.A.x+Math.cos(d)*b;d=this.b.y+this.A.y+Math.sin(d)*b;this.f.s(a,a.F.figure,e-8,d-8,0)}this.P.s(a)}else 0<this.M&&0!=Math.floor(this.M/2)%2||(c=this.f.c,this.ca&&0==Math.floor(this.sa/2)%2&&(c+=5),b=Math.round(this.b.x-8),e=Math.round(this.b.y-7),0<this.U&&this.la&&this.fa.s(a,a.F.figure,b+12-24*this.g,e+1,this.g),d=this.f,z(a,a.F.figure,d.width*c,d.height*
this.f.a,d.width,d.height,b,e,this.g),this.aa&&this.fa.s(a,a.F.figure,b+3-6*this.g,e+7,this.g),this.P.s(a),this.$a&&(c=this.f,z(a,a.F.figure,c.width*(3+Math.floor(this.T/.5)),7*c.height,c.width,c.height,b,e-16,0)),null!=this.H&&z(a,a.F.items,16*this.H.x,16*this.H.y,16,16,b,e-16,0))}qa(){this.K=!0;this.ma=!1;this.h=12;.1<this.speed.y&&(this.v=this.i=!1);this.N=!0;this.aa&&0>=this.$&&(this.$=20);this.C=0;this.o=!1}Z(a,b){!this.i&&!this.aa&&0>=this.U&&!this.I&&0<this.speed.y&&.1<b.input.J.x*a&&(this.o=
!0,this.C=15,this.Oa=a,this.N=!0)}Fa(){this.ga=0}La(a,b,c,d,e,f){return R(this,a+4,b,c-8,d)?this.v?(this.N=!0,void 0==f&&(this.i=!0),!0):ra(e.input)||sa(e.input)?(this.v=this.i=this.N=!0,this.b.x=a+8,void 0!=f&&(this.b.y=b+f),S(this),!0):!1:!1}ab(a,b,c,d){return R(this,a,b,c,d)?(this.I=!0,this.h=1,this.ma=!1,this.l=0,this.N=!0):!1}Ra(a,b){let c=a.b.x*a.width,d=a.b.y*a.height,e=a.target.x-a.b.x,f=a.target.y-a.b.y,g=(this.D.x+2)*a.Wa,k=(this.D.y+2)*a.Wa,l=0,n=0,r;a.wa?(this.b.x+=e*g*b.step,this.b.y+=
f*k*b.step):0>=this.j?(0<this.speed.x&&this.b.x+this.A.x+this.D.x/2>c+a.width?l=1:0>this.speed.x&&this.b.x+this.A.x-this.D.x/2<c?l=-1:0<this.speed.y&&this.b.y+this.A.y+this.D.y/2>d+a.height?n=1:0>this.speed.y&&this.b.y+this.A.y-this.D.y/2<d&&(n=-1),0==l&&0==n||0==(r=a.move(l,n,.05))||(this.b.x+=r*a.width*a.Da)):(T(this,a.O.x*a.width,a.O.y*a.height,a.height,-1,b),T(this,(a.O.x+1)*a.width,a.O.y*a.height,a.height,1,b));null!=this.P&&this.P.u&&!Ua(a,this.P)&&(this.P.u=!1)}Ua(a,b){this.g=0<this.dir?0:
1;this.M=60;this.j=30;this.target.x=0;this.speed.x=2*-this.dir;this.i=!1;this.U=0;this.ta=this.ca=this.o=this.aa=!1;var c=this.progress;c.V=Math.max(0,c.V-a);G(b.audio,b.m.B.hurt,.5)}ob(a,b,c,d,e,f){if(!(0<this.M))return R(this,a,b,c,d)?(this.dir=this.b.x<a+c/2?1:-1,this.Ua(e,f),!0):!1}lb(a,b,c,d){return(ub(this)||0<this.$)&&ea(this.ka,null,this.ra,a,b,c,d)?this.oa||this.aa?2:1:0}moveTo(a,b){this.b=a.clone();S(this);b.setPosition(this.b.x/160|0,this.b.y/144|0)}};function ac(a){let b={};var c=Object.assign(a.progress);b.progress={maxHealth:c.ia,health:c.V,gems:c.ub,coins:c.Ka,keys:c.keys,orbs:c.Ma,openedChests:c.Ca,openedDoors:c.hb,boughtItems:c.za};b.savePoint={x:a.va.x,y:a.va.y};a=JSON.stringify(b);try{window.localStorage.setItem("agff_savedata",a)}catch(d){return console.log("Save error: "+d),!1}return!0}
function bc(a){var b=null;try{b=window.localStorage.getItem("agff_savedata")}catch(e){console.log("SAVE ERROR: "+e);return}if(null!=b){b=JSON.parse(b);if(void 0!=b.progress){var c=a.progress,d=b.progress;c.ia=d.maxHealth;c.V=c.ia;c.ub=d.gems;c.Ka=d.coins;c.keys=d.keys;c.Ma=d.orbs;if(void 0!=d.openedChests)for(let e=0;e<c.Ca.length;++e)c.Ca[e]=Array.from(d.openedChests[e]);void 0!=d.openedDoors&&(c.hb=Array.from(d.openedDoors));void 0!=d.boughtItems&&(c.za=Array.from(d.boughtItems))}void 0!=b.savePoint&&
(a.va=(new t(b.savePoint.x,b.savePoint.y)).clone(),a.b=a.va.clone())}};class cc extends gb{constructor(a,b){super(a,b);this.active=!1;this.D=new t(10,16)}update(a){this.G&&(this.active?H(this.f,0,1,8,6,a.step):I(this.f,0,0))}s(a){this.G&&this.f.s(a,a.F.savepoint,this.b.x-8,this.b.y-8,0)}I(a,b){this.active||(this.active=!0,a.va=this.b.clone(),a.tb=this,null!=b&&G(b.audio,b.m.B.savepoint,.5))}i(a,b,c,d){let e=d.m.ba.en;X(a,e.saveGame).L(()=>{let f=ac(b);X(a,e[f?"goodResult":"badResult"]).L(()=>{},!1)},!0)}l(a){this.active=a.tb==this}};class dc extends gb{constructor(a,b,c,d){super(a,b);this.active=!1;this.f=new L(24,24);this.D=new t(12,16);this.f.c=4*Math.random()|0;this.id=d;this.a=c}update(a){this.G&&H(this.f,this.id,0,3,10,a.step)}s(a){this.G&&this.f.s(a,a.F.shopkeeper,this.b.x-12,this.b.y-12,this.c)}i(a,b,c,d){X(a,d.m.ba.en.shopkeeper).L(()=>{this.a.L(this.id)},!1)}l(a){this.c=a.b.x<this.b.x?0:1}};function cb(a,b,c,d){var e=0;let f=0;for(let g=0;g<d;++g)for(let k=0;k<c;++k)if(f=b[g*c+k]-512,!(0>=f)){--f;e=0;0<g&&(e=Math.max(0,b[(g-1)*c+k]-512-240-1));switch(f){case 0:a.a=new $b(16*k+8,16*g+8,a.progress);break;case 32:a.g.push(new cc(16*k+8,16*g+8));break;case 33:case 34:case 35:case 36:a.g.push(new jb(16*k+8,16*g+8,f-33,e));break;case 37:a.g.push(new Wb(16*k+8,16*g+8,e));break;case 38:case 39:a.g.push(new qb(16*k+8,16*g,39==f,e));break;case 40:a.g.push(new dc(16*k+8,16*g+4,a.o,e))}if(1<=f&&
31>=f){e=a.c.length;for(let l=0;l<a.c.length;++l)if(!a.c[l].u){e=l;break}a.c[e]=new (vb(f-1).prototype.constructor)(16*k+8,16*g+8);a.c[e].S(16*k+8,16*g+8);sb(a.c[e],(l,n,r,q,x,W,N)=>{p(a.i,fb).ja(l,n,r,q,x,W,N)})}}ec(a)}function ab(a,b,c,d){let e=(b-d.x)/16*.75;e=m(e,-.75,.75);d=Math.max(0,c-d.y)/16*2;d=m(d,-2,2);var f=a.a.progress;f=Math.random()<.25*(1-f.V/f.ia)?1:0;p(a.l,nb).ja(b,c,e,-1.5+d,f)}
function ec(a){for(let b of a.g)if(void 0!=b.xb)for(let c of a.g)void 0!=c.xb&&c.id==b.id&&c.wb!=b.wb&&(c.jb=b,b.jb=c)}function fc(a,b){b.setPosition(a.a.b.x/160|0,a.a.b.y/144|0)}function gc(a,b){b.A=new t((a.a.b.x|0)%160,(a.a.b.y|0)%144)}
class hc{constructor(a,b){this.a=null;this.c=[];this.Ta=[];this.l=[];this.i=[];this.g=[];this.progress=a;this.o=b}update(a,b,c,d){var e=this.a;0>=e.fb?e=!1:(e.fb-=d.step,e=!0);if(!e){for(let k of this.c)if(k.Ra(a,d),a.wa||(k.update(d),k.xa(this.a,this,d),V(b,k,this,d)),k.u&&!k.R&&k.G)for(let l of this.c)if(l!=k)a:{var f=void 0;e=k;var g=l;if(!g.u||g.R||!g.G||!e.u||e.R||!e.G||g.pb||e.pb)break a;f=Math.hypot(e.D.x/2,e.D.y/2);let n=Math.hypot(g.D.x/2,g.D.y/2),r=new t(e.b.x+e.A.x-g.b.x-g.A.x,e.b.y+e.A.y-
g.b.y-g.A.y),q=r.length();v(r);q<f+n&&(f=f+n-q,e.Va||(e.b.x+=r.x*f/2,e.b.y+=r.y*f/2),e.na(g),g.Va||(g.b.x-=r.x*f/2,g.b.y-=r.y*f/2),g.na(e))}a.wa||(this.a.update(d),V(b,this.a,this,d),this.a.P.u&&V(b,this.a.P,this,d));this.a.Ra(a,d)}for(let k of this.Ta)k.update(d);for(let k of this.g)k.Aa(a),k.update(d),k.xa(c,this.a,a,d);for(let k of this.i)k.Aa(a),k.update(d),V(b,k,this,d),k.xa(this.a,d);for(let k of this.l)k.Ra(a,d),k.update(d),k.xa(this.a,this,d),V(b,k,this,d);return this.a.u}s(a){for(let b of this.g)b.s(a);
for(let b of this.c)b.s(a);for(let b of this.l)b.s(a);this.a.s(a);for(let b of this.i)b.s(a);for(let b of this.Ta)b.s(a)}Ba(a){for(let b of this.c)b.Aa(a);for(let b of this.g)b.Aa(a),b.xa(null,this.a,null),void 0!=b.Ba&&b.Ba(this.a.progress)}};function ob(a,b){a.Ka+=b}class ic{constructor(){this.V=this.ia=6;this.ub=0;this.Ka=20;this.Ma=this.keys=0;this.Ca=Array(4);for(let a=0;a<this.Ca.length;++a)this.Ca[a]=Array(4).fill(!1);this.hb=Array(16).fill(!1);this.za=Array(5).fill(!1)}};function Ua(a,b){if(void 0==b.f)return!1;let c=a.O.x*a.width,d=a.O.y*a.height;return b.b.x+b.f.width/2>=c&&b.b.y+b.f.height/2>=d&&b.b.x-b.f.width/2<c+a.width&&b.b.y-b.f.height/2<d+a.height}
class jc{constructor(a,b,c,d,e,f,g){this.b=new t(a,b);this.target=this.b.clone();this.O=this.b.clone();this.i=this.b.clone();this.width=c;this.height=d;this.wa=!1;this.Wa=this.a=0;this.Da=e;this.l=f;this.g=g;this.c=!1}move(a,b,c){if(this.wa||!this.g&&(0==this.b.x&&0>a||this.b.x==this.Da-1&&0<a)||!this.o&&(0==this.b.y&&0>b||this.b.y==this.l-1&&0<b))return 0;this.a=1;this.Wa=c;this.target.x=this.b.x+a|0;this.target.y=this.b.y+b|0;this.wa=!0;return this.g&&0>this.target.x?(this.b.x+=this.Da,this.target.x+=
this.Da,1):this.g&&this.target.x>=this.Da?(this.b.x-=this.Da,this.target.x-=this.Da,-1):0}update(a){this.c=!1;this.wa&&(0>=(this.a-=this.Wa*a.step)?(this.a=0,this.b=this.target.clone(),this.O=this.b.clone(),this.wa=!1):(a=this.a,this.O.x=a*this.b.x+(1-a)*this.target.x,this.O.y=a*this.b.y+(1-a)*this.target.y))}setPosition(a,b){this.b=new t(a,b);this.target=this.b.clone();this.O=this.b.clone();this.c=!0}};function Z(a,b,c,d,e){const f=[[0,0,0],[255,255,255][0,0,0],[0,85,170]];let g=f.length-1;for(let k=0;k<f.length;++k,--g)y(a,f[k][0],f[k][1],f[k][2],1),a.fillRect(b-g,c-g,d+2*g,e+2*g)};function X(a,b){b=10==b.charCodeAt(b.length-1)?b.substr(0,b.length-1):b;a.a.push(b);a.l.push(kc(b));return a}function lb(a,b){a.Z=b;return a}function kc(a){let b=new t(0,0);a=a.split("\n").map(c=>c.length);b.x=8*Math.max(...a);b.y=10*a.length;return b}
class lc{constructor(a){a=a.m.ba.en;this.a=[];this.l=[];this.c=this.g=this.char=0;this.active=!1;this.h=0;this.o=()=>{};this.i=!1;this.Z=()=>!0;this.N=new O(12,!0,[new M(a.yes,b=>{this.Y();this.o(b)},!1),new M(a.no,()=>{this.Y()},!0)]);this.I=this.C=!1}L(a,b){this.active=!0;this.c=this.g=0;this.o=a;this.i=!1;this.C=b;this.I=!1;this.N.L(1)}update(a){if(this.active){var b=a.input.Pa();if(!this.i&&(this.i=this.Z(a),!this.i))return;this.I=this.c==this.a[0].length&&1==this.a.length;this.c<this.a[0].length?
b?this.c=this.a[0].length:2<=(this.g+=1*a.step)&&(this.g-=2,++this.c,a=this.a[0].charCodeAt(this.c),this.c<this.a[0].length&&"\n"==a&&++this.c):1==this.a.length&&this.C?this.N.update(a):(b&&(this.a.shift(),this.l.shift(),this.g=this.c=0,G(a.audio,a.m.B.next,.6),0==this.a.length&&(null!=this.o&&this.o(a),this.Y())),this.h=(this.h+.1*a.step)%(2*Math.PI))}}s(a,b){if(this.active&&this.i){var c=this.l[0].x+4,d=this.l[0].y+4,e=a.width/2-c/2,f=a.height/2-d/2;b&&Z(a,e,f,c,d);A(a,a.F.font,this.a[0].substr(0,
this.c),e+2,f+2,0,2,!1);this.I&&this.C?(c=e+c-20,b=f+d+14,Z(a,c-18,b-12-2,36,24),this.N.s(a,c,b)):this.c==this.a[0].length&&(b=Math.round(Math.sin(this.h))|0,z(a,a.F.font,24,0,8,8,e+c-8,f+d-4+b,!1))}}Y(){this.active=!1;this.Z=()=>!0;this.a.length=0;this.l.length=0}};function mc(a,b){X(a.message,b.m.ba.en.respawnText).L(c=>{a.g(c);a.a.Y();a.active=!1},!0)}function nc(a,b){X(a.message,b.m.ba.en.quitText).L(c=>{a.c(c);a.a.Y();a.active=!1},!0)}
class oc{constructor(a,b,c){let d=c.m.ba.en;this.message=new lc(c);this.a=new O(12,!0,[new M(d.resume,e=>{this.Y(e)},!1),new M(d.respawn,e=>{mc(this,e)},!1),new M(d.quit,e=>{nc(this,e)},!1)]);this.g=a;this.c=b;this.active=!1}L(){this.active=!0;this.a.L(0)}Y(a){this.a.Y();this.active=!1;Na(a.audio)}update(a){this.active&&(this.message.active?this.message.update(a):this.a.update(a))}s(a){this.active&&(y(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.active?this.message.s(a,!0):(Z(a,a.width/
2-34,a.height/2-20,68,40),this.a.s(a,a.width/2,a.height/2+1)))}};function pc(a){a.W.L(!0,1,1/30,b=>b.Ja(qc),new w(0,0,0));a.W.A=new t(78,24)}
class rc extends ua{constructor(a,b){super(a,b);this.a=a.m.ba.en;this.i=new O(12,!0,[new M(this.a.newgame,c=>{this.load=!1;pc(c)},!1),new M(this.a["continue"],c=>{let d=!1;try{d=window.localStorage.getItem("agff_savedata")}catch(e){d=!1}d?(this.load=!0,pc(c)):(G(c.audio,c.m.B.deny,.6),X(this.message,this.a.noSaveData).L(()=>{},!1))},!0)]);this.c=0;this.g=60;this.load=!1;this.message=new lc(a)}refresh(a){a.W.active||(this.message.active?this.message.update(a):0==this.c?0>=(this.g-=a.step)&&++this.c:
1==this.c&&this.i.update(a))}ib(a){a.clear(0,0,0);let b=0;0==this.c&&(b=this.g/60);let c=a.F.titlebg;z(a,c,0,0,c.width,c.height,0,c.height*b,0);var d=c=a.F.logo;z(a,d,0,0,d.width,d.height,0,-c.height*b+8,0);A(a,a.F.font,this.a.copyright,a.width/2+a.width*b,a.height-9,0,0,!0);this.i.s(a,-a.width*b+a.width/2,a.height-32);this.message.s(a,!0)}mb(){return this.load}};const sc=[4,0,2,1,1,1,1,1,1,1],tc=[0,16,16,16,17,18,19,20,21,22],uc=[10,10,10,20,30,30,20,30,50,20];
function vc(a,b,c){let d=c.m.ba.en;c=d.shopItemNames;let e=[];for(let f=0;f<c.length;++f){e.push([]);for(let g=0;g<c[f].length;++g)e[f].push(new M(" "+c[f][g],()=>{a.progress.za[5*f+g]||(a.progress.Ka<uc[5*f+g]?X(a.message,d.cannotAfford).L(()=>{},!1):X(a.message,d.confirmTransaction).L(k=>{4!=sc[5*f+g]&&(a.progress.za[5*f+g]=!0,a.a[a.id].buttons[g].disabled=!0);ob(a.progress,-uc[5*f+g]);a.Y();ib(a.g,a.i,sc[5*f+g],tc[5*f+g]);a.c=60;mb(b,sc[g],1==sc[5*f+g]?tc[5*f+g]:0);G(k.audio,k.m.B.treasure,.5);
Ma(k.audio);lb(a.i,l=>0>=(a.c-=l.step)).L(l=>{hb(sc[5*f+g],b);Na(l.audio)},!1)},!0))},!1));e[f].push(new M(d.back,()=>{a.Y()},!0))}return e}function wc(a,b,c){b=vc(a,b,c);for(c=0;c<b.length;++c)a.a[c]=new O(12,!0,b[c])}function xc(a){for(let b=0;b<a.a.length;++b)for(let c=0;c<a.a[b].buttons.length-1;++c)a.progress.za[5*b+c]&&(a.a[b].buttons[c].disabled=!0)}
class yc{constructor(a,b,c){this.progress=a;this.a=[];this.active=!1;this.g=c.m.ba.en;this.message=new lc(c);this.i=b;this.id=this.c=0}update(a){this.active&&(this.message.active?this.message.update(a):a.input.actions.back.state==D?(G(a.audio,a.m.B.deny,.6),this.Y()):this.a[this.id].update(a))}s(a){if(this.active){y(a,0,0,0,.67);a.fillRect(0,0,a.width,a.height);var b=a.height/2-this.a[this.id].height/2+-12;Z(a,a.width/2-24,4,48,12);A(a,a.F.font,"SHOP",a.width/2,6,0,0,!0);Z(a,a.width/2-74,b-2,148,
this.a[this.id].height);this.a[this.id].s(a,64,a.height/2+-12);for(var c=0;c<uc.length;++c)z(a,a.F.shopicons,8*(5*this.id+c),this.progress.za[5*this.id+c]?8:0,8,8,60-(this.a[this.id].width-8)/2+7,b+c*this.a[this.id].offset,0);for(let f=0;5>f;++f){if(this.progress.za[5*this.id+f]){c=this.g.sold;var d="fontGray"}else d=this.a[this.id].da==f?"fontYellow":"font",c=String(uc[5*this.id+f])+String.fromCharCode(6);var e=148-8*c.length;A(a,a.F[d],c,e,b+f*this.a[this.id].offset,0,0,!1)}b=b+this.a[this.id].height+
-4+12;Z(a,a.width/2-74,b-4,148,40);this.a[this.id].da<this.a[this.id].buttons.length-1&&(c=this.g.shopItemDesc[this.id][this.a[this.id].da],A(a,a.F.font,c,60-(this.a[this.id].width-8)/2,b-2,0,1,!1));this.message.active&&(y(a,0,0,0,.67),a.fillRect(0,0,a.width,a.height),this.message.s(a,!0))}}L(a){this.id=a;this.active=!0;this.a[this.id].L(this.a[this.id].buttons.length-1)}Y(){this.a[this.id].Y();this.active=!1}};function zc(a){a.W.L(!0,2,1/30,b=>{b.Ja(rc);b.W.Y()},new w(0,0,0))}function Ac(a,b){b.W.L(!0,1,1/30,c=>{var d=a.g;d.ea=xa(d.o);d.C=xa(d.l);for(var e of d.a)e.u=!1;for(var f of d.c)f.u=!1;e=a.a;f=a.g;d=e.a.va.clone();e.c=[];e.Ta=[];e.l=[];e.i=[];e.g=[];bb(f,e);e=e.a;e.va=d.clone();e.b=e.va.clone();d=a.c;d.b=d.i.clone();d.target=d.b.clone();d.O=d.b.clone();d.wa=!1;d.a=0;d.Wa=0;fc(a.a,a.c);gc(a.a,c.W);a.a.Ba(a.c);a.progress.V=6;La(c.audio,c.m.B.testTrack)},new w(0,0,0));gc(a.a,b.W)}
function Bc(a,b,c,d,e){c=String.fromCharCode(d)+String.fromCharCode(2)+String(c);A(a,b,c,a.width-(8*c.length+2),e,0,0,!1)}function Cc(a,b,c){let d=b.F.font,e=2;Bc(b,d,a.progress.Ka,6,e);if(!c){for(let f=0;f<a.progress.ia;++f)c=9*(f/2|0),0==f%2&&z(b,d,40,0,8,8,c+3,2),a.progress.V>f&&z(b,d,32+f%2*4,0,4,8,c+3+f%2*4,2);0<a.progress.keys&&(e+=10,Bc(b,d,a.progress.keys,7,e));0<a.progress.Ma&&Bc(b,d,a.progress.Ma,8,e+10)}}
class qc extends ua{constructor(a,b){super(a,b);this.g=new db(a.m);this.c=new jc(0,0,160,144,this.g.width/10|0,this.g.height/9|0,!0);this.progress=new ic;this.message=new lc(a);this.i=new yc(this.progress,this.message,a);this.a=new hc(this.progress,this.i);bb(this.g,this.a);fc(this.a,this.c);wc(this.i,this.a.a,a);this.l=new oc(c=>{var d=this.a;!d.a.R&&d.a.u&&Zb(d.a,c)},c=>{zc(c)},a);La(a.audio,a.m.B.testTrack);a.W.L(!1,1,1/30,null,new w(0,0,0));gc(this.a,a.W);this.a.Ba(this.c);!0===b&&(bc(this.a.a),
fc(this.a,this.c));xc(this.i)}refresh(a){this.c.c&&(this.a.Ba(this.c),this.c.c=!1);a.W.active||(this.message.active?this.message.update(a):this.i.active?this.i.update(a):this.l.active?this.l.update(a):a.input.actions.start.state==D?(this.l.L(),Ma(a.audio),G(a.audio,a.m.B.pause,.6)):(this.g.update(this.c,a),this.a.update(this.c,this.g,this.message,a)?this.c.update(a):Ac(this,a)))}mb(){}ib(a){a.moveTo(0,0);var b=this.c,c=h(this.g.i+16*b.O.x,96);a.clear(85,170,255);z(a,a.F.background,16,32,48,48,96,
16,0);b=16*b.O.y|0;a.move(0,-b);for(let d=0;3>d;++d)z(a,a.F.background,0,0,96,32,Math.round(-c+96*d),96,0);y(a,255,255,255);a.fillRect(0,128,a.width,16);for(c=0;c<a.width/16|0;++c)z(a,a.F.background,0,32,16,32,16*c,144,0);y(a,0,85,170);a.fillRect(0,176,a.width,Math.max(0,a.height+b-176));a.move(0,b);c=this.c;a.moveTo(-Math.round(c.O.x*c.width),-Math.round(c.O.y*c.height));this.paused||0>=a.Za||a.move(Math.round(Math.random()*a.Ya.x*2)-(a.Ya.x|0),Math.round(Math.random()*a.Ya.y*2)-(a.Ya.y|0));this.g.s(a,
this.c);this.a.s(a);a.moveTo(0,0);Cc(this,a,!1);this.message.active&&this.message.s(a,!0);this.l.s(a);this.i.s(a);this.i.active&&Cc(this,a,!0)}};class Dc extends ua{constructor(a,b){super(a,b);a=a.m.ba.en;this.a=new O(12,!0,[new M(a.yes,c=>{c.audio.toggle(!0);c.audio.vb=m(.6,0,1);c.Ja(qc)},!1),new M(a.no,c=>{c.audio.toggle(!1);c.Ja(qc)},!0)]);this.c=a.audiointro}refresh(a){this.a.update(a)}ib(a){a.clear(0,85,170);A(a,a.F.font,this.c,32,a.height/2-32,0,2,!1);this.a.s(a,a.width/2,a.height/2+16)}};window.onload=()=>{var a=new Ra(160,144,0);a.m.load("assets/assets.json");var b=[{name:"fire1",key:"KeyZ",ua:0},{name:"fire2",key:"KeyX",ua:2},{name:"fire3",key:"KeyC",ua:1},{name:"start",key:"Enter",ua:9,Qa:7},{name:"back",key:"Escape",ua:8,Qa:6}];for(let c of b)E(a.a.input,c.name,c.key,c.ua,c.Qa);a.l=Dc;a.o=!1;a.loop(0)};
